!function(t){var e={};function n(i){if(e[i])return e[i].exports;var a=e[i]={i:i,l:!1,exports:{}};return t[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(i,a,function(e){return t[e]}.bind(null,a));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e){var n,i,a,o,s,r,l,d,c,u,p,f,h,m="https://weather.opensprinkler.com",v=/IEMobile/.test(navigator.userAgent),b=/Android|\bSilk\b/.test(navigator.userAgent),g=/iP(ad|hone|od)/.test(navigator.userAgent),y=/Firefox/.test(navigator.userAgent),w=/MSAppHost/.test(navigator.userAgent),k=k||!1,x="object"==typeof chrome&&"object"==typeof chrome.storage,_=!g&&!b&&!v&&!k&&!w&&window.FileReader,S="ontouchstart"in window||"onmsgesturechange"in window,C=-1===["US","BM","PW"].indexOf(navigator.languages[0].split("-")[1]),T=function(t,e){if(e=e||function(){},x)chrome.storage.local.get(t,e);else{var n,i={};for(n in"string"==typeof t&&(t=[t]),t)t.hasOwnProperty(n)&&(i[t[n]]=localStorage.getItem(t[n]));e(i)}},I=function(t,e){if(e=e||function(){},x)chrome.storage.local.set(t,e);else{var n;if("object"==typeof t)for(n in t)t.hasOwnProperty(n)&&localStorage.setItem(n,t[n]);e(!0)}},j=function(t,e){if(e=e||function(){},x)chrome.storage.local.remove(t,e);else{var n;for(n in"string"==typeof t&&(t=[t]),t)t.hasOwnProperty(n)&&localStorage.removeItem(t[n]);e(!0)}},O=/^[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?),\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/,D=b?"#121212":"#1D1D1D",M=b?"#151515":"#202020",P={},U=!1,A=[0,0],R=-1,W=!1,E={tz:1,ntp:2,dhcp:3,ip1:4,ip2:5,ip3:6,ip4:7,gw1:8,gw2:9,gw3:10,gw4:11,hp0:12,hp1:13,ar:14,ext:15,seq:16,sdt:17,mas:18,mton:19,mtof:20,urs:21,rso:22,wl:23,den:24,ipas:25,devid:26,con:27,lit:28,dim:29,bst:30,uwt:31,ntp1:32,ntp2:33,ntp3:34,ntp4:35,lg:36,mas2:37,mton2:38,mtof2:39,fpr0:41,fpr1:42,re:43,dns1:44,dns2:45,dns3:46,dns4:47,sar:48,ife:49,sn1t:50,sn1o:51,sn2t:52,sn2o:53,sn1on:54,sn1of:55,sn2on:56,sn2of:57,subn1:58,subn2:59,subn3:60,subn4:61},N=[],L={};if(w&&$(window).on("error",(function(t,e,n){return window.console.log(t,e,n),!0})),window.MSApp){if(window.Windows&&Windows.UI&&Windows.UI.ApplicationSettings&&Windows.UI.ApplicationSettings.SettingsPane)Windows.UI.ApplicationSettings.SettingsPane.getForCurrentView().addEventListener("commandsrequested",(function(t){var e=t.request.applicationCommands,n=new Windows.UI.ApplicationSettings.SettingsCommand("privacy","Privacy Policy",(function(){window.open("https://albahra.com/journal/privacy-policy")}));e.append(n)}));MSApp.execUnsafeLocalFunction&&($.fn.oldDomManIp=$.fn.domManip,$.fn.domManip=function(t,e,n){var i=this;return MSApp.execUnsafeLocalFunction((function(){return i.oldDomManIp(t,e,n)}))})}function q(){if(!U){var t,e=$(this),n=e.attr("id"),i=e.is(":checked"),a="mmm"===n?"mm":n;t=B(i?"/cv?pw=&"+a+"=1":"/cv?pw=&"+a+"=0"),$.when(t).then((function(){At(),"mmm"===n&&$("#mm_list .green").removeClass("green"),Et()}),(function(){U=!0,setTimeout((function(){U=!1}),200),e.prop("checked",!i).flipswitch("refresh")}))}}function B(t,e){t=t.replace("pw=","pw="+encodeURIComponent(s)),e=e||"text";var d=/\/(?:cv|cs|cr|cp|uwa|dp|co|cl|cu|up|cm)/.exec(t),c=d?"change":"default",u=d&&Ie(300),p={url:a+i+(u?t.split("?")[0]:t),type:u?"POST":"GET",data:u?hn(t):null,dataType:e,shouldRetry:function(t,e){return!(0===t.status&&"abort"===t.statusText||2<e)||($.ajaxq.abort(c),!1)}};return o&&$.extend(p,{beforeSend:function(t){t.setRequestHeader("Authorization","Basic "+btoa(r+":"+l))}}),n&&$.extend(p,{cache:"true"}),$.ajaxq(c,p).then((function(e){if("string"==typeof e)try{e=$.parseJSON(e)}catch(t){return e}return"object"!=typeof e||"number"!=typeof e.result||1===e.result?e:2===e.result?(/\/(?:cv|cs|cr|cp|uwa|dp|co|cl|cu|up|cm)/.exec(t)&&Ge(ln("Check device password and try again.")),$.Deferred().reject({status:401})):32===e.result?$.Deferred().reject({status:404}):/\/(?:cv|cs|cr|cp|uwa|dp|co|cl|cu|up|cm)/.exec(t)?(48===e.result?Ge(ln("The selected station is already running or is scheduled to run.")):Ge(ln("Please check input and try again.")),$.Deferred().reject(e)):void 0}),(function(e){"timeout"!==e.statusText&&0!==e.status||!/\/(?:cv|cs|cr|cp|uwa|dp|co|cl|cu|cm)/.exec(t)?401===e.status&&Ge(ln("Check device password and try again.")):Ge(ln("Connection timed-out. Please try again."))}))}function F(){Wt(0,"red","<p class='running-text center'>"+ln("Network Error")+"</p>",(function(){Be("#weather,#footer-running"),At(),ht()}))}function z(){var t=$("#site-selector").val(),e="<div class='logo'></div><h1 style='padding-top:5px'>"+ln("Connecting to")+" "+t+"</h1><p class='cancel tight center inline-icon'><span class='btn-no-border ui-btn ui-icon-delete ui-btn-icon-notext'></span>Cancel</p>";$.mobile.loading("show",{html:e,textVisible:!0,theme:"b"}),$(".ui-loader").css({"box-shadow":"none","margin-top":"-4em"}).find(".cancel").one("click",(function(){$.ajaxq.abort("default"),Ee("#site-control",{transition:"none"})})),P={},_e(),L={},$.ajaxq.abort("default"),H((function(){var e,n=$(".weatherAdjust"),o=$(".changePassword");$.mobile.loading("hide"),function(){var t=function(t){m=t?a+t:"https://weather.opensprinkler.com",ht()};if(P.settings.wsp)return"weather.opensprinkler.com"===P.settings.wsp?void t():void t(P.settings.wsp);$.get(a+i+"/su").then((function(e){var n=e.match(/value="([\w|:|/|.]+)" name=wsp/);t(n?n[1]:void 0)}))}(),Ie(210)?n.css("display",""):n.hide(),le()||Ie(208)?o.css("display",""):o.hide(),$("#info-list").find("li[data-role='list-divider']").text(t),document.title="OpenSprinkler - "+t,Ie(200)&&("3.0"===Me()||le())&&$.getJSON("https://api.github.com/repos/opensprinkler/opensprinkler-firmware/releases").done((function(t){P.options.fwv<t[0].tag_name&&T("updateDismiss",(function(e){(!e.updateDismiss||e.updateDismiss<t[0].tag_name)&&we({title:ln("Firmware update available"),on:function(){var e=$(this).parent(),n=30===P.options.hwv||P.options.hwv>63&&Ie(216),o=t[0].html_url,s=$("<div data-role='popup' class='modal' data-theme='a'><h3 class='center' style='margin-bottom:0'>"+ln("Latest")+" "+ln("Firmware")+": "+t[0].name+"</h3><h5 class='center' style='margin:0'>"+ln("This Controller")+": "+Oe()+De()+"</h5><a class='iab ui-btn ui-corner-all ui-shadow' style='width:80%;margin:5px auto;' target='_blank' href='"+o+"'>"+ln("View Changelog")+"</a><a class='guide ui-btn ui-corner-all ui-shadow' style='width:80%;margin:5px auto;' href='#'>"+ln("Update Guide")+"</a>"+(n?"<a class='update ui-btn ui-corner-all ui-shadow' style='width:80%;margin:5px auto;' href='#'>"+ln("Update Now")+"</a>":"")+"<a class='dismiss ui-btn ui-btn-b ui-corner-all ui-shadow' style='width:80%;margin:5px auto;' href='#'>"+ln("Dismiss")+"</a></div>");s.find(".update").on("click",(function(){30!==P.options.hwv?B("/cv?pw=&update=1","json").then((function(){Ge(ln("Update successful")),s.find(".dismiss").click()}),(function(){$.mobile.loading("show",{html:"<div class='center'>"+ln("Update did not complete.")+"<br><a class='iab ui-btn' href='https://openthings.freshdesk.com/support/solutions/articles/5000631599-installing-and-updating-the-unified-firmware#upgrade'>"+ln("Update Guide")+"</a></div>",textVisible:!0,theme:"b"}),setTimeout((function(){$.mobile.loading("hide")}),3e3)})):$("<a class='hidden iab' href='"+a+i+"/update'></a>").appendTo(s).click()})),s.find(".guide").on("click",(function(){var t=P.options.hwv>63?"https://openthings.freshdesk.com/support/solutions/articles/5000631599-installing-and-updating-the-unified-firmware#upgrade":"https://openthings.freshdesk.com/support/solutions/articles/5000381694-opensprinkler-firmware-update-guide";$("<a class='hidden iab' href='"+t+"'></a>").appendTo(s).click()})),s.find(".dismiss").one("click",(function(){return I({updateDismiss:t[0].tag_name}),s.popup("close"),Se(e),!1})),Ne(s)}})}))})),"number"==typeof P.options.dexp&&P.options.dexp<255&&P.options.dexp>=0&&P.options.ext<P.options.dexp&&we({title:ln("Unused Expanders Detected"),desc:ln("Click here to enable all connected stations."),on:function(){return Se($(this).parent()),Ee("#os-options",{expandItem:"station"}),!1}}),Ie(213)&&255!==P.options.hwv&&(e=t,T(["sites"],(function(t){var n=Q(t.sites);if(!bn(s)){var i=md5(s);B("/sp?pw=&npw="+encodeURIComponent(i)+"&cpw="+encodeURIComponent(i),"json").done((function(t){var a=t.result;if(!a||a>1)return!1;n[e].os_pw=s=i,I({sites:JSON.stringify(n)},ue)}))}}))),"number"==typeof P.settings.eip&&function(t){if(0===t)return;var e=function(t){return(t>>24&255)+"."+(t>>16&255)+"."+(t>>8&255)+"."+(255&t)}(t),n=i.match(/.*:(\d+)/),o=function(){T("ignoreRemoteFailed",(function(t){"1"!==t.ignoreRemoteFailed&&we({title:ln("Remote access is not enabled"),desc:ln("Click here to troubleshoot remote access issues"),on:function(){var t=window.open("https://openthings.freshdesk.com/support/solutions/articles/5000569763","_blank","location="+(b?"yes":"no")+",enableViewportScale=yes,toolbarposition=top,closebuttoncaption="+ln("Back"));return v&&($.mobile.document.data("iabOpen",!0),t.addEventListener("exit",(function(){$.mobile.document.removeData("iabOpen")}))),!1},off:function(){return I({ignoreRemoteFailed:"1"}),!0}})}))};if(e===i||st(e)||!st(i))return;n=n?parseInt(n[1]):80,$.ajax({url:a+e+":"+n+"/jo?pw="+s,global:!1,dataType:"json",type:"GET"}).then((function(t){"object"!=typeof t||!t.hasOwnProperty("fwv")||t.fwv!==P.options.fwv||Ie(214)&&P.options.ip4!==t.ip4?o():T(["sites","current_site"],(function(t){var i=Q(t.sites);i[t.current_site].os_ip=e+(80===n?"":":"+n),I({sites:JSON.stringify(i)},ue)}))}),o)}(P.settings.eip),ye(),le()&&function(){if(!le())return;T("ignoreUnifiedFirmware",(function(t){"1"!==t.ignoreUnifiedFirmware&&we({title:ln("Unified firmware is now avaialble"),desc:ln("Click here for more details"),on:function(){var t=window.open("https://openthings.freshdesk.com/support/solutions/articles/5000631599","_blank","location="+(b?"yes":"no")+",enableViewportScale=yes,toolbarposition=top,closebuttoncaption="+ln("Back"));return v&&($.mobile.document.data("iabOpen",!0),t.addEventListener("exit",(function(){$.mobile.document.removeData("iabOpen")}))),!1},off:function(){return I({ignoreUnifiedFirmware:"1"}),!0}})}))}(),P.options.firstRun||ze(!0)}),(function(e){$.ajaxq.abort("default"),P={},$.mobile.loading("hide");var n=function(){"site-control"===$(".ui-page-active").attr("id")?i():($.mobile.document.one("pageshow",i),Ee("#site-control",{transition:"none"}))},i=function(){Ge(ln("Unable to connect to")+" "+t,3500)};"object"==typeof e&&401===e.status?($(".ui-popup-active").find("[data-role='popup']").popup("close"),de({fixIncorrect:!0,name:t,callback:z,cancel:n})):n()}))}function H(t,e){t=t||function(){},e=e||function(){};var n=function(){$("html").trigger("datarefresh"),Et(),t()};an()&&Ie(216)?B("/ja?pw=","json").then((function(t){if(void 0===t||$.isEmptyObject(t))e();else{var i=P.special;(P=t).special=i,P.status=P.status.sn,n()}}),e):$.when(J(),V(),G(),Y(),K()).then(n,e)}function J(t){return t=t||function(){},!0===n?B("/gp?d=0").done((function(e){for(var n,i,a=e.match(/(nprogs|nboards|mnp)=[\w|\d|.\"]+/g),o=/pd=\[\];(.*);/.exec(e),s={},r=0;r<a.length;r++)""!==a[r]&&(s[(n=a[r].split("="))[0]]=parseInt(n[1]));if(s.pd=[],null!==o)for(o=o[1].split(";"),r=0;r<o.length;r++)i=(i=(i=o[r].split("="))[1].replace("[","")).replace("]",""),s.pd[r]=Xe(i.split(","));P.programs=s,t()})):B("/jp?pw=","json").done((function(e){P.programs=e,t()}))}function V(t){return t=t||function(){},!0===n?B("/vs").done((function(e){var n=/snames=\[(.*?)\];/.exec(e),i=e.match(/(?:masop|mo)\s?[=|:]\s?\[(.*?)\]/);(n=n[1].split(",")).pop();for(var a=0;a<n.length;a++)n[a]=n[a].replace(/'/g,"");i=Xe(i[1].split(",")),P.stations={snames:n,masop:i,maxlen:n.length},t()})):B("/jn?pw=","json").done((function(e){P.stations=e,t()}))}function G(t){return t=t||function(){},!0===n?B("/vo").done((function(e){var n,i,a,o={};if(e.match(/var sd\s*=/)){for(var s=/(tz|htp|htp2|nbrd|seq|sdt|mas|mton|mtoff|urs|rst|wl|ipas)\s?[=|:]\s?([\w|\d|.\"]+)/gm;null!==(n=s.exec(e));)o[n[1].replace("nbrd","ext").replace("mtoff","mtof")]=+n[2];o.ext--,o.fwv="1.8.3-ospi"}else{var r=[1,2,12,13,14,15,16,17,18,19,20,21,22,23,25,26];for(n=(n=/var opts=\[(.*)\];/.exec(e))[1].replace(/"/g,"").split(","),i=0;i<n.length-1;i+=4)a=+n[i+3],-1!==$.inArray(a,r)&&(o[E[a]]=+n[i+2]);o.fwv=183}P.options=o,t()})):B("/jo?pw=","json").done((function(e){P.options=e,t()}))}function Y(t){return t=t||function(){},!0===n?B("/sn0").then((function(e){var n=e.toString().match(/\d+/);n=Xe(n[0].split("")),P.status=n,t()}),(function(){P.status=[]})):B("/js?pw=","json").then((function(e){P.status=e.sn,t()}),(function(){P.status=[]}))}function K(t){return t=t||function(){},!0===n?B("").then((function(t){var e,n,i=/(ver|devt|nbrd|tz|en|rd|rs|mm|rdst|urs)\s?[=|:]\s?([\w|\d|.\"]+)/gm,a=t.match(/loc\s?[=|:]\s?[\"|'](.*)[\"|']/),o=t.match(/lrun=\[(.*)\]/),s=t.match(/ps=\[(.*)\];/),r={};for(n=(s=s[1].split("],[")).length-1;n>=0;n--)s[n]=Xe(s[n].replace(/\[|\]/g,"").split(","));for(;null!==(e=i.exec(t));)r[e[1]]=+e[2];r.loc=a[1],r.ps=s,r.lrun=Xe(o[1].split(",")),P.settings=r}),(function(){if(P.settings&&P.stations){var t,e=[];for(t=0;t<P.stations.maxlen;t++)e.push([0,0]);P.settings.ps=e}})):B("/jc?pw=").then((function(e){if("object"!=typeof e)try{e=JSON.parse(e)}catch(t){var n=/,"wto":\{.*?\}/,i=e.match(n);e=e.replace(n,"");try{e=JSON.parse(e),function(t){if(he)return;we({title:ln("Weather Options have Corrupted"),desc:ln("Click here to retrieve the partial weather option data"),on:function(){var e=$(this).parent(),n=$("<div data-role='popup' data-theme='a' class='modal ui-content' id='weatherOptionCorruption'><h3 class='center'>"+ln("Weather option data has corrupted")+"</h3><h5 class='center'>"+ln("Please note this may indicate other data corruption as well, please verify all settings.")+"</h5><h6 class='center'>"+ln("Below is the corrupt data which could not be parsed but may be useful for restoration.")+"</h6><code>"+t[0].substr(7)+"</code><a class='ui-btn ui-corner-all ui-shadow red reset-options' style='width:80%;margin:5px auto;' href='#'>"+ln("Reset All Options")+"</a><a class='ui-btn ui-corner-all ui-shadow submit' style='width:80%;margin:5px auto;' href='#'>"+ln("Dismiss")+"</a></div>");return n.find(".submit").on("click",(function(){return Se(e),n.popup("close"),!1})),n.find(".reset-options").on("click",(function(){return Se(e),n.popup("close"),Vt((function(){Ge(ln("Settings have been saved"))})),!1})),Ne(n),!1}}),he=!0}(i)}catch(t){return!1}}if(void 0===e.lrun&&(e.lrun=[0,0,0,0]),e.loc.match(O)){var a=e.loc.split(",");A=[parseFloat(a[0]),parseFloat(a[1])]}P.settings=e,t()}),(function(){if(P.settings&&P.stations){var t,e=[];for(t=0;t<P.stations.maxlen;t++)e.push([0,0]);P.settings.ps=e}}))}function Z(t){return t=t||function(){},B("/je?pw=","json").then((function(e){P.special=e,t()}),(function(){P.special={}}))}function X(t){T(["sites","current_site","cloudToken"],(function(e){var d,c=e.sites,u=e.current_site;if(c=Q(c),(d=Object.keys(c)).length){if(null===u||!(u in c))return $.mobile.loading("hide"),void Ee("#site-control",{transition:t?"none":void 0});it(d,u),i=c[u].os_ip,s=c[u].os_pw,a=void 0!==c[u].ssl&&"1"===c[u].ssl?"https://":"http://",void 0!==c[u].auth_user&&void 0!==c[u].auth_pw?(o=!0,r=c[u].auth_user,l=c[u].auth_pw):o=!1,n=!!c[u].is183,z()}else t&&(void 0===e.cloudToken||null===e.cloudToken?Ee("#start",{transition:"none"}):Ee("#site-control",{transition:"none"}))}))}function Q(t){return null==t?{}:JSON.parse(t)}function tt(t,e){$("#addnew").popup("destroy").remove();var d=!!t,c=$("<div data-role='popup' id='addnew' data-theme='a' data-overlay-theme='b'><div data-role='header' data-theme='b'><h1>"+ln("New Device")+"</h1></div><div class='ui-content' id='addnew-content'><form method='post' novalidate>"+(d?"":"<p class='center smaller'>"+ln("Note: The name is used to identify the OpenSprinkler within the app. OpenSprinkler IP can be either an IP or hostname. You can also specify a port by using IP:Port")+"</p>")+"<label for='os_name'>"+ln("Open Sprinkler Name:")+"</label><input autocorrect='off' spellcheck='false' type='text' name='os_name' id='os_name' placeholder='Home'>"+(d?"":"<label for='os_ip'>"+ln("Open Sprinkler IP:")+"</label>")+"<input "+(d?"data-role='none' style='display:none' ":"")+"autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' type='url' pattern='' name='os_ip' id='os_ip' value='"+(d?t:"")+"' placeholder='home.dyndns.org'><label for='os_pw'>"+ln("Open Sprinkler Password:")+"</label><input type='password' name='os_pw' id='os_pw' value=''><label for='save_pw'>"+ln("Save Password")+"</label><input type='checkbox' data-wrapper-class='save_pw' name='save_pw' id='save_pw' data-mini='true' checked='checked'>"+(d?"":"<div data-theme='a' data-mini='true' data-role='collapsible'><h4>"+ln("Advanced")+"</h4><fieldset data-role='controlgroup' data-type='horizontal' data-mini='true' class='center'><input type='checkbox' name='os_usessl' id='os_usessl'><label for='os_usessl'>"+ln("Use SSL")+"</label><input type='checkbox' name='os_useauth' id='os_useauth'><label for='os_useauth'>"+ln("Use Auth")+"</label></fieldset></div>")+"<input type='submit' data-theme='b' value='"+ln("Submit")+"'></form></div></div>");return c.find("form").on("submit",(function(){return function t(e,d){document.activeElement.blur(),$.mobile.loading("show");var c,u=$.mobile.path.parseUrl($("#os_ip").val()).hrefNoHash.replace(/https?:\/\//,""),p=function(t,c){var p;if($.mobile.loading("hide"),("string"==typeof t&&t.match(/var (en|sd)\s*=/)||"number"==typeof t.fwv&&203===t.fwv)&&(p=!0),void 0!==t.fwv||!0===p){var f=$("#os_name").val(),h=$("#os_pw").val(),m=$("#save_pw").is(":checked");""===f&&(f="Site "+(Object.keys(c).length+1)),c[f]={},c[f].os_ip=i=u,"number"==typeof t.fwv&&t.fwv>=213&&"number"==typeof t.wl&&(h=md5(h)),c[f].os_pw=m?h:"",s=h,e?(c[f].ssl="1",a="https://"):a="http://",d?(c[f].auth_user=$("#os_auth_user").val(),c[f].auth_pw=$("#os_auth_pw").val(),o=!0,r=c[f].auth_user,l=c[f].auth_pw):o=!1,!0===p&&(c[f].is183="1",n=!0),$("#os_name,#os_ip,#os_pw,#os_auth_user,#os_auth_pw").val(""),I({sites:JSON.stringify(c),current_site:f},(function(){ue(),it(Object.keys(c),f),z()}))}else Ge(ln("Check IP/Port and try again."))},f=function(n){d||401!==n.status?e?($.mobile.loading("hide"),Ge(ln("Check IP/Port and try again."))):t(!0):h()},h=function(){$("#addnew-auth").length?t(e,!0):v()},m=function(){return btoa($("#os_auth_user").val()+":"+$("#os_auth_pw").val())},v=function(){$.mobile.loading("hide");var n=$("<div class='ui-content' id='addnew-auth'><form method='post' novalidate><p class='center smaller'>"+ln("Authorization Required")+"</p><label for='os_auth_user'>"+ln("Username:")+"</label><input autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' type='text' name='os_auth_user' id='os_auth_user'><label for='os_auth_pw'>"+ln("Password:")+"</label><input type='password' name='os_auth_pw' id='os_auth_pw'><input type='submit' value='"+ln("Submit")+"'></form></div>").enhanceWithin();n.on("submit","form",(function(){return t(e,!0),!1})),$("#addnew-content").hide(),$("#addnew").append(n).popup("reposition",{positionTo:"window"})};u?!0!==d&&$("#os_useauth").is(":checked")?h():(!0===$("#os_usessl").is(":checked")&&(e=!0),c=e?"https://":"http://",d&&($("#addnew-auth").hide(),$("#addnew-content").show(),$("#addnew").popup("reposition",{positionTo:"window"})),$.ajax({url:c+u+"/jo?pw="+md5($("#os_pw").val()),type:"GET",dataType:"json",timeout:1e4,global:!1,beforeSend:function(t){d&&t.setRequestHeader("Authorization","Basic "+m())},error:function(t){d||401!==t.status?$.ajax({url:c+u,type:"GET",dataType:"text",timeout:1e4,global:!1,cache:!0,beforeSend:function(t){d&&t.setRequestHeader("Authorization","Basic "+m())},success:function(t){T("sites",(function(e){var n=Q(e.sites);p(t,n)}))},error:f}):h()},success:function(t){T("sites",(function(e){var n=Q(e.sites);p(t,n)}))}})):Ge(ln("An IP address is required to continue."))}(),!1})),c.one("popupafterclose",(function(){$(this).popup("destroy").remove()})).popup({history:!1,positionTo:"window"}).enhanceWithin(),e?$(".ui-popup-active").children().first().one("popupafterclose",(function(){c.popup("open")})).popup("close"):c.popup("open"),Ye(c),c.find(".ui-collapsible-heading-toggle").on("click",(function(){var t=$(this).parents(".ui-collapsible").hasClass("ui-collapsible-collapsed"),e=$(".ui-page-active"),n=parseInt(e.css("min-height"));t?e.css("min-height",n+65+"px"):e.css("min-height",n-65+"px"),c.popup("reposition",{positionTo:"window"})})),!1}$(document).one("deviceready",(function(){try{StatusBar.overlaysWebView(!1),StatusBar.styleLightContent(),StatusBar.backgroundColorByHexString(D),$.mobile.window.on("statusTap",(function(){$("body, html").animate({scrollTop:0},700)}))}catch(t){}setTimeout((function(){try{navigator.splashscreen.hide()}catch(t){}}),500),$.mobile.document.on("backbutton",(function(){return v&&$.mobile.document.data("iabOpen")||Je(),!1})),ot(),g&&ThreeDeeTouch.isAvailable((function(t){t&&(ThreeDeeTouch.enableLinkPreview(),ThreeDeeTouch.configureQuickActions([{type:"sites",title:ln("Manage Sites"),iconType:"Location"},{type:"addprogram",title:ln("Add Program"),iconType:"Add"},{type:"stopall",title:ln("Stop All Stations"),iconType:"Pause"}]),ThreeDeeTouch.onHomeIconPressed=function(t){"sites"===t.type?Ee("#site-control"):"addprogram"===t.type?Ee("#addprogram"):"stopall"===t.type&&Ce()})}))})).one("mobileinit",(function(){(x||"file:"===window.location.protocol)&&($.mobile.hashListeningEnabled=!1),$.support.cors=!0,$.mobile.allowCrossDomainPages=!0,T("isMetric",(function(t){switch(t.isMetric){case"true":C=!0;break;case"false":C=!1}}))})).on("pagebeforechange",(function(t,e){var n,i=e.toPage,a=$(".ui-page-active");"string"==typeof e.toPage&&(n=$.mobile.path.parseUrl(i).hash,a.length>0&&n==="#"+a.attr("id")||("popup"===e.options.role||$(".ui-popup-active").length||$.mobile.silentScroll(0),"#programs"===n?Gt(e.options.programToExpand):"#addprogram"===n?function(t){t=t>=0?t:"new";var e=$("<div data-role='page' id='addprogram'><div class='ui-content' role='main' id='newprogram'><fieldset id='program-new'></fieldset></div></div>"),n=qe({title:ln("Add Program"),leftBtn:{icon:"carat-l",text:ln("Back"),class:"ui-toolbar-back-btn",on:Je},rightBtn:{icon:"check",text:ln("Submit"),on:function(){return ne("new"),!1}}});e.find("#program-new").html(ee(t,!0)).one("change input",(function(){n.eq(2).prop("disabled",!1).addClass("hasChanges")})),e.find("[id^='submit-']").on("click",(function(){return ne("new"),!1})),e.one("pagehide",(function(){e.remove()})),"string"==typeof t&&n.eq(2).prop("disabled",!0);$("#addprogram").remove(),$.mobile.pageContainer.append(e)}(e.options.copyID):"#manual"===n?Lt():"#about"===n?se():"#runonce"===n?qt():"#os-options"===n?function(t){var e,n,i,a="",o=$("<div data-role='page' id='os-options'><div class='ui-content' role='main'><div data-role='collapsibleset' id='os-options-list'></div><a class='submit preventBack' style='display:none'></a></div></div>"),s=function(t,e,n){return"<div class='ui-field-contain'><fieldset data-role='controlgroup' class='ui-mini center sensor-options' data-type='horizontal'><legend class='left'>"+ln("Sensor")+(n?" "+n+" ":" ")+ln("Type")+"</legend><input class='noselect' type='radio' name='o"+t+"' id='o"+t+"-none' value='0'"+(0===e?" checked='checked'":"")+"><label for='o"+t+"-none'>"+ln("None")+"</label><input class='noselect' type='radio' name='o"+t+"' id='o"+t+"-rain' value='1'"+(1===e?" checked='checked'":"")+"><label for='o"+t+"-rain'>"+ln("Rain")+"</label>"+(52===t?"":"<input class='noselect' type='radio' name='o"+t+"' id='o"+t+"-flow' value='2'"+(2===e?" checked='checked'":"")+"><label for='o"+t+"-flow'>"+ln("Flow")+"</label>")+(Ie(219)?"<input class='noselect' type='radio' name='o"+t+"' id='o"+t+"-soil' value='3'"+(3===e?" checked='checked'":"")+"><label for='o"+t+"-soil'>"+ln("Soil")+"</label>":"")+(Ie(217)?"<input class='noselect' type='radio' name='o"+t+"' id='o"+t+"-program' value='240'"+(240===e?" checked='checked'":"")+"><label for='o"+t+"-program'>"+ln("Program Switch")+"</label>":"")+"</fieldset></div>"},r=function(){var t,e={},n=!1,i=le(),a=l.eq(2);if(a.prop("disabled",!0),o.find(".submit").removeClass("hasChanges"),o.find("#os-options-list").find(":input,button").filter(":not(.noselect)").each((function(){var a,s=$(this),r=s.attr("id"),l=s.val();if(!r||!l&&""!==l)return!0;switch(r){case"o1":var d=l.split(":");d[0]=parseInt(d[0],10),d[1]=parseInt(d[1],10),d[1]=(d[1]/15>>0)/4,d[0]=d[0]+(d[0]>=0?d[1]:-d[1]),l=4*(d[0]+12)>>0;break;case"datetime":var c=new Date(1e3*l);return e.tyy=c.getUTCFullYear(),e.tmm=c.getUTCMonth(),e.tdd=c.getUTCDate(),e.thh=c.getUTCHours(),e.tmi=c.getUTCMinutes(),e.ttt=Math.round(c.getTime()/1e3),!0;case"ip_addr":return"0.0.0.0"===(a=l.split("."))?(Ge(ln("A valid IP address is required when DHCP is not used")),n=!0,!1):(e.o4=a[0],e.o5=a[1],e.o6=a[2],e.o7=a[3],!0);case"subnet":return"0.0.0.0"===(a=l.split("."))?(Ge(ln("A valid subnet address is required when DHCP is not used")),n=!0,!1):(e.o58=a[0],e.o59=a[1],e.o60=a[2],e.o61=a[3],!0);case"gateway":return"0.0.0.0"===(a=l.split("."))?(Ge(ln("A valid gateway address is required when DHCP is not used")),n=!0,!1):(e.o8=a[0],e.o9=a[1],e.o10=a[2],e.o11=a[3],!0);case"dns":return"0.0.0.0"===(a=l.split("."))?(Ge(ln("A valid DNS address is required when DHCP is not used")),n=!0,!1):(e.o44=a[0],e.o45=a[1],e.o46=a[2],e.o47=a[3],!0);case"ntp_addr":return a=l.split("."),e.o32=a[0],e.o33=a[1],e.o34=a[2],e.o35=a[3],!0;case"wtkey":return!0;case"wto":if(l=mn($.extend({},vn(l),{key:o.find("#wtkey").val()})),mn(P.settings.wto)===l)return!0;break;case"isMetric":return C=s.is(":checked"),I({isMetric:C}),!0;case"o12":return i||(e.o12=255&l,e.o13=l>>8&255),!0;case"o31":if(3===parseInt(l)&&!vn($("#wto")[0].value).baseETo)return Ge(ln("You must specify a baseline ETo adjustment method option to use the ET adjustment method.")),n=!0,!1;var u=o.find("#weatherRestriction");u.length&&(l=function(t,e){e=e||-129&P.options.uwt,1===t&&(e|=128);return e}(parseInt(u.val()),l));break;case"o18":case"o37":parseInt(l)>8*(parseInt(o.find("#o15").val())+1)&&(l=0);break;case"o41":return"gallon"===o.find("#o41-units").val()?l*=3.78541:"milliliter"===o.find("#o41-units").val()&&(l/=1e3),e.o41=100*l&255,e.o42=100*l>>8&255,!0;case"o2":case"o3":case"o14":case"o16":case"o21":case"o22":case"o25":case"o36":case"o48":case"o50":case"o51":case"o52":case"o53":if(l=s.is(":checked")?1:0,!Ie(219)&&!l)return!0}i&&("loc"===r||"lg"===r?r="o"+r:(t=/\d+/.exec(r),r="o"+Object.keys(E).find((function(e){return E[e]===t})))),!0===Ie(208)&&"loc"===r&&(l=l.replace(/\s/g,"_")),e[r]=l})),n)return a.prop("disabled",!1),void o.find(".submit").addClass("hasChanges");void 0!==P.options.fpr0&&(void 0!==P.options.urs?e.o21=o.find("input[name='o21'][type='radio']:checked").val():(void 0!==P.options.sn1t&&(e.o50=o.find("input[name='o50'][type='radio']:checked").val()),void 0!==P.options.sn2t&&(e.o52=o.find("input[name='o52'][type='radio']:checked").val()))),e=kn(e),$.mobile.loading("show"),B("/co?pw=&"+$.param(e)).done((function(){$.mobile.document.one("pageshow",(function(){Ge(ln("Settings have been saved"))})),He(),H(ht)})).fail((function(){a.prop("disabled",!1),o.find(".submit").addClass("hasChanges")}))},l=qe({title:ln("Edit Options"),leftBtn:{icon:"carat-l",text:ln("Back"),class:"ui-toolbar-back-btn",on:Je},rightBtn:{icon:"check",text:ln("Submit"),class:"submit",on:r}});o.find(".submit").on("click",r),a="<fieldset data-role='collapsible'"+("string"!=typeof t||"system"===t?" data-collapsed='false'":"")+"><legend>"+ln("System")+"</legend>",void 0!==P.options.ntp&&(a+="<div class='ui-field-contain datetime-input'><label for='datetime'>"+ln("Device Time")+"</label><button "+(P.options.ntp?"disabled ":"")+"data-mini='true' id='datetime' value='"+(P.settings.devt+60*new Date(1e3*P.settings.devt).getTimezoneOffset())+"'>"+wn(new Date(1e3*P.settings.devt)).slice(0,-3)+"</button></div>");if(!le()&&void 0!==P.options.tz){for(e=["-12:00","-11:30","-11:00","-10:00","-09:30","-09:00","-08:30","-08:00","-07:00","-06:00","-05:00","-04:30","-04:00","-03:30","-03:00","-02:30","-02:00","+00:00","+01:00","+02:00","+03:00","+03:30","+04:00","+04:30","+05:00","+05:30","+05:45","+06:00","+06:30","+07:00","+08:00","+08:45","+09:00","+09:30","+10:00","+10:30","+11:00","+11:30","+12:00","+12:45","+13:00","+13:45","+14:00"],n=((n=P.options.tz-48)>=0?"+":"-")+sn(Math.abs(n)/4>>0)+":"+(Math.abs(n)%4*15/10>>0)+Math.abs(n)%4*15%10,a+="<div class='ui-field-contain'><label for='o1' class='select'>"+ln("Timezone")+"</label><select "+(Ie(210)&&"object"==typeof f?"disabled='disabled' ":"")+"data-mini='true' id='o1'>",i=0;i<e.length;i++)a+="<option "+(e[i]===n?"selected":"")+" value='"+e[i]+"'>"+e[i]+"</option>";a+="</select></div>"}a+="<div class='ui-field-contain'><label for='loc'>"+ln("Location")+"</label><button data-mini='true' id='loc' value='"+("''"===P.settings.loc.trim()?ln("Not specified"):P.settings.loc)+"'><span>"+P.settings.loc+"</span><a class='ui-btn btn-no-border ui-btn-icon-notext ui-icon-delete ui-btn-corner-all clear-loc'></a></button></div>",void 0!==P.options.lg&&(a+="<label for='o36'><input data-mini='true' id='o36' type='checkbox' "+(1===P.options.lg?"checked='checked'":"")+">"+ln("Enable Logging")+"</label>");if(a+="<label for='isMetric'><input data-mini='true' id='isMetric' type='checkbox' "+(C?"checked='checked'":"")+">"+ln("Use Metric")+"</label>",a+="</fieldset><fieldset data-role='collapsible'"+("string"==typeof t&&"master"===t?" data-collapsed='false'":"")+"><legend>"+ln("Configure Master")+"</legend>",void 0!==P.options.mas){for(a+="<div class='ui-field-contain ui-field-no-border'><label for='o18' class='select'>"+ln("Master Station")+" "+(void 0!==P.options.mas2?"1":"")+"</label><select data-mini='true' id='o18'><option value='0'>"+ln("None")+"</option>",i=0;i<P.stations.snames.length&&(a+="<option "+(1===Dt(i)?"selected":"")+" value='"+(i+1)+"'>"+P.stations.snames[i]+"</option>",Ie(214)||7!==i);i++);a+="</select></div>",void 0!==P.options.mton&&(a+="<div "+(0===P.options.mas?"style='display:none' ":"")+"class='ui-field-no-border ui-field-contain duration-field'><label for='o19'>"+ln("Master On Adjustment")+"</label><button data-mini='true' id='o19' value='"+P.options.mton+"'>"+P.options.mton+"s</button></div>"),void 0!==P.options.mtof&&(a+="<div "+(0===P.options.mas?"style='display:none' ":"")+"class='ui-field-no-border ui-field-contain duration-field'><label for='o20'>"+ln("Master Off Adjustment")+"</label><button data-mini='true' id='o20' value='"+P.options.mtof+"'>"+P.options.mtof+"s</button></div>")}if(void 0!==P.options.mas2){for(a+="<hr style='width:95%' class='content-divider'>",a+="<div class='ui-field-contain ui-field-no-border'><label for='o37' class='select'>"+ln("Master Station")+" 2</label><select data-mini='true' id='o37'><option value='0'>"+ln("None")+"</option>",i=0;i<P.stations.snames.length&&(a+="<option "+(2===Dt(i)?"selected":"")+" value='"+(i+1)+"'>"+P.stations.snames[i]+"</option>",Ie(214)||7!==i);i++);a+="</select></div>",void 0!==P.options.mton2&&(a+="<div "+(0===P.options.mas2?"style='display:none' ":"")+"class='ui-field-no-border ui-field-contain duration-field'><label for='o38'>"+ln("Master On Delay")+"</label><button data-mini='true' id='o38' value='"+P.options.mton2+"'>"+P.options.mton2+"s</button></div>"),void 0!==P.options.mtof2&&(a+="<div "+(0===P.options.mas2?"style='display:none' ":"")+"class='ui-field-no-border ui-field-contain duration-field'><label for='o39'>"+ln("Master Off Delay")+"</label><button data-mini='true' id='o39' value='"+P.options.mtof2+"'>"+P.options.mtof2+"s</button></div>")}if(a+="</fieldset><fieldset data-role='collapsible'"+("string"==typeof t&&"station"===t?" data-collapsed='false'":"")+"><legend>"+ln("Station Handling")+"</legend>",void 0!==P.options.ext){for(a+="<div class='ui-field-contain'><label for='o15' class='select'>"+ln("Number of Stations")+("number"==typeof P.options.dexp&&P.options.dexp<255&&P.options.dexp>=0?" <span class='nobr'>("+(8*P.options.dexp+8)+" "+ln("available")+")</span>":"")+"</label><select data-mini='true' id='o15'>",i=0;i<=(P.options.mexp||5);i++)a+="<option "+(P.options.ext===i?"selected":"")+" value='"+i+"'>"+(8*i+8)+" "+ln("stations")+"</option>";a+="</select></div>"}void 0!==P.options.sdt&&(a+="<div class='ui-field-contain duration-field'><label for='o17'>"+ln("Station Delay")+"</label><button data-mini='true' id='o17' value='"+P.options.sdt+"'>"+nn(en(P.options.sdt))+"</button></div>");a+="<label for='showDisabled'><input data-mini='true' class='noselect' id='showDisabled' type='checkbox' "+("true"===localStorage.showDisabled?"checked='checked'":"")+">"+ln("Show Disabled")+" "+ln("(Changes Auto-Saved)")+"</label>",void 0!==P.options.seq&&(a+="<label for='o16'><input data-mini='true' id='o16' type='checkbox' "+(1===P.options.seq?"checked='checked'":"")+">"+ln("Sequential")+"</label>");if(a+="</fieldset><fieldset data-role='collapsible'"+("string"==typeof t&&"weather"===t?" data-collapsed='false'":"")+"><legend>"+ln("Weather and Sensors")+"</legend>",void 0!==P.options.uwt){for(a+="<div class='ui-field-contain'><label for='o31' class='select'>"+ln("Weather Adjustment Method")+"<button data-helptext='"+ln("Weather adjustment uses OpenWeatherMaps data in conjunction with the selected method to adjust the watering percentage.")+"' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><select data-mini='true' id='o31'>",i=0;i<$t().length;i++){var d=$t()[i];d.minVersion&&!Ie(d.minVersion)||(a+="<option "+(d.id===xt()?"selected":"")+" value='"+i+"'>"+d.name+"</option>")}if(a+="</select></div>","object"==typeof P.settings.wto&&(a+="<div class='ui-field-contain"+(0===xt()?" hidden":"")+"'><label for='wto'>"+ln("Adjustment Method Options")+"</label><button data-mini='true' id='wto' value='"+mn(P.settings.wto)+"'>"+ln("Tap to Configure")+"</button></div>"),Ie(214)){for(a+="<div class='ui-field-contain'><label for='weatherRestriction' class='select'>"+ln("Weather-Based Restrictions")+"<button data-helptext='"+ln("Prevents watering when the selected restriction is met.")+"' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><select data-mini='true' class='noselect' id='weatherRestriction'>",i=0;i<2;i++){var c=(u=i,[{isCurrent:0,name:ln("None")},{isCurrent:!!(P.options.uwt>>7&1),name:ln("California Restriction")}][u]);a+="<option "+(!0===c.isCurrent?"selected":"")+" value='"+i+"'>"+c.name+"</option>"}a+="</select></div>"}}var u;void 0!==P.options.wl&&(a+="<div class='ui-field-contain duration-field'><label for='o23'>"+ln("% Watering")+"<button data-helptext='"+ln("The watering percentage scales station run times by the set value. When weather adjustment is used the watering percentage is automatically adjusted.")+"' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><button "+(P.options.uwt&&xt()>0?"disabled='disabled' ":"")+"data-mini='true' id='o23' value='"+P.options.wl+"'>"+P.options.wl+"%</button></div>");void 0===P.options.urs&&void 0===P.options.sn1t||(void 0!==P.options.fpr0?a+=void 0!==P.options.urs?s(E.urs,P.options.urs):void 0!==P.options.sn1t?s(E.sn1t,P.options.sn1t,1):"":a+="<label for='o21'><input data-mini='true' id='o21' type='checkbox' "+(1===P.options.urs?"checked='checked'":"")+">"+ln("Use Rain Sensor")+"</label>");void 0!==P.options.rso&&(a+="<label for='o22'><input "+(1===P.options.urs||240===P.options.urs?"":"data-wrapper-class='hidden' ")+"data-mini='true' id='o22' type='checkbox' "+(1===P.options.rso?"checked='checked'":"")+">"+ln("Normally Open")+"</label>");void 0!==P.options.sn1o&&(a+="<label for='o51'><input "+(1===P.options.sn1t||3===P.options.sn1t||240===P.options.sn1t?"":"data-wrapper-class='hidden' ")+"data-mini='true' id='o51' type='checkbox' "+(1===P.options.sn1o?"checked='checked'":"")+">"+ln("Normally Open")+"</label>");void 0!==P.options.fpr0&&(a+="<div class='ui-field-contain"+(2===P.options.urs||2===P.options.sn1t?"":" hidden")+"'><label for='o41'>"+ln("Flow Pulse Rate")+"</label><table><tr style='width:100%;vertical-align: top;'><td style='width:100%'><div class='ui-input-text controlgroup-textinput ui-btn ui-body-inherit ui-corner-all ui-mini ui-shadow-inset ui-input-has-clear'><input data-role='none' data-mini='true' type='number' pattern='^[-+]?[0-9]*.?[0-9]*$' id='o41' value='"+(256*P.options.fpr1+P.options.fpr0)/100+"'></div></td><td class='tight-select'><select id='o41-units' class='noselect' data-mini='true'><option selected='selected' value='liter'>L/pulse</option><option value='milliliter'>mL/pulse</option><option value='gallon'>Gal/pulse</option></select></td></tr></table></div>");void 0!==P.options.sn1on&&(a+="<div class='"+(1===P.options.sn1t||3===P.options.sn1t?"":"hidden ")+"ui-field-no-border ui-field-contain duration-field'><label for='o54'>"+ln("Sensor 1 Delayed On Time")+"</label><button data-mini='true' id='o54' value='"+P.options.sn1on+"'>"+P.options.sn1on+"m</button></div>");void 0!==P.options.sn1of&&(a+="<div class='"+(1===P.options.sn1t||3===P.options.sn1t?"":"hidden ")+"ui-field-no-border ui-field-contain duration-field'><label for='o55'>"+ln("Sensor 1 Delayed Off Time")+"</label><button data-mini='true' id='o55' value='"+P.options.sn1of+"'>"+P.options.sn1of+"m</button></div>");Ie(217)&&(a+="<label id='prgswitch' class='center smaller"+(240===P.options.urs||240===P.options.sn1t||240===P.options.sn2t?"":" hidden")+"'>"+ln("When using program switch, a switch is connected to the sensor port to trigger Program 1 every time the switch is pressed for at least 1 second.")+"</label>");void 0!==P.options.sn2t&&Ie(219)&&(a+=s(E.sn2t,P.options.sn2t,2));void 0!==P.options.sn2o&&(a+="<label for='o53'><input "+(1===P.options.sn2t||3===P.options.sn2t||240===P.options.sn2t?"":"data-wrapper-class='hidden' ")+"data-mini='true' id='o53' type='checkbox' "+(1===P.options.sn2o?"checked='checked'":"")+">"+ln("Normally Open")+"</label>");void 0!==P.options.sn2on&&(a+="<div class='"+(1===P.options.sn2t||3===P.options.sn2t?"":"hidden ")+"ui-field-no-border ui-field-contain duration-field'><label for='o56'>"+ln("Sensor 2 Delayed On Time")+"</label><button data-mini='true' id='o56' value='"+P.options.sn2on+"'>"+P.options.sn2on+"m</button></div>");void 0!==P.options.sn2of&&(a+="<div class='"+(1===P.options.sn2t||3===P.options.sn2t?"":"hidden ")+"ui-field-no-border ui-field-contain duration-field'><label for='o57'>"+ln("Sensor 2 Delayed Off Time")+"</label><button data-mini='true' id='o57' value='"+P.options.sn2of+"'>"+P.options.sn2of+"m</button></div>");void 0!==P.options.sn2t&&(a+="<label id='prgswitch-2' class='center smaller"+(240===P.options.urs||240===P.options.sn1t||240===P.options.sn2t?"":" hidden")+"'>"+ln("When using program switch, a switch is connected to the sensor port to trigger Program 2 every time the switch is pressed for at least 1 second.")+"</label>");void 0!==P.settings.ifkey&&(a+="</fieldset><fieldset data-role='collapsible'"+("string"==typeof t&&"integrations"===t?" data-collapsed='false'":"")+"><legend>"+ln("Integrations")+"</legend>",a+="<div class='ui-field-contain'><label for='ifkey'>"+ln("IFTTT Key")+"<button data-helptext='"+ln("To enable IFTTT, a Maker channel key is required which can be obtained from https://ifttt.com")+"' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><input autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' data-mini='true' type='text' id='ifkey' value='"+P.settings.ifkey+"'></div>",a+="<div class='ui-field-contain'><label for='o49'>"+ln("IFTTT Events")+"<button data-helptext='"+ln("Select which events to send to IFTTT for use in recipes.")+"' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><button data-mini='true' id='o49' value='"+P.options.ife+"'>Configure Events</button></div>");a+="</fieldset><fieldset class='full-width-slider' data-role='collapsible'"+("string"==typeof t&&"lcd"===t?" data-collapsed='false'":"")+"><legend>"+ln("LCD Screen")+"</legend>",void 0!==P.options.con&&(a+="<div class='ui-field-contain'><label for='o27'>"+ln("Contrast")+"</label><input type='range' id='o27' min='0' max='255' step='10' data-highlight='true' value='"+P.options.con+"'></div>");void 0!==P.options.lit&&(a+="<div class='ui-field-contain'><label for='o28'>"+ln("Brightness")+"</label><input type='range' id='o28' min='0' max='255' step='10' data-highlight='true' value='"+P.options.lit+"'></div>");void 0!==P.options.dim&&(a+="<div class='ui-field-contain'><label for='o29'>"+ln("Idle Brightness")+"</label><input type='range' id='o29' min='0' max='255' step='10' data-highlight='true' value='"+P.options.dim+"'></div>");a+="</fieldset><fieldset data-role='collapsible' data-theme='b'"+("string"==typeof t&&"advanced"===t?" data-collapsed='false'":"")+"><legend>"+ln("Advanced")+"</legend>",Ie(219)&&void 0!==P.options.uwt&&"object"==typeof P.settings.wto&&(a+="<div class='ui-field-contain'><label for='wtkey'>"+ln("Wunderground Key").replace("Wunderground","Wunder&shy;ground")+"<button data-helptext='"+ln("We use OpenWeatherMap normally however with a user provided API key the weather source will switch to Weather Underground.")+"' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><table><tr style='width:100%;vertical-align: top;'><td style='width:100%'><div class='"+(P.settings.wto.key&&""!==P.settings.wto.key?"green ":"")+"ui-input-text controlgroup-textinput ui-btn ui-body-inherit ui-corner-all ui-mini ui-shadow-inset ui-input-has-clear'><input data-role='none' data-mini='true' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' type='text' id='wtkey' value='"+(P.settings.wto.key||"")+"'><a href='#' tabindex='-1' aria-hidden='true' data-helptext='"+ln("An invalid API key has been detected.")+"' class='hidden help-icon ui-input-clear ui-btn ui-icon-alert ui-btn-icon-notext ui-corner-all'></a></div></td><td><button class='noselect' data-mini='true' id='verify-api'>"+ln("Verify")+"</button></td></tr></table></div>");void 0!==P.options.hp0&&(a+="<div class='ui-field-contain'><label for='o12'>"+ln("HTTP Port (restart required)")+"</label><input data-mini='true' type='number' pattern='[0-9]*' id='o12' value='"+(256*P.options.hp1+P.options.hp0)+"'></div>");void 0!==P.options.devid&&(a+="<div class='ui-field-contain'><label for='o26'>"+ln("Device ID (restart required)")+"<button data-helptext='"+ln("Device ID modifies the last byte of the MAC address.")+"' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><input data-mini='true' type='number' pattern='[0-9]*' max='255' id='o26' value='"+P.options.devid+"'></div>");void 0!==P.options.rlp?a+="<div class='ui-field-contain duration-field'><label for='o30'>"+ln("Relay Pulse")+"<button data-helptext='"+ln("Relay pulsing is used for special situations where rapid pulsing is needed in the output with a range from 1 to 2000 milliseconds. A zero value disables the pulsing option.")+"' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><button data-mini='true' id='o30' value='"+P.options.rlp+"'>"+P.options.rlp+"ms</button></div>":!0!==Ie(215)&&void 0!==P.options.bst&&(a+="<div class='ui-field-contain duration-field'><label for='o30'>"+ln("Boost Time")+"<button data-helptext='"+ln("Boost time changes how long the boost converter is activated with a range from 0 to 1000 milliseconds.")+"' class='help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></label><button data-mini='true' id='o30' value='"+P.options.bst+"'>"+P.options.bst+"ms</button></div>");if(void 0!==P.options.ntp&&Ie(210)){var p=[P.options.ntp1,P.options.ntp2,P.options.ntp3,P.options.ntp4].join(".");a+="<div class='"+(1===P.options.ntp?"":"hidden ")+"ui-field-contain duration-field'><label for='ntp_addr'>"+ln("NTP IP Address")+"</label><button data-mini='true' id='ntp_addr' value='"+p+"'>"+p+"</button></div>"}if(void 0!==P.options.dhcp&&Ie(210)){var h=[P.options.ip1,P.options.ip2,P.options.ip3,P.options.ip4].join("."),v=[P.options.gw1,P.options.gw2,P.options.gw3,P.options.gw4].join(".");if(a+="<div class='"+(1===P.options.dhcp?"hidden ":"")+"ui-field-contain duration-field'><label for='ip_addr'>"+ln("IP Address")+"</label><button data-mini='true' id='ip_addr' value='"+h+"'>"+h+"</button></div>",a+="<div class='"+(1===P.options.dhcp?"hidden ":"")+"ui-field-contain duration-field'><label for='gateway'>"+ln("Gateway Address")+"</label><button data-mini='true' id='gateway' value='"+v+"'>"+v+"</button></div>",void 0!==P.options.subn1){var b=[P.options.subn1,P.options.subn2,P.options.subn3,P.options.subn4].join(".");a+="<div class='"+(1===P.options.dhcp?"hidden ":"")+"ui-field-contain duration-field'><label for='subnet'>"+ln("Subnet Mask")+"</label><button data-mini='true' id='subnet' value='"+b+"'>"+b+"</button></div>"}if(void 0!==P.options.dns1){var g=[P.options.dns1,P.options.dns2,P.options.dns3,P.options.dns4].join(".");a+="<div class='"+(1===P.options.dhcp?"hidden ":"")+"ui-field-contain duration-field'><label for='dns'>"+ln("DNS Address")+"</label><button data-mini='true' id='dns' value='"+g+"'>"+g+"</button></div>"}a+="<label for='o3'><input data-mini='true' id='o3' type='checkbox' "+(1===P.options.dhcp?"checked='checked'":"")+">"+ln("Use DHCP (restart required)")+"</label>"}void 0!==P.options.ntp&&(a+="<label for='o2'><input data-mini='true' id='o2' type='checkbox' "+(1===P.options.ntp?"checked='checked'":"")+">"+ln("NTP Sync")+"</label>");void 0!==P.options.ar&&(a+="<label for='o14'><input data-mini='true' id='o14' type='checkbox' "+(1===P.options.ar?"checked='checked'":"")+">"+ln("Auto Reconnect")+"</label>");void 0!==P.options.ipas&&(a+="<label for='o25'><input data-mini='true' id='o25' type='checkbox' "+(1===P.options.ipas?"checked='checked'":"")+">"+ln("Ignore Password")+"</label>");void 0!==P.options.sar&&(a+="<label for='o48'><input data-mini='true' id='o48' type='checkbox' "+(1===P.options.sar?"checked='checked'":"")+">"+ln("Special Station Auto-Refresh")+"</label>");a+="</fieldset><fieldset data-role='collapsible' data-theme='b'"+("string"==typeof t&&"reset"===t?" data-collapsed='false'":"")+"><legend>"+ln("Reset")+"</legend>",a+="<button data-mini='true' class='center-div reset-log'>"+ln("Clear Log Data")+"</button>",a+="<button data-mini='true' class='center-div reset-options'>"+ln("Reset All Options")+"</button>",a+="<button data-mini='true' class='center-div reset-stations'>"+ln("Reset All Station Data")+"</button>",P.options.hwv>=30&&P.options.hwv<40&&(a+="<hr class='divider'><button data-mini='true' class='center-div reset-wireless'>"+ln("Reset Wireless Settings")+"</button>");a+="</fieldset>",o.find("#os-options-list").html(a).one("change input",":not(.noselect)",(function(){l.eq(2).prop("disabled",!1),o.find(".submit").addClass("hasChanges")})).find("fieldset").each((function(){var t=$(this);1===t.children().length&&t.remove()})),o.find(".clear-loc").on("click",(function(t){t.stopImmediatePropagation(),Pe(ln("Are you sure you want to clear the current location?"),"",(function(){o.find("#loc").val("''").removeClass("green").find("span").text(ln("Not specified")),o.find("#o1").selectmenu("enable"),l.eq(2).prop("disabled",!1),o.find(".submit").addClass("hasChanges")}))})),o.find("#showDisabled").on("change",(function(){return I({showDisabled:this.checked}),!1})),o.find("#loc").on("click",(function(){var t=$(this);t.prop("disabled",!0),function(t){$("#location-list").popup("destroy").remove(),$.mobile.loading("show"),t=t||function(){};var e=$("<div data-role='popup' id='location-list' data-theme='a' style='background-color:rgb(229, 227, 223);'><a href='#' data-rel='back' class='ui-btn ui-corner-all ui-shadow ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-right'>"+ln("Close")+"</a><iframe style='border:none' src='"+fn()+"map.html' width='100%' height='100%' seamless=''></iframe></div>"),n=function(t){t=t||function(t){t&&a.get(0).contentWindow.postMessage({type:"currentLocation",payload:{lat:t.coords.latitude,lon:t.coords.longitude}},"*")};var e,n=function(n){clearTimeout(e),$.mobile.loading("hide"),n||Ge(ln("Unable to retrieve your current location")),t(n)};try{e=setTimeout((function(){$.mobile.loading("show",{html:"<div class='logo'></div><h1 style='padding-top:5px'>"+ln("Attempting to retrieve your current location")+"</h1></p>",textVisible:!0,theme:"b"})}),100),navigator.geolocation.getCurrentPosition((function(t){clearTimeout(e),n(t)}),(function(){n(!1)}),{timeout:1e4})}catch(t){n(!1)}},i=function(t,e){var n=$("#wtkey").val();""!==n&&$.ajax({url:"https://api.weather.com/v3/location/near?format=json&product=pws&apiKey="+n+"&geocode="+encodeURIComponent(t)+","+encodeURIComponent(e),cache:!0}).done((function(t){var e=[];t.location.stationId.forEach((function(n,i){e.push({id:n,lat:t.location.latitude[i],lon:t.location.longitude[i],message:t.location.stationId[i]})})),e.length>0&&(e=encodeURIComponent(JSON.stringify(e)),a.get(0).contentWindow.postMessage({type:"pwsData",payload:e},"*"))}))},a=e.find("iframe"),o=$("#loc").val(),s={lat:o.match(O)?o.split(",")[0]:A[0],lon:o.match(O)?o.split(",")[1]:A[1]},r=!1;$.mobile.window.off("message onmessage").on("message onmessage",(function(a){var o=a.originalEvent.data;if(void 0!==o.WS){var s=o.WS.split(",");t(s.length>1?s:o.WS,o.station),r=!0,e.popup("destroy").remove()}else!0===o.loaded?$.mobile.loading("hide"):"object"==typeof o.location?i(o.location[0],o.location[1]):!0===o.dismissKeyboard?document.activeElement.blur():!0===o.getLocation&&n()})),a.one("load",(function(){0===s.lat&&0===s.lon&&n(),this.contentWindow.postMessage({type:"startLocation",payload:{start:s}},"*")})),e.one("popupafterclose",(function(){!1===r&&t(!1)})),Ne(e,{beforeposition:function(){e.css({width:window.innerWidth-36,height:window.innerHeight-28})},x:0,y:0}),i(s.lat,s.lon)}((function(e,n){if(!1===e)""===t.val()&&(t.removeClass("green"),o.find("#o1").selectmenu("enable"));else{if(Ie(210)&&o.find("#o1").selectmenu("disable"),"string"==typeof e)t.val(e).find("span").text(e);else{e[0]=parseFloat(e[0]).toFixed(5),e[1]=parseFloat(e[1]).toFixed(5),"string"==typeof n&&function(t,e){P.settings.wto&&"string"==typeof P.settings.wto.key&&""!==P.settings.wto.key||e(!1);$.ajax({url:"https://api.weather.com/v2/pws/observations/hourly/7day?stationId="+t+"&format=json&units=e&apiKey="+P.settings.wto.key,cache:!0}).done((function(t){t&&!t.errors?e(!0):e(!1)})).fail((function(){e(!1)}))}(n,(function(e){e?t.addClass("green"):e||t.removeClass("green")}));var i=o.find("#wto");i&&void 0!==i.val()&&i.val(mn($.extend({},vn(i.val()),{pws:n||""}))),t.val(e),a=e[0],s=e[1],r=function(e){t.find("span").text(e)},d=d||a+","+s,$.getJSON("https://maps.googleapis.com/maps/api/geocode/json?latlng="+a+","+s+"&key=AIzaSyDaT_HTZwFojXmvYIhwWudK00vFXzMmOKc&result_type=locality|sublocality|administrative_area_level_1|country",(function(t){if(0!==t.results.length){t=t.results,d=t[0].formatted_address;var e=!1;for(var n in t)if(t.hasOwnProperty(n)&&($.inArray("locality",t[n].types)>-1||$.inArray("sublocality",t[n].types)>-1||$.inArray("postal_code",t[n].types)>-1||$.inArray("street_address",t[n].types)>-1)){e=!0;break}if(!1!==e){t=t[n].address_components;var i="",a="";for(n in e=!1,t)t.hasOwnProperty(n)&&!e&&(""===i&&$.inArray("locality",t[n].types)>-1&&(i=t[n].long_name+", "+i),""===i&&$.inArray("sublocality",t[n].types)>-1&&(i=t[n].long_name+", "+i),$.inArray("administrative_area_level_1",t[n].types)>-1&&(i+=t[n].long_name,e=!0),$.inArray("country",t[n].types)>-1&&(a=t[n].long_name));e||(i+=a),r(i)}else r(d)}else r(d)}))}l.eq(2).prop("disabled",!1),o.find(".submit").addClass("hasChanges")}var a,s,r,d;t.prop("disabled",!1)}))})),o.find("#wto").on("click",(function(){var t=this,e=vn(this.value),n={pws:e.pws,key:e.key},i=parseInt(o.find("#o31").val()),a=function(){t.value=mn($.extend({},vn(t.value),n)),l.eq(2).prop("disabled",!1),o.find(".submit").addClass("hasChanges")};1===i?function(t,e){$(".ui-popup-active").find("[data-role='popup']").popup("close");var n=$.extend({},{h:100,t:100,r:100,bh:30,bt:70,br:0},vn(t.value)),i=Ie(2162);C&&(n.bt=Math.round(5*(n.bt-32)/9*10)/10,n.br=Math.round(25.4*n.br*10)/10);var a=$("<div data-role='popup' data-theme='a' id='adjustmentOptions'><div data-role='header' data-theme='b'><h1>"+ln("Weather Adjustment Options")+"</h1></div><div class='ui-content'><p class='rain-desc center smaller'>"+ln("Set the baseline weather conditions for your location. ")+ln("The Zimmerman method will adjust the watering duration based on differences from this reference point.")+"</p><div class='ui-grid-b'><div class='ui-block-a'><label class='center'>"+ln("Temp")+(C?" &#176;C":" &#176;F")+"</label><input data-wrapper-class='pad_buttons' class='bt' type='number' "+(C?"min='-20' max='50'":"min='0' max='120'")+" value='"+n.bt+(i?"'>":"' disabled='disabled'>")+"</div><div class='ui-block-b'><label class='center'>"+ln("Rain")+(C?" mm":' "')+"</label><input data-wrapper-class='pad_buttons' class='br' type='number' "+(C?"min='0' max='25' step='0.1'":"min='0' max='1' step='0.01'")+" value='"+n.br+(i?"'>":"' disabled='disabled'>")+"</div><div class='ui-block-c'><label class='center'>"+ln("Humidity")+" %</label><input data-wrapper-class='pad_buttons' class='bh' type='number'  min='0' max='100' value='"+n.bh+(i?"'>":"' disabled='disabled'>")+"</div></div><p class='rain-desc center smaller'>"+ln("Set the sensitivity of the watering adjustment to changes in each of the above weather conditions.")+"</p><span><fieldset class='ui-grid-b incr'><div class='ui-block-a'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div><div class='ui-block-b'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div><div class='ui-block-c'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div></fieldset><div class='ui-grid-b inputs'><div class='ui-block-a'><input data-wrapper-class='pad_buttons' class='t' type='number' min='0' max='100' value='"+n.t+"'></div><div class='ui-block-b'><input data-wrapper-class='pad_buttons' class='r' type='number'  min='0' max='100' value='"+n.r+"'></div><div class='ui-block-c'><input data-wrapper-class='pad_buttons' class='h' type='number'  min='0' max='100' value='"+n.h+"'></div></div><fieldset class='ui-grid-b decr'><div class='ui-block-a'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div><div class='ui-block-b'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div><div class='ui-block-c'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div></fieldset></span><button class='submit' data-theme='b'>"+ln("Submit")+"</button></div></div>"),o=function(t,e){var n=a.find(".inputs input").eq(t),i=parseInt(n.val());-1===e&&0===i||1===e&&100===i||n.val(i+e)};a.find(".submit").on("click",(function(){var n={h:parseInt(a.find(".h").val()),t:parseInt(a.find(".t").val()),r:parseInt(a.find(".r").val())};return i&&($.extend(n,{bh:parseInt(a.find(".bh").val()),bt:parseFloat(a.find(".bt").val()),br:parseFloat(a.find(".br").val())}),C&&(n.bt=Math.round(100*(9*n.bt/5+32))/100,n.br=Math.round(n.br/25.4*1e3)/1e3)),t&&(t.value=mn(n)),e(),a.popup("close"),!1})),a.on("focus","input[type='number']",(function(){this.value=""})).on("blur","input[type='number']",(function(){var t=parseFloat(this.min),e=parseFloat(this.max);""===this.value&&(this.value="0"),(this.value<t||this.value>e)&&(this.value=this.value<t?t:e)})),Ke(a.find(".incr").children(),(function(t){var e=$(t.currentTarget).index();return o(e,1),!1})),Ke(a.find(".decr").children(),(function(t){var e=$(t.currentTarget).index();return o(e,-1),!1})),$("#adjustmentOptions").remove(),a.css("max-width","380px"),Ne(a,{positionTo:"window"})}(this,a):2===i?function(t,e){$(".ui-popup-active").find("[data-role='popup']").popup("close");var n=$.extend({},{d:24},vn(t.value)),i=$("<div data-role='popup' data-theme='a' id='adjustmentOptions'><div data-role='header' data-theme='b'><h1>"+ln("Weather Adjustment Options")+"</h1></div><div class='ui-content'><p class='rain-desc center smaller'>"+ln("If the weather reports any condition suggesting rain, a rain delay is automatically issued using the below set delay duration.")+"</p><label class='center' for='delay_duration'>"+ln("Delay Duration (hours)")+"</label><div class='input_with_buttons'><button class='decr ui-btn ui-btn-icon-notext ui-icon-carat-l btn-no-border'></button><input id='delay_duration' type='number' pattern='[0-9]*' value='"+n.d+"'><button class='incr ui-btn ui-btn-icon-notext ui-icon-carat-r btn-no-border'></button></div><button class='submit' data-theme='b'>"+ln("Submit")+"</button></div></div>"),a=function(t){var e=i.find("#delay_duration"),n=parseInt(e.val());-1===t&&0===n||1===t&&8760===n||e.val(n+t)};i.find(".submit").on("click",(function(){return n={d:parseInt(i.find("#delay_duration").val())},t&&(t.value=mn(n)),e(),i.popup("close"),!1})),i.on("focus","input[type='number']",(function(){this.value=""})).on("blur","input[type='number']",(function(){(""===this.value||parseInt(this.value)<0)&&(this.value="0")})),Ke(i.find(".incr"),(function(){return a(1),!1})),Ke(i.find(".decr"),(function(){return a(-1),!1})),$("#adjustmentOptions").remove(),i.css("max-width","380px"),Ne(i,{positionTo:"window"})}(this,a):3===i&&function(t,e){$(".ui-popup-active").find("[data-role='popup']").popup("close");var n=$.extend({},{baseETo:0,elevation:600},P.settings.wto);C&&(n.baseETo=Math.round(25.4*n.baseETo*10)/10,n.elevation=Math.round(n.elevation/3.28));var i=$("<div data-role='popup' data-theme='a' id='adjustmentOptions'><div data-role='header' data-theme='b'><h1>"+ln("Weather Adjustment Options")+"</h1></div><div class='ui-content'><p class='rain-desc center smaller'>"+ln("Set the baseline potential evapotranspiration (ETo) and elevation for your location. ")+ln("The ETo adjustment method will adjust the watering duration based on the difference between the baseline ETo and the current ETo.")+"</p><div class='ui-grid-a'><div class='ui-block-a'><label class='center'>"+ln("Baseline ETo")+(C?" (mm":"(in")+"/day)</label><input data-wrapper-class='pad_buttons' class='baseline-ETo' type='number' min='0' "+(C?"max='25' step='0.1'":"max='1' step='0.01'")+" value='"+n.baseETo+"'></div><div class='ui-block-b'><label class='center'>"+ln("Elevation")+(C?" (m)":" (ft)")+"</label><input data-wrapper-class='pad_buttons' class='elevation' type='number' step='1'"+(C?"min='-400' max='9000'":"min='-1400' max='30000'")+" value='"+n.elevation+"'></div></div><button class='detect-baseline-eto'>"+ln("Detect baseline ETo")+"</button><button class='submit' data-theme='b'>"+ln("Submit")+"</button></div></div>");i.find(".submit").on("click",(function(){return n={baseETo:parseFloat(i.find(".baseline-ETo").val()),elevation:parseInt(i.find(".elevation").val())},C&&(n.baseETo=Math.round(n.baseETo/25.4*100)/100,n.elevation=Math.round(3.28*n.elevation)),t&&(t.value=mn(n)),e(),i.popup("close"),!1})),i.find(".detect-baseline-eto").on("click",(function(){var t=$(".detect-baseline-eto").html();return Be(".detect-baseline-eto"),$.ajax({url:m+"/baselineETo?loc="+encodeURIComponent(P.settings.loc),contentType:"application/json; charset=utf-8",success:function(t){var e=t.eto;C&&(e=Math.round(25.4*e*100)/100),$(".baseline-ETo").val(e),window.alert("Detected baseline ETo for configured location is "+e+(C?"mm":"in")+"/day")},error:function(t,e){var n="Unable to detect baseline ETo: "+(t.status?t.responseText+"("+t.status+")":e);window.alert(n),window.console.error(n)},complete:function(){$(".detect-baseline-eto").html(t)}}),!1})),i.on("focus","input[type='number']",(function(){this.value=""})).on("blur","input[type='number']",(function(){var t=parseFloat(this.min),e=parseFloat(this.max);""===this.value&&(this.value="0"),(this.value<t||this.value>e)&&(this.value=this.value<t?t:e)})),$("#adjustmentOptions").remove(),i.css("max-width","380px"),Ne(i,{positionTo:"window"})}(this,a)})),o.find(".reset-log").on("click",Jt),o.find(".reset-options").on("click",(function(){Vt((function(){$.mobile.document.one("pageshow",(function(){Ge(ln("Settings have been saved"))})),He()}))})),o.find(".reset-stations").on("click",(function(){for(var t="",e=0;e<P.stations.snames.length;e++)t+="s"+e+"=S"+sn(e+1)+"&";if(P.options.mas)for(e=0;e<P.settings.nbrd;e++)t+="m"+e+"=255&";if("object"==typeof P.stations.ignore_rain)for(e=0;e<P.settings.nbrd;e++)t+="i"+e+"=0&";if("object"==typeof P.stations.ignore_sn1)for(e=0;e<P.settings.nbrd;e++)t+="j"+e+"=0&";if("object"==typeof P.stations.ignore_sn2)for(e=0;e<P.settings.nbrd;e++)t+="k"+e+"=0&";if("object"==typeof P.stations.act_relay)for(e=0;e<P.settings.nbrd;e++)t+="a"+e+"=0&";if("object"==typeof P.stations.stn_dis)for(e=0;e<P.settings.nbrd;e++)t+="d"+e+"=0&";if("object"==typeof P.stations.stn_seq)for(e=0;e<P.settings.nbrd;e++)t+="q"+e+"=255&";Pe(ln("Are you sure you want to reset all stations?"),ln("This will reset all station names and attributes"),(function(){$.mobile.loading("show"),T(["sites","current_site"],(function(t){var e=Q(t.sites);e[t.current_site].notes={},e[t.current_site].images={},e[t.current_site].lastRunTime={},I({sites:JSON.stringify(e)},ue)})),B("/cs?pw=&"+t).done((function(){Ge(ln("Stations have been updated")),H()}))}))})),o.find(".reset-wireless").on("click",(function(){Pe(ln("Are you sure you want to reset the wireless settings?"),ln("This will delete the stored SSID/password for your wireless network and return the device to access point mode"),(function(){B("/cv?pw=&ap=1").done((function(){$.mobile.document.one("pageshow",(function(){Ge(ln("Wireless settings have been reset. Please follow the OpenSprinkler user manual on restoring connectivity."))})),He()}))}))})),o.find("#o3").on("change",(function(){var t=$(this).is(":checked"),e=o.find("#ip_addr,#gateway,#dns,#subnet").parents(".ui-field-contain");t?e.addClass("hidden"):e.removeClass("hidden")})),o.find(".sensor-options input[type='radio']").on("change",(function(){var t=this.value,e=parseInt(this.id.match(/o(\d+)/)[1],10);"2"===t?o.find("#o41").parents(".ui-field-contain").removeClass("hidden"):21!==e&&50!==e||o.find("#o41").parents(".ui-field-contain").addClass("hidden"),"1"===t||"3"===t||"240"===t?o.find("#o"+(e+1)).parent().removeClass("hidden"):o.find("#o"+(e+1)).parent().addClass("hidden"),"240"===$("input[name='o21'][type='radio']:checked").val()||"240"===$("input[name='o50'][type='radio']:checked").val()?o.find("#prgswitch").removeClass("hidden"):o.find("#prgswitch").addClass("hidden"),"240"===$("input[name='o52'][type='radio']:checked").val()?o.find("#prgswitch-2").removeClass("hidden"):o.find("#prgswitch-2").addClass("hidden"),"1"===t||"3"===t?o.find("#o"+(e+4)+",#o"+(e+5)).parent().removeClass("hidden"):o.find("#o"+(e+4)+",#o"+(e+5)).parent().addClass("hidden")})),o.find("#o21").on("change",(function(){o.find("#o22").parent().toggleClass("hidden",$(this).is(":checked"))})),o.find("#verify-api").on("click",(function(){var t=o.find("#wtkey"),e=$(this);e.prop("disabled",!0),function(t,e){$.ajax({url:"https://api.weather.com/v2/pws/observations/current?stationId=KMAHANOV10&format=json&units=m&apiKey="+t,cache:!0}).done((function(t){t.errors?e(!1):e(!0)})).fail((function(){e(!1)}))}(t.val(),(function(n){!0===n?(t.parent().find(".ui-icon-alert").hide(),t.parent().removeClass("red").addClass("green")):(t.parent().find(".ui-icon-alert").removeClass("hidden").show(),t.parent().removeClass("green").addClass("red")),e.prop("disabled",!1)}))})),o.find(".help-icon").on("click",We),o.find(".duration-field button:not(.help-icon)").on("click",(function(){var t=$(this),e=t.attr("id"),n=o.find("label[for='"+e+"']").text(),i=t.parent().find(".help-icon").data("helptext"),a=240;if(l.eq(2).prop("disabled",!1),o.find(".submit").addClass("hasChanges"),"ip_addr"===e||"gateway"===e||"dns"===e||"ntp_addr"===e||"subnet"===e)!function(t){var e={title:ln("Enter IP Address"),ip:[0,0,0,0],showBack:!0,callback:function(){}};t=$.extend({},e,t),$("#ipInput").popup("destroy").remove();var n=$("<div data-role='popup' id='ipInput' data-theme='a'><div data-role='header' data-theme='b'><h1>"+t.title+"</h1></div><div class='ui-content'><span><fieldset class='ui-grid-c incr'><div class='ui-block-a'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div><div class='ui-block-b'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div><div class='ui-block-c'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div><div class='ui-block-d'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div></fieldset><div class='ui-grid-c inputs'><div class='ui-block-a'><input data-wrapper-class='pad_buttons' class='ip_addr' type='number' pattern='[0-9]*' max='255' value='"+t.ip[0]+"'></div><div class='ui-block-b'><input data-wrapper-class='pad_buttons' class='ip_addr' type='number' pattern='[0-9]*' max='255' value='"+t.ip[1]+"'></div><div class='ui-block-c'><input data-wrapper-class='pad_buttons' class='ip_addr' type='number' pattern='[0-9]*' max='255' value='"+t.ip[2]+"'></div><div class='ui-block-d'><input data-wrapper-class='pad_buttons' class='ip_addr' type='number' pattern='[0-9]*' max='255' value='"+t.ip[3]+"'></div></div><fieldset class='ui-grid-c decr'><div class='ui-block-a'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div><div class='ui-block-b'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div><div class='ui-block-c'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div><div class='ui-block-d'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div></fieldset></span>"+(t.showBack?"<button class='submit' data-theme='b'>"+ln("Submit")+"</button>":"")+"</div></div>"),i=function(e,i){var o=n.find(".inputs input").eq(e),s=parseInt(o.val());-1===i&&0===s||1===i&&s>=255||(o.val(s+i),t.callback(a()))},a=function(){return $.makeArray(n.find(".ip_addr").map((function(){return parseInt($(this).val())})))};n.find("button.submit").on("click",(function(){t.callback(a()),n.popup("destroy").remove()})),n.on("focus","input[type='number']",(function(){this.value=""})).on("blur","input[type='number']",(function(){""===this.value&&(this.value="0")})),Ke(n.find(".incr").children(),(function(t){var e=$(t.currentTarget).index();return i(e,1),!1})),Ke(n.find(".decr").children(),(function(t){var e=$(t.currentTarget).index();return i(e,-1),!1})),n.css("max-width","350px").one("popupafterclose",(function(){t.callback(a())})),Ne(n)}({title:n,ip:t.val().split("."),callback:function(e){t.val(e.join(".")).text(e.join("."))}});else if("o19"===e||"o38"===e)Ae({data:t.val(),title:n,callback:function(e){t.val(e).text(e+"s")},label:ln("Seconds"),maximum:60,helptext:i});else if("o30"===e)Ae({data:t.val(),title:n,callback:function(e){t.val(e).text(e+"ms")},label:ln("Milliseconds"),maximum:2e3,helptext:i});else if("o20"===e||"o39"===e)Ae({data:t.val(),title:n,callback:function(e){t.val(e).text(e+"s")},label:ln("Seconds"),maximum:Ie(217)?0:60,minimum:-60,helptext:i});else if("o23"===e)Ae({data:t.val(),title:n,callback:function(e){t.val(e).text(e+"%")},label:ln("% Watering"),maximum:250,helptext:i});else if("o17"===e){var s=0;Ie(210)&&(a=Ie(214)?57600:64800),Ie(211)&&(s=-3540,a=3540),Ie(217)&&(s=-600,a=600),Ae({data:t.val(),title:n,label:ln("Seconds"),callback:function(e){t.val(e),t.text(nn(en(e)))},maximum:a,minimum:s})}else"o54"!==e&&"o55"!==e&&"o56"!==e&&"o57"!==e||Ae({data:t.val(),title:n,callback:function(e){t.val(e).text(e+"m")},label:ln("Minutes"),maximum:240,minimum:0,helptext:i});return!1})),o.find("#o2").on("change",(function(){var t=$(this).is(":checked");o.find(".datetime-input button").prop("disabled",t),o.find("#ntp_addr").parents(".ui-field-contain").toggleClass("hidden",!t)})),o.find("#o18,#o37").on("change",(function(){o.find("#o19,#o20").parents(".ui-field-contain").toggle(0!==parseInt(o.find("#o18").val())),void 0!==P.options.mas2&&o.find("#o38,#o39").parents(".ui-field-contain").toggle(0!==parseInt(o.find("#o37").val()))})),o.find("#o31").on("change",(function(){o.find("#o23").prop("disabled",0!==parseInt(this.value)),o.find("#wto").click().parents(".ui-field-contain").toggleClass("hidden",0===parseInt(this.value))})),o.find("#wtkey").on("change input",(function(){o.find("#wtkey").siblings(".help-icon").hide(),o.find("#wtkey").parent().removeClass("red green")})),o.find("#o49").on("click",(function(){var t={program:ln("Program Start"),sensor1:ln("Sensor 1 Update"),flow:ln("Flow Sensor Update"),weather:ln("Weather Adjustment Update"),reboot:ln("Controller Reboot"),run:ln("Station Run"),sensor2:ln("Sensor 2 Update"),rain:ln("Rain Delay Update")},e=this,n=parseInt(e.value),i="",a=0,s=0;$.each(t,(function(t,e){i+="<label for='ifttt-"+t+"'><input class='needsclick' data-iconpos='right' id='ifttt-"+t+"' type='checkbox' "+((0!=(n&1<<a)?"checked='checked'":"")+">")+e+"</label>",a++}));var r=$("<div data-role='popup' data-theme='a'><div data-role='controlgroup' data-mini='true' class='tight'><div class='ui-bar ui-bar-a'>"+ln("Select IFTTT Events")+"</div>"+i+"<input data-wrapper-class='attrib-submit' class='submit' data-theme='b' type='submit' value='"+ln("Submit")+"' /></div></div>");r.find(".submit").on("click",(function(){a=0,$.each(t,(function(t){s|=r.find("#ifttt-"+t).is(":checked")<<a,a++})),r.popup("close"),n!==s&&(e.value=s,l.eq(2).prop("disabled",!1),o.find(".submit").addClass("hasChanges"))})),Ne(r)})),o.find(".datetime-input").on("click",(function(){var t=$(this).find("button");if(!t.prop("disabled"))return l.eq(2).prop("disabled",!1),o.find(".submit").addClass("hasChanges"),function(t,e){$("#datetimeInput").popup("destroy").remove(),t instanceof Date||(t=new Date(1e3*t)).setMinutes(t.getMinutes()-t.getTimezoneOffset());e=e||function(){};var n=["Month","Date","FullYear","Hours","Minutes"],i=[ln("Jan"),ln("Feb"),ln("Mar"),ln("Apr"),ln("May"),ln("Jun"),ln("Jul"),ln("Aug"),ln("Sep"),ln("Oct"),ln("Nov"),ln("Dec")],a=$("<div data-role='popup' id='datetimeInput' data-theme='a'><div data-role='header' data-theme='b'><h1>"+ln("Enter Date/Time")+"</h1></div><div class='ui-content'></div></div>"),o=function(n,i){t["setUTC"+n](t["getUTC"+n]()+i),e(new Date(t.getTime())),s()},s=function(){var e,s,r="<fieldset class='ui-grid-d incr'>",l="<div class='ui-grid-d inputs'>",d="<fieldset class='ui-grid-d decr'>";for(s=0;s<5;s++)e=t["getUTC"+n[s]](),"",e="Month"===n[s]?"<p class='center'>"+i[e]+"</p>":"Date"===n[s]?"<p class='center'>"+e+",</p>":"Hours"===n[s]?"<p style='width:90%;display:inline-block' class='center'>"+e+"</p><p style='display:inline-block'>:</p>":"<p class='center'>"+e+"</p>",r+="<div class='ui-block-"+String.fromCharCode(97+s)+"'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div>",l+="<div id='"+n[s]+"' class='ui-block-"+String.fromCharCode(97+s)+"'>"+e+"</div>",d+="<div class='ui-block-"+String.fromCharCode(97+s)+"'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div>";r+="</fieldset>",l+="</div>",d+="</fieldset>",a.find(".ui-content").html("<span>"+r+l+d+"</span>").enhanceWithin(),a.find(".incr").children().on("vclick",(function(){var t=$(this).index();return o(a.find(".inputs").children().eq(t).attr("id"),1),!1})),a.find(".decr").children().on("vclick",(function(){var t=$(this).index();return o(a.find(".inputs").children().eq(t).attr("id"),-1),!1}))};s(),a.css("width","280px").one("popupafterclose",(function(){e(t)})),Ne(a)}(t.val(),(function(e){t.text(wn(e).slice(0,-3)).val(Math.round(e.getTime()/1e3))})),!1})),o.one("pagehide",(function(){o.remove()})),l.eq(2).prop("disabled",!0),$("#os-options").remove(),$.mobile.pageContainer.append(o)}(e.options.expandItem):"#preview"===n?Ft():"#logs"===n?Ht():"#forecast"===n?function(){var t=$("<div data-role='page' id='forecast'><div class='ui-content' role='main'><ul data-role='listview' data-inset='true'>"+function(){var t,e,n,i="",a=P.settings.sunrise?P.settings.sunrise:vt()[0],o=P.settings.sunset?P.settings.sunset:vt()[1],s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];for(i+="<li data-icon='false' class='center'><div>"+ln("Now")+"</div><br><div title='"+f.description+"' class='wicon'><img src='http://openweathermap.org/img/w/"+f.icon+".png'></div><span>"+dt(f.temp)+"</span><br><span>"+ln("Sunrise")+"</span><span>: "+sn(parseInt(a/60)%24)+":"+sn(a%60)+"</span> <span>"+ln("Sunset")+"</span><span>: "+sn(parseInt(o/60)%24)+":"+sn(o%60)+"</span></li>",t=1;t<f.forecast.length;t++)e=new Date(1e3*f.forecast[t].date),n=vt(e),a=n[0],o=n[1],i+="<li data-icon='false' class='center'><div>"+e.toLocaleDateString()+"</div><br><div title='"+f.forecast[t].description+"' class='wicon'><img src='http://openweathermap.org/img/w/"+f.forecast[t].icon+".png'></div><span>"+ln(s[e.getDay()])+"</span><br><span>"+ln("Low")+"</span><span>: "+dt(f.forecast[t].temp_min)+"  </span><span>"+ln("High")+"</span><span>: "+dt(f.forecast[t].temp_max)+"</span><br><span>"+ln("Sunrise")+"</span><span>: "+sn(parseInt(a/60)%24)+":"+sn(a%60)+"</span> <span>"+ln("Sunset")+"</span><span>: "+sn(parseInt(o/60)%24)+":"+sn(o%60)+"</span></li>";return i}()+"</ul>"+bt(f.weatherProvider)+"</div></div>");qe({title:ln("Forecast"),leftBtn:{icon:"carat-l",text:ln("Back"),class:"ui-toolbar-back-btn",on:He},rightBtn:{icon:"refresh",text:ln("Refresh"),on:function(){$.mobile.loading("show"),$.mobile.document.one("weatherUpdateComplete",(function(){$.mobile.loading("hide")})),ht()}}}),t.one("pagehide",(function(){t.remove()})),t.find(".alert").on("click",(function(){Ne($("<div data-role='popup' data-theme='a'><div data-role='header' data-theme='b'><h1>"+f.alert.name+"</h1></div><div class='ui-content'><span style='white-space: pre-wrap'>"+$.trim(f.alert.message)+"</span></div></div>"))})),$("#forecast").remove(),$.mobile.pageContainer.append(t)}():"#loadingPage"===n?X(!0):"#start"===n?Ot():"#site-control"===n?et():"#sprinklers"===n&&(0===$(n).length?jt(e.options.firstLoad):$(n).one("pageshow",At))))})).on("resume",(function(){void 0!==i&&(fe(),Be("#weather,#footer-running"),H(ht,F))})).on("pause",(function(){})).on("pagebeforeshow",(function(t){var e="#"+t.target.id;"#start"===e||"#loadingPage"===e?$("#header,#footer,#footer-menu").hide():$("#header,#footer,#footer-menu").show(),T("showDisabled",(function(t){t.showDisabled&&"true"===t.showDisabled&&$(e).addClass("show-hidden").find(".station-hidden").show()}))})).on("pageshow",(function(t){var e="#"+t.target.id,n=$(e);if(W?W=!1:R++,Ye(n),an()&&"#site-control"!==e&&"#start"!==e&&"#loadingPage"!==e){var i,a=setInterval(At,5e3);Ie(216)||(i=setInterval(Rt,2e4)),n.one("pagehide",(function(){clearInterval(a),clearInterval(i)}))}})).on("popupafteropen",(function(){if($(".ui-overlay-b:not(.ui-screen-hidden)").length)try{StatusBar.backgroundColorByHexString(M)}catch(t){}})).on("popupafterclose",(function(){$(".ui-page-active").children().add("#sprinklers-settings").removeClass("blur-filter");try{StatusBar.backgroundColorByHexString(D)}catch(t){}})).on("popupbeforeposition",(function(){$(".ui-page-active").children().add("#sprinklers-settings").addClass("blur-filter")})).on("popupbeforeposition","#localization",pn).one("pagebeforeshow","#loadingPage",(function(){cn(),$.ajaxSetup({timeout:1e4});v&&Ze(".ui-toolbar-back-btn{display:none!important}ul{list-style:none!important;}");x&&Ze("html,body{overflow-y:scroll}");b?(Ze(".ui-toolbar-back-btn{display:none!important}"),$(this).ajaxStart((function(){try{navigator.app.clearCache()}catch(t){}}))):y?$.ajaxSetup({xhr:function(){return new window.XMLHttpRequest({mozSystem:!0})}}):$.ajaxSetup({cache:!1});$.mobile.defaultPageTransition=b||v?"fade":"slide",$.mobile.hoverDelay=0,$.mobile.activeBtnClass="activeButton",k||$.mobile.document.on("click",".iab",(function(){var t=$(this),e=window.open(this.href,"_blank","location="+(b?"yes":"no")+",enableViewportScale="+(t.hasClass("iabNoScale")?"no":"yes")+",toolbarposition=top,closebuttoncaption="+(t.hasClass("iabNoScale")?ln("Back"):ln("Done")));return v&&($.mobile.document.data("iabOpen",!0),e.addEventListener("exit",(function(){$.mobile.document.removeData("iabOpen")}))),setTimeout((function(){t.removeClass("ui-btn-active")}),100),!1}));$.mobile.document.on("click",".ui-select .ui-btn",(function(){var t=$(this),e=t.attr("id").replace("-button","-listbox"),n=$("#"+e);return n.popup("destroy").detach().addClass("ui-page-theme-a"),$.mobile.pageContainer.append(n),n.popup({history:!1,positionTo:t,overlayTheme:"b"}).popup("open"),t.off("click").on("click",(function(){n.popup("open")})),!1})),$.mobile.document.on("swiperight swipeleft",".ui-page",(function(t){var e=$(".ui-page-active");"INPUT"===t.target.tagName||"TEXTAREA"===t.target.tagName||"open"===e.jqmData("panel")||e.find(".ui-popup-active").length||("swiperight"===t.type?h():xe())})),$.widget("mobile.collapsible",$.mobile.collapsible,{_handleExpandCollapse:function(t){this._trigger("before"+(t?"collapse":"expand"))&&this._superApply(arguments)}}),$("#site-selector").on("change",(function(){at($(this).val())})),$("#footer-menu").on("click",(function(){It(this)})),$("#header,#footer").toolbar(),FastClick.attach(document.body),n=(new Date).getTime(),void setInterval((function(){if(!an())return!1;var t=(new Date).getTime();if(t-n>2e3&&(Et(),At()),n=t,!$.isEmptyObject(L))for(var e in L)L.hasOwnProperty(e)&&(L[e].val<=0?("statusbar"===e&&(Be("#footer-running"),At()),"function"==typeof L[e].done&&L[e].done(),delete L[e]):"clock"===e?(++L[e].val,L[e].update()):"statusbar"!==e&&"number"!=typeof L[e].station||(--L[e].val,L[e].update()))}),1e3),$.mobile.document.on("keydown",(function(t){var e=$(t.target).prop("tagName");if("INPUT"!==e&&"TEXTAREA"!==e){var n=t.keyCode,i=t.altKey,a=$("#mainMenu-popup").hasClass("ui-popup-active");if(77===n)$("#mainMenu").length>0?$("#mainMenu").popup("close"):It();else(a||i)&&80===n?(t.preventDefault(),Ee("#programs")):(a||i)&&79===n?(t.preventDefault(),Ee("#os-options")):(a||i)&&86===n?(t.preventDefault(),Ee("#preview")):(a||i)&&76===n?(t.preventDefault(),Ee("#logs")):(a||i)&&82===n?(t.preventDefault(),Ee("#runonce")):(a||i)&&68===n&&(t.preventDefault(),kt())}})),t=$("#sprinklers-settings"),e=function(){return P&&P.settings&&P.settings.en&&1===P.settings.en?ln("Disable"):ln("Enable")},t.enhanceWithin().panel().removeClass("hidden").panel("option","classes.modal","needsclick ui-panel-dismiss"),t.find("a[href='#site-control']").on("click",(function(){return Ee("#site-control"),!1})),t.find("a[href='#about']").on("click",(function(){return Ee("#about"),!1})),t.find(".cloud-login").on("click",(function(){return ce(),!1})),t.find("a[href='#debugWU']").on("click",wt),t.find("a[href='#localization']").on("click",un),t.find(".export_config").on("click",(function(){return"object"!=typeof P.stations.stn_spe||"object"==typeof P.special||P.stations.stn_spe.every((function(t){return 0===t}))?ae():Z(ae),!1})),t.find(".import_config").on("click",(function(){return T("backup",(function(t){!function(t){var e=function(){var t=$("<div data-role='popup' data-theme='a' id='paste_config'><p class='ui-bar'><textarea class='textarea' rows='10' placeholder='"+ln("Paste your backup here")+"'></textarea><button data-mini='true' data-theme='b'>"+ln("Import")+"</button></p></div>"),e=$.mobile.window.width();return t.find("button").on("click",(function(){var e=t.find("textarea").val();if(""!==e)try{e=JSON.parse($.trim(e).replace(/“|”|″/g,'"')),t.popup("close"),oe(e)}catch(e){t.find("textarea").val(""),Ge(ln("Unable to read the configuration file. Please check the file and try again."))}})),t.css("width",e>600?.4*e+"px":"100%"),Ne(t),!1},n=$("<div data-role='popup' data-theme='a'><div class='ui-bar ui-bar-a'>"+ln("Select Import Method")+"</div><div data-role='controlgroup' class='tight'><button class='hidden fileMethod'>"+ln("File")+"</button><button class='pasteMethod'>"+ln("Email (copy/paste)")+"</button><button class='hidden localMethod'>"+ln("Internal (within app)")+"</button></div></div>");if(_)n.find(".fileMethod").removeClass("hidden").on("click",(function(){n.popup("close");var t=$("<input type='file' id='configInput' data-role='none' style='visibility:hidden;position:absolute;top:-50px;left:-50px'/>").on("change",(function(){var t=this.files[0],e=new FileReader;"object"==typeof t&&(e.onload=function(t){try{oe(JSON.parse($.trim(t.target.result)))}catch(t){Ge(ln("Unable to read the configuration file. Please check the file and try again."))}},e.readAsText(t))}));return t.appendTo("#sprinklers-settings"),t.click(),!1}));else if(!t)return void e();n.find(".pasteMethod").on("click",(function(){return n.popup("close"),e(),!1})),t&&n.find(".localMethod").removeClass("hidden").on("click",(function(){return n.popup("close"),oe(JSON.parse(t)),!1})),Ne(n,{positionTo:$("#sprinklers-settings").find(".import_config")})}(t.backup)})),!1})),t.find(".toggleOperation").on("click",(function(){var t=$(this),n=1-P.settings.en;return Pe(ln("Are you sure you want to")+" "+e().toLowerCase()+" "+ln("operation?"),"",(function(){B("/cv?pw=&en="+n).done((function(){$.when(K(),Y()).done((function(){Et(),t.find("span:first").html(e()).attr("data-translate",e())}))}))})),!1})).find("span:first").html(e()).attr("data-translate",e()),t.find(".reboot-os").on("click",(function(){return Pe(ln("Are you sure you want to reboot OpenSprinkler?"),"",(function(){$.mobile.loading("show"),B("/cv?pw=&rbt=1").done((function(){$.mobile.loading("hide"),Ge(ln("OpenSprinkler is rebooting now"))}))})),!1})),t.find(".changePassword > a").on("click",de),t.find("#downgradeui").on("click",(function(){return Pe(ln("Are you sure you want to downgrade the UI?"),"",(function(){var t="http://rayshobby.net/scripts/java/svc"+Oe();B("/cu?jsp="+encodeURIComponent(t)+"&pw=").done((function(){j(["sites","current_site","lang","provider","wapikey","runonce"]),location.reload()}))})),!1})),t.find("#logout").on("click",(function(){return ge(),!1})),void(h=function(){var t=$("#sprinklers-settings"),e=function(){var e=P&&P.settings&&P.settings.en&&1===P.settings.en?ln("Disable"):ln("Enable");t.find(".toggleOperation span:first").html(e).attr("data-translate",e)};return $("html").on("datarefresh",e),function(){var n=$(".ui-page-active").attr("id");"start"!==n&&"loadingPage"!==n&&an()&&1===$(".ui-page-active").length&&(e(),t.panel("open"))}}()),"undefined"==typeof cordova&&ot();var t,e;var n;fe(),setTimeout((function(){X(!0)}),200)}));var et=function(){var t,e,n,a=$("<div data-role='page' id='site-control'><div class='ui-content'></div></div>"),o=function(){var t=function(){e.eq(0).hide(),$("#header").show(),$("#footer, #footer-menu").hide()};a.hasClass("ui-page-active")?t():a.one("pagebeforeshow",(function(e){e.stopImmediatePropagation(),t()})),a.on("swiperight swipeleft",(function(t){t.stopImmediatePropagation()})),document.title="OpenSprinkler"},r=$("<div data-role='popup' id='addsite' data-theme='b'><ul data-role='listview'><li data-icon='false'><a href='#' id='site-add-scan'>"+ln("Scan For Device")+"</a></li><li data-icon='false'><a href='#' id='site-add-manual'>"+ln("Manually Add Device")+"</a></li></ul></div>");function l(){T(["sites","current_site","cloudToken"],(function(e){if(t=Q(e.sites),$.isEmptyObject(t)){if("string"!=typeof e.cloudToken)return void Ee("#start");o(),a.find(".ui-content").html("<p class='center'>"+ln("Please add a site by tapping the 'Add' button in the top right corner.")+"</p>")}else{var r="<div data-role='collapsible-set'>",d=[],c=0;n=Object.keys(t).length,an()&&n&&e.current_site in t||o(),t=function(t,e){var n=[];for(var i in t)t.hasOwnProperty(i)&&n.push(i);"function"==typeof e?n.sort(e):"value"===e?n.sort((function(e,n){var i=t[e],a=t[n];return i<a?-1:i>a?1:0})):n.sort();for(var a={},o=0;o<n.length;o++)a[n[o]]=t[n[o]];return a}(t),$.each(t,(function(t,e){d.push(t),t=rn(t),r+="<fieldset "+(1===n?"data-collapsed='false'":"")+" id='site-"+c+"' data-role='collapsible'><h3><a class='ui-btn ui-btn-corner-all connectnow yellow' data-site='"+c+"' href='#'>"+ln("connect")+"</a>"+t+"</h3><form data-site='"+c+"' novalidate><div class='ui-field-contain'><label for='cnm-"+c+"'>"+ln("Change Name")+"</label><input id='cnm-"+c+"' type='text' value='"+t+"'></div><div class='ui-field-contain'><label for='cip-"+c+"'>"+ln("Change IP")+"</label><input id='cip-"+c+"' type='url' value='"+e.os_ip+"' autocomplete='off' autocorrect='off' autocapitalize='off' pattern='' spellcheck='false'></div><div class='ui-field-contain'><label for='cpw-"+c+"'>"+ln("Change Password")+"</label><input id='cpw-"+c+"' type='password'></div><fieldset data-mini='true' data-role='collapsible'><h3><span style='line-height:23px'>"+ln("Advanced")+"</span><button data-helptext='"+ln("These options are only for an OpenSprinkler behind a proxy capable of SSL and/or Basic Authentication.")+"' class='collapsible-button-right help-icon btn-no-border ui-btn ui-icon-info ui-btn-icon-notext'></button></h3><label for='usessl-"+c+"'><input data-mini='true' type='checkbox' id='usessl-"+c+"' name='usessl-"+c+"'"+(void 0!==e.ssl&&"1"===e.ssl?" checked='checked'":"")+">"+ln("Use SSL")+"</label><label for='useauth-"+c+"'><input class='useauth' data-user='"+e.auth_user+"' data-pw='"+e.auth_pw+"' data-mini='true' type='checkbox' id='useauth-"+c+"' name='useauth-"+c+"'"+(void 0!==e.auth_user&&void 0!==e.auth_pw?" checked='checked'":"")+">"+ln("Use Auth")+"</label></fieldset><input class='submit' type='submit' value='"+ln("Save Changes to")+" "+t+"'><a data-role='button' class='deletesite' data-site='"+c+"' href='#' data-theme='b'>"+ln("Delete")+" "+t+"</a></form></fieldset>",function(t,e,n){$.ajax({url:("1"===t.ssl?"https://":"http://")+t.os_ip+"/jo?pw="+encodeURIComponent(t.os_pw),type:"GET",dataType:"json",beforeSend:function(e){void 0!==t.auth_user&&void 0!==t.auth_pw&&e.setRequestHeader("Authorization","Basic "+btoa(t.auth_user+":"+t.auth_pw))}}).then((function(){n(e,!0)}),(function(){n(e,!1)}))}(e,c,(function(t,e){a.find("#site-"+t+" .connectnow").removeClass("yellow").addClass(e?"green":"red")})),c++})),(r=$(r+"</div>")).find("form").one("change input",(function(){$(this).find(".submit").addClass("hasChanges")})),r.find(".connectnow").on("click",(function(){return at(d[$(this).data("site")]),!1})),r.find(".help-icon").on("click",We),r.find(".useauth").on("change",(function(){var t=$(this);if(t.is(":checked")){var e=$("<div data-role='popup' data-theme='a'><form method='post' class='ui-content' novalidate><label for='auth_user'>"+ln("Username:")+"</label><input autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' type='text' name='auth_user' id='auth_user'><label for='auth_pw'>"+ln("Password:")+"</label><input type='password' name='auth_pw' id='auth_pw'><input type='submit' class='submit' value='"+ln("Submit")+"'></form></div>").enhanceWithin(),n=!1;e.find(".submit").on("click",(function(){return t.data({user:e.find("#auth_user").val(),pw:e.find("#auth_pw").val()}),n=!0,e.popup("close"),!1})),e.one("popupafterclose",(function(){n||t.attr("checked",!1).checkboxradio("refresh")})),Ne(e)}else t.data({user:"",pw:""})})),r.find("form").on("submit",(function(){var n=$(this),i=n.data("site"),a=d[i],o=r.find("#cip-"+i).val(),c=r.find("#cpw-"+i).val(),u=r.find("#cnm-"+i).val(),p=r.find("#useauth-"+i).is(":checked"),f=r.find("#usessl-"+i).is(":checked")?"1":void 0,h=r.find("#useauth-"+i).data("user"),m=r.find("#useauth-"+i).data("pw"),v=""!==o&&o!==t[a].os_ip||f!==t[a].ssl||h!==t[a].auth_user||m!==t[a].auth_pw,b=a===e.current_site,g=""!==u&&u!==a;return n.find(".submit").removeClass("hasChanges"),p?(t[a].auth_user=h,t[a].auth_pw=m):(delete t[a].auth_user,delete t[a].auth_pw),"1"===f?t[a].ssl=f:delete t[a].ssl,""!==o&&o!==t[a].os_ip&&(t[a].os_ip=o),""!==c&&c!==t[a].os_pw&&(bn(t[a].os_pw)&&(c=md5(c)),t[a].os_pw=c),g&&(t[u]=t[a],delete t[a],a=u,b&&(I({current_site:a}),e.current_site=a),it(Object.keys(t),e.current_site)),I({sites:JSON.stringify(t)},ue),Ge(ln("Site updated successfully")),a===e.current_site&&(""!==c&&(s=c),v&&X()),g&&!n.find(".submit").hasClass("preventUpdate")&&l(),!1})),r.find(".deletesite").on("click",(function(){var n=d[$(this).data("site")];return $("#site-selector").val()===n&&o(),delete t[n],I({sites:JSON.stringify(t)},(function(){return ue(),it(Object.keys(t),e.current_site),$.isEmptyObject(t)?T("cloudToken",(function(){if(null===e.cloudToken||void 0===e.cloudToken)return i="",s="",void Ee("#start")})):(l(),Ge(ln("Site deleted successfully"))),!1})),!1})),a.find(".ui-content").html(r.enhanceWithin())}"string"==typeof e.cloudToken&&a.find(".ui-content").prepend(nt(e.cloudToken))}))}return r.find("#site-add-scan").on("click",(function(){return r.popup("close"),rt(),!1})),r.find("#site-add-manual").on("click",(function(){return tt(!1,!0),!1})),a.on("pagehide",(function(){r.popup("destroy").detach(),a.detach()})),$("html").on("siterefresh",(function(){a.hasClass("ui-page-active")&&l()})),function(){e=qe({title:ln("Manage Sites"),animate:!!an(),leftBtn:{icon:"carat-l",text:ln("Back"),class:"ui-toolbar-back-btn",on:function(){a.find(".hasChanges").addClass("preventUpdate"),Je()}},rightBtn:{icon:"plus",text:ln("Add"),on:function(){void 0===u?tt():r.popup("open").popup("reposition",{positionTo:e.eq(2)})}}}),l(),$.mobile.pageContainer.append(r),r.popup({history:!1,positionTo:e.eq(2)}).enhanceWithin(),$("#site-control").remove(),$.mobile.pageContainer.append(a)}}();function nt(t){var e=$("<div class='ui-bar smaller ui-bar-a ui-corner-all logged-in-alert'><div class='inline ui-btn ui-icon-recycle btn-no-border ui-btn-icon-notext ui-mini'></div><div class='inline syncStatus'>"+ln("Synced with OpenSprinkler.com")+" ("+be(t)+")</div><div class='inline ui-btn ui-icon-delete btn-no-border ui-btn-icon-notext ui-mini logout'></div></div>");return e.find(".logout").on("click",ge),e.find(".ui-icon-recycle").on("click",(function(){var t=$(this);t.addClass("spin"),fe((function(){t.removeClass("spin")}))})),e}function it(t,e){var n="",i=$("#site-selector");$.each(t,(function(){n+="<option "+(this.toString()===e?"selected ":"")+"value='"+rn(this)+"'>"+this+"</option>"})),$("#info-list").find("li[data-role='list-divider']").text(e),i.html(n),i.parent().parent().hasClass("ui-select")&&i.selectmenu("refresh")}function at(t){T("sites",(function(e){var n=Q(e.sites);t in n&&Le((function(){I({current_site:t},X)}))}))}function ot(t){var e,n=function(e){u=e,"function"==typeof t&&t(e)};if(x)chrome.system.network.getNetworkInterfaces((function(t){var i;for(i in t)t.hasOwnProperty(i)&&/^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$/.test(t[i].address)&&(e=t[i].address);n(e)}));else try{networkinterface.getWiFiIPAddress((function(t){e=t.ip,n(e)}))}catch(t){!function(t){t=t||function(){};var e,n,i,a=["192.168.1.1","10.0.1.1","192.168.1.220","192.168.2.1","10.1.1.1","192.168.11.1","192.168.0.1","192.168.0.30","192.168.0.50","192.168.10.1","192.168.20.1","192.168.30.1","192.168.62.1","192.168.102.1","192.168.1.254","192.168.0.227","10.0.0.138","192.168.123.254","192.168.4.1","10.0.0.2","10.0.2.1","10.0.3.1","10.0.4.1","10.0.5.1"],o=a.length,s=0,r=function(t,e){s++,!0===t&&(n=e)};for(i=0;i<o;i++)"string"!=typeof n&&lt(a[i],r);e=setInterval((function(){s!==o&&"string"!=typeof n||(clearInterval(e),"string"==typeof n?t(!0,n):t(!1))}),50)}((function(t,e){n(t?e:void 0)}))}}function st(t){var e=Xe(t.split("."));return 10===e[0]||127===e[0]||172===e[0]&&e[1]>17&&e[1]<32||192===e[0]&&168===e[1]}function rt(t,e){var n,i,a,o,s,r,l,d,c,p=u.split("."),f=1,h=0,m="",v="",b=[],g=!1;for(e=e||0,t="number"==typeof t?t:80,T("sites",(function(t){var e,n=Q(t.sites);for(e in n)n.hasOwnProperty(e)&&b.push(n[e].os_ip)})),a=function(){f++},o=function(t){f++;var e,n,i=$.mobile.path.parseUrl(this.url).authority;if(-1===$.inArray(i,b)){if("text"===this.dataType){if(!(n=t.match(/var\s*ver=(\d+)/)))return;e=n[1]}else{if(!t.hasOwnProperty("fwv"))return;e=t.fwv}h++,m+="<li><a class='ui-btn ui-btn-icon-right ui-icon-carat-r' href='#' data-ip='"+i+"'>"+i+"<p>"+ln("Firmware")+": "+Oe(e)+"</p></a></li>"}},r=function(){if(!0===g)return $.mobile.loading("hide"),clearInterval(l),!1;245===f&&($.mobile.loading("hide"),clearInterval(l),h?((m=$(m)).find("a").on("click",(function(){return function(t){$("#site-select").one("popupafterclose",(function(){tt(t)})).popup("close")}($(this).data("ip")),!1})),function(t){$("#site-select").popup("destroy").remove();var e=$("<div data-role='popup' id='site-select' data-theme='a' data-overlay-theme='b'><div data-role='header' data-theme='b'><h1>"+ln("Select Site")+"</h1></div><div class='ui-content'><ul data-role='none' class='ui-listview ui-corner-all ui-shadow'></ul></div></div>");t&&e.find("ul").html(t),e.one("popupafterclose",(function(){$(this).popup("destroy").remove()})).popup({history:!1,positionTo:"window"}).enhanceWithin().popup("open")}(m)):0===e?rt(8080,1):1===e?rt(80,2):2===e?rt(8080,3):Ge(ln("No new devices were detected on your network")))},p.pop(),s=p.join("."),0===e?c=ln("Scanning for OpenSprinkler"):1===e?c=ln("Scanning for OpenSprinkler Pi"):2===e?c=ln("Scanning for OpenSprinkler (1.8.3)"):3===e&&(c=ln("Scanning for OpenSprinkler Pi (1.8.3)")),$.mobile.loading("show",{html:"<h1>"+c+"</h1><p class='cancel tight center inline-icon'><span class='btn-no-border ui-btn ui-icon-delete ui-btn-icon-notext'></span>"+ln("Cancel")+"</p>",textVisible:!0,theme:"b"}),$(".ui-loader").find(".cancel").one("click",(function(){g=!0})),n=1;n<=244;n++)e<2?(v="/jo",d="json"):d="text",i="http://"+(p=s+"."+n)+(t&&80!==t?":"+t:"")+v,$.ajax({url:i,type:"GET",dataType:d,timeout:6e3,global:!1,error:a,success:o});l=setInterval(r,200)}function lt(t,e){e=e||function(){},t&&""!==t||e(!1),$.ajax({url:"http://"+t,type:"GET",timeout:6e3,global:!1}).then((function(){e(!0,t)}),(function(n){"timeout"===n.statusText?e(!1):e(!0,t)}))}function dt(t){return t=C?Math.round(5/9*(t-32)*10)/10+" &#176;C":Math.round(10*t)/10+" &#176;F"}function ct(t){return t=C?Math.round(25.4*t*10)/10+" mm":Math.round(100*t)/100+" in"}function ut(t){return Math.round(t)+" %"}function pt(){$("#weather").empty().parents(".info-card").addClass("noweather")}function ft(){mt(),$.mobile.document.trigger("weatherUpdateComplete")}function ht(){var t=(new Date).getTime();if(f&&f.providedLocation===P.settings.loc&&t-f.lastUpdated<36e4)ft();else{if(localStorage.weatherData)try{var e=JSON.parse(localStorage.weatherData);if(e.providedLocation===P.settings.loc&&t-e.lastUpdated<36e4)return f=e,void ft()}catch(t){}f=void 0,""!==P.settings.loc?(Be("#weather"),$.ajax({url:m+"/weatherData?loc="+encodeURIComponent(P.settings.loc),contentType:"application/json; charset=utf-8",success:function(t){"object"==typeof t?(A=t.location,f=t,t.lastUpdated=(new Date).getTime(),t.providedLocation=P.settings.loc,localStorage.weatherData=JSON.stringify(t),ft()):pt()}})):pt()}}function mt(){$("#weather").html("<div title='"+f.description+"' class='wicon'><img src='http://openweathermap.org/img/w/"+f.icon+".png'></div><div class='inline tight'>"+dt(f.temp)+"</div><br><div class='inline location tight'>"+ln("Current Weather")+"</div>"+("object"==typeof f.alert?"<div><button class='tight help-icon btn-no-border ui-btn ui-icon-alert ui-btn-icon-notext ui-corner-all'></button>"+f.alert.type+"</div>":"")).off("click").on("click",(function(){return Ee("#forecast"),!1})).parents(".info-card").removeClass("noweather")}function vt(t){t=t||new Date(1e3*P.settings.devt);var e,n,i=SunCalc.getTimes(t,A[0],A[1]),a=i.sunrise,o=i.sunset,s=(e=P.options.tz-48,n=e>=0?1:-1,(e=60*(Math.abs(e)/4>>0)+(Math.abs(e)%4*15/10>>0)+Math.abs(e)%4*15%10)*n);return a.setUTCMinutes(a.getUTCMinutes()+s),o.setUTCMinutes(o.getUTCMinutes()+s),[a=60*a.getUTCHours()+a.getUTCMinutes(),o=60*o.getUTCHours()+o.getUTCMinutes()]}function bt(t){if("string"!=typeof t)return"";var e="<div class='weatherAttribution'>";switch(t){case"DarkSky":e+="<a href='https://darksky.net/poweredby/' target='_blank'>"+ln("Powered by Dark Sky")+"</a>";break;case"OWM":e+="<a href='https://openweathermap.org/' target='_blank'>"+ln("Powered by OpenWeather")+"</a>";break;case"WUnderground":e+="<a href='https://wunderground.com/' target='_blank'>"+ln("Powered by Weather Underground")+"</a>";break;case"local":e+=ln("Powered by your Local PWS");break;case"Manual":e+=ln("Using manual watering");break;default:e+=ln("Unrecognised weather provider")}return e+"</div>"}var gt={0:ln("None"),1:ln("Factory Reset"),2:ln("Reset Button"),3:ln("WiFi Change"),4:ln("Web Request"),5:ln("Web Request"),6:ln("WiFi Configure"),7:ln("Firmware Update"),8:ln("Weather Failure"),9:ln("Network Failure"),10:ln("Clock Update"),99:ln("Power On")},yt={"-4":ln("Empty Response"),"-3":ln("Timed Out"),"-2":ln("Connection Failed"),"-1":ln("No Response"),0:ln("Success"),1:ln("Weather Data Error"),10:ln("Building Weather History"),11:ln("Weather Provider Respnse Incomplete"),12:ln("Weather Provider Request Failed"),2:ln("Location Error"),20:ln("Location Request Error"),21:ln("Location Not Found"),22:ln("Invalid Location Format"),3:ln("PWS Error"),30:ln("Invalid WUnderground PWS"),31:ln("Invalid WUnderground Key"),32:ln("WUnderground Authentication Error"),33:ln("Unsupported WUnderground Method"),34:ln("No WUnderground PWS Provided"),4:ln("Adjustment Method Error"),40:ln("Unsupported Adjustment Method"),41:ln("No Adjustment Method Provided"),5:ln("Adjustment Options Error"),50:ln("Corrupt Adjustment Options"),51:ln("Missing Adjustment Option"),99:ln("Unexpected Error")};function wt(){var t,e,n,i,a,o,s="<div data-role='popup' id='debugWU' class='ui-content ui-page-theme-a'>";return s+="<div class='debugWUHeading'>System Status</div><table class='debugWUTable'>"+("number"==typeof P.settings.lupt?"<tr><td>"+ln("Last Reboot")+"</td><td>"+(P.settings.lupt<1e3?"--":wn(new Date(1e3*P.settings.lupt),null,2))+"</td></tr>":"")+("number"==typeof P.settings.lrbtc?"<tr><td>"+ln("Reboot Reason")+"</td><td>"+(((n=P.settings.lrbtc)in gt?gt[n]:ln("Unrecognised")+" ("+n+")")+"</td></tr>"):"")+("number"==typeof P.settings.RSSI?"<tr><td>"+ln("WiFi Strength")+"</td><td>"+(ln((e=P.settings.RSSI)<-80?"Unuseable":e<-70?"Poor":e<-60?"Fair":e<-50?"Good":"Excellent")+"</td></tr>"):"")+("number"==typeof P.settings.wterr?"<tr><td>"+ln("Weather Service")+"</td><td>"+(((t=P.settings.wterr)<0?"<font class='debugWUError'>"+ln("Offline")+"</font>":t>0?"<font class='debugWUError'>"+ln("Error")+"</font>":"<font class='debugWUOK'>"+ln("Online")+"</font>")+"</td></tr>"):"")+"</table><div class='debugWUHeading'>Watering Level</div><table class='debugWUTable'>"+(void 0!==P.options.uwt?"<tr><td>"+ln("Method")+"</td><td>"+$t(P.options.uwt).name+"</td></tr>":"")+(void 0!==P.options.wl?"<tr><td>"+ln("Watering Level")+"</td><td>"+P.options.wl+" %</td></tr>":"")+("number"==typeof P.settings.lswc?"<tr><td>"+ln("Last Updated")+"</td><td>"+(0===P.settings.lswc?ln("Never"):function(t,e){var n,i=Math.floor((e-t)/1e3),a=i>0;if((i=Math.abs(i))<10)return ln("Just Now");var o=Math.floor(i/31536e3);o>=1?n=ln(o>1?"years":"year"):(o=Math.floor(i/2592e3))>=1?n=ln(o>1?"months":"month"):(o=Math.floor(i/86400))>=1?n=ln(o>1?"days":"day"):(o=Math.floor(i/3600))>=1?n=ln(o>1?"hours":"hour"):(o=Math.floor(i/60),n=ln(o>=1?o>1?"minutes":"minute":(o=i)>1?"seconds":"second"));return a?ln("In")+" "+o+" "+n:o+" "+n+" "+ln("ago")}(1e3*P.settings.devt,1e3*P.settings.lswc))+"</td></tr>":"")+"</table><div class='debugWUHeading'>Weather Service Details</div><div class='debugWUScrollable'><table class='debugWUTable'>","object"==typeof P.settings.wtdata&&Object.keys(P.settings.wtdata).length>0&&(s+=(void 0!==P.settings.wtdata.h?"<tr><td>"+ln("Mean Humidity")+"</td><td>"+ut(P.settings.wtdata.h)+"</td></tr>":"")+(void 0!==P.settings.wtdata.t?"<tr><td>"+ln("Mean Temp")+"</td><td>"+dt(P.settings.wtdata.t)+"</td></tr>":"")+(void 0!==P.settings.wtdata.p?"<tr><td>"+ln("Total Rain")+"</td><td>"+ct(P.settings.wtdata.p)+"</td></tr>":"")+(void 0!==P.settings.wtdata.eto?"<tr><td>"+ln("ETo")+"</td><td>"+ct(P.settings.wtdata.eto)+"</td></tr>":"")+(void 0!==P.settings.wtdata.radiation?"<tr><td>"+ln("Mean Radiation")+"</td><td>"+P.settings.wtdata.radiation+" kWh/m2</td></tr>":"")+(void 0!==P.settings.wtdata.minT?"<tr><td>"+ln("Min Temp")+"</td><td>"+dt(P.settings.wtdata.minT)+"</td></tr>":"")+(void 0!==P.settings.wtdata.maxT?"<tr><td>"+ln("Max Temp")+"</td><td>"+dt(P.settings.wtdata.maxT)+"</td></tr>":"")+(void 0!==P.settings.wtdata.minH?"<tr><td>"+ln("Min Humidity")+"</td><td>"+ut(P.settings.wtdata.minH)+"</td></tr>":"")+(void 0!==P.settings.wtdata.maxH?"<tr><td>"+ln("Max Humidity")+"</td><td>"+ut(P.settings.wtdata.maxH)+"</td></tr>":"")+(void 0!==P.settings.wtdata.wind?"<tr><td>"+ln("Mean Wind")+"</td><td>"+(i=P.settings.wtdata.wind,(i=C?Math.round(1.6*i*10)/10+" km/h":Math.round(10*i)/10+" mph")+"</td></tr>"):"")),s+="number"==typeof P.settings.lwc?"<tr><td>"+ln("Last Request")+"</td><td>"+wn(new Date(1e3*P.settings.lwc),null,2)+"</td></tr>":"",s+="number"==typeof P.settings.wterr?"<tr><td>"+ln("Last Response")+"</td><td>"+(a=P.settings.wterr,o=Math.floor(a/10),(a in yt?yt[a]:a<=59&&a>=10&&o in yt?yt[o]:ln("Unrecognised")+" ("+a+")")+"</td></tr>"):"",s+="</table></div>","string"==typeof P.settings.wtdata.weatherProvider&&(s+="<hr>",s+=bt(P.settings.wtdata.weatherProvider)),s+="</div>",Ne($(s)),!1}function kt(){$(".ui-popup-active").find("[data-role='popup']").popup("close"),Ue({title:ln("Change Rain Delay"),callback:ie,label:ln("Duration"),maximum:31536e3,granularity:2,preventCompression:!0,incrementalUpdate:!1,updateOnChange:!1,helptext:ln("Enable manual rain delay by entering a value into the input below. To turn off a currently enabled rain delay use a value of 0.")})}function $t(t){var e=[{name:ln("Manual"),id:0},{name:"Zimmerman",id:1},{name:ln("Auto Rain Delay"),id:2,minVersion:216},{name:"ETo",id:3,minVersion:216}];return void 0===t?e:e[-129&t]}function xt(){return-129&P.options.uwt}var _t,St,Ct,Tt,It=function(t){t=t instanceof $?t:$(t),$(".ui-popup-active").find("[data-role='popup']").popup("close"),_t=$(".ui-page-active"),St=_t.attr("id"),Ct=_t.hasClass("show-hidden"),(Tt=$("<div data-role='popup' data-theme='a' id='mainMenu'><ul data-role='listview' data-inset='true' data-corners='false'><li data-role='list-divider'>"+ln("Information")+"</li><li><a href='#preview' class='squeeze'>"+ln("Preview Programs")+"</a></li>"+(Ie(206)||Te("1.9")?"<li><a href='#logs'>"+ln("View Logs")+"</a></li>":"")+"<li data-role='list-divider'>"+ln("Programs and Settings")+"</li><li><a href='#raindelay'>"+ln("Change Rain Delay")+"</a></li><li><a href='#runonce'>"+ln("Run-Once Program")+"</a></li><li><a href='#programs'>"+ln("Edit Programs")+"</a></li><li><a href='#os-options'>"+ln("Edit Options")+"</a></li>"+(Ie(210)?"":"<li><a href='#manual'>"+ln("Manual Control")+"</a></li>")+("sprinklers"===St||"runonce"===St||"programs"===St||"manual"===St||"addprogram"===St?"</ul><div class='ui-grid-a ui-mini tight'><div class='ui-block-a'><a class='ui-btn tight' href='#show-hidden'>"+ln(Ct?"Hide":"Show")+" "+ln("Disabled")+"</a></div><div class='ui-block-b'><a class='ui-btn red tight' href='#stop-all'>"+ln("Stop All Stations")+"</a></div></div>":"<li><a class='ui-btn red' href='#stop-all'>"+ln("Stop All Stations")+"</a></li></ul>")+"</div>")).on("click","a",(function(){var t=$(this).attr("href");return Tt.popup("close"),"#stop-all"===t?Ce():"#show-hidden"===t?Ct?($(".station-hidden").hide(),_t.removeClass("show-hidden")):($(".station-hidden").show(),_t.addClass("show-hidden")):"#raindelay"===t?kt():Ve((function(){Ee(t)})),!1})),$("#mainMenu").remove(),Tt.one("popupafterclose",(function(){t.show()})),Ne(Tt,{positionTo:t}),t.hide()},jt=function(){var t,e,n,i,a,o,r,l,d,c,u,p,m,v,b=$("<div data-role='page' id='sprinklers'><div class='ui-panel-wrapper'><div class='ui-content' role='main'><div class='ui-grid-a ui-body ui-corner-all info-card noweather'><div class='ui-block-a'><div id='weather' class='pointer'></div></div><div class='ui-block-b center home-info pointer'><div class='sitename bold'></div><div id='clock-s' class='nobr'></div>"+ln("Water Level")+": <span class='waterlevel'></span>%</div></div><div id='os-running-stations'></div><hr style='display:none' class='content-divider'><div id='os-stations-list' class='card-group center'></div></div></div></div>"),y=function(t,e){L["station-"+t]={val:e,station:t,update:function(){b.find("#countdown-"+t).text("("+tn(this.val)+" "+ln("remaining")+")")},done:function(){b.find("#countdown-"+t).parent("p").empty().siblings(".station-status").removeClass("on").addClass("off")}}},w=function(s){var u=P.stations.snames[s],f=P.settings.ps[s][0]>0,h=P.status[s]>0,m=f?Qt(P.settings.ps[s][0]):"",b=P.settings.ps[s][1],g=!!v[p].images[s];P.status[s]&&b>0&&y(s,b),c+="<div data-station='"+s+"' class='ui-corner-all card"+(Mt(s)?" station-hidden' style='display:none":"")+"'>",c+="<div class='ui-body ui-body-a center'>",c+="<img src='"+(g?"data:image/jpeg;base64,"+v[p].images[s]:fn()+"img/placeholder.png")+"' />",c+="<p class='station-name center inline-icon' id='station_"+s+"'>"+u+"</p>",c+="<span class='btn-no-border ui-btn ui-btn-icon-notext ui-corner-all card-icon station-status "+(h?"on":f?"wait":"off")+"'></span>",c+="<span class='btn-no-border ui-btn ui-btn-icon-notext ui-icon-wifi card-icon special-station "+(Pt(s)?"":"hidden")+"'></span>",c+="<span class='btn-no-border ui-btn "+(Dt(s)?"ui-icon-master":"ui-icon-gear")+" card-icon ui-btn-icon-notext station-settings' data-station='"+s+"' id='attrib-"+s+"' "+(t?"data-um='"+(P.stations.masop[parseInt(s/8)]&1<<s%8?1:0)+"' ":"")+(e?"data-um2='"+(P.stations.masop2[parseInt(s/8)]&1<<s%8?1:0)+"' ":"")+(n?"data-ir='"+(P.stations.ignore_rain[parseInt(s/8)]&1<<s%8?1:0)+"' ":"")+(i?"data-sn1='"+(P.stations.ignore_sn1[parseInt(s/8)]&1<<s%8?1:0)+"' ":"")+(a?"data-sn2='"+(P.stations.ignore_sn2[parseInt(s/8)]&1<<s%8?1:0)+"' ":"")+(o?"data-ar='"+(P.stations.act_relay[parseInt(s/8)]&1<<s%8?1:0)+"' ":"")+(r?"data-sd='"+(P.stations.stn_dis[parseInt(s/8)]&1<<s%8?1:0)+"' ":"")+(l?"data-us='"+(P.stations.stn_seq[parseInt(s/8)]&1<<s%8?1:0)+"' ":"")+(d?"data-hs='"+(P.stations.stn_spe[parseInt(s/8)]&1<<s%8?1:0)+"' ":"")+"></span>",Dt(s)||(f||h)&&(c+="<p class='rem center'>"+(h?ln("Running")+" "+m:ln("Scheduled")+" "+(P.settings.ps[s][2]?ln("for")+" "+wn(new Date(1e3*P.settings.ps[s][2])):m)),b>0&&(c+=" <span id='countdown-"+s+"' class='nobr'>("+tn(b)+" "+ln("remaining")+")</span>"),c+="</p>"),c+="</div></div>"},k=function(){$("#stn_attrib").popup("destroy").remove();var c=$(this),u=c.data("station"),f=c.siblings("[id='station_"+u+"']"),h=function(){var t=b.find("#http-server").val()+","+b.find("#http-port").val()+","+b.find("#http-on").val()+","+b.find("#http-off").val(),e=encodeURIComponent(t).length;b.find("#character-count").text(240-e),e>240?(b.find(".attrib-submit").addClass("ui-disabled"),b.find("#character-tracking").addClass("red-text bold")):(b.find(".attrib-submit").removeClass("ui-disabled"),b.find("#character-tracking").removeClass("red-text bold"))},m=function(t){var e,n,i=parseInt(b.find("#hs").val());if(c.data("hs",i),1===i)c.data("specialData",b.find("#rf-code").val());else if(2===i){for(var a=b.find("#remote-address").val().split("."),o=parseInt(b.find("#remote-port").val())||80,r=(b.find("#remote-station").val()||1)-1,l="",d=0;d<4;d++)l+=sn(parseInt(a[d]).toString(16));if(l+=(o<256?"00":"")+sn(o.toString(16)),l+=sn(r.toString(16)),!0!==t)return $.mobile.loading("show"),b.find(".attrib-submit").addClass("ui-disabled"),n=function(t){var e;if(!0!==t){!1===t||-1===t?e=ln("Unable to reach the remote station."):-2===t?e=ln("Password on remote controller does not match the password on this controller."):-3===t&&(e=ln("Remote controller is not configured as an extender. Would you like to do this now?")),b.one("popupafterclose",(function(){$.mobile.loading("hide"),n.css("opacity","")})),$.mobile.loading("show",{html:"<h1>"+e+"</h1><button class='ui-btn cancel'>"+ln("Cancel")+"</button><button class='ui-btn continue'>"+ln("Continue")+"</button>",textVisible:!0,theme:"b"});var n=$(".ui-loader");n.css("opacity",".96"),n.find(".cancel").one("click",(function(){$.mobile.loading("hide"),n.css("opacity","")})),n.find(".continue").one("click",(function(){var e;$.mobile.loading("hide"),n.css("opacity",""),-3===t&&(e=Ut(e=l),$.ajax({url:"http://"+e.ip+":"+e.port+"/cv?re=1&pw="+encodeURIComponent(s),type:"GET",dataType:"json"})),m(!0)})),b.find(".attrib-submit").removeClass("ui-disabled")}else m(!0)},e=Ut(e=l),void $.ajax({url:"http://"+e.ip+":"+e.port+"/jo?pw="+encodeURIComponent(s),type:"GET",dataType:"json"}).then((function(t){"object"==typeof t&&t.hasOwnProperty("fwv")?1===Object.keys(t).length?n(-2):t.hasOwnProperty("re")&&0!==t.re?n(!0):n(-3):n(-1)}),(function(){n(!1)}));c.data("specialData",l)}else if(3===i){var h=sn(b.find("#gpio-pin").val()||"05");h+=b.find("#active-state").val()||"1",c.data("specialData",h)}else if(4===i){var g=b.find("#http-server").val();g+=","+b.find("#http-port").val(),g+=","+b.find("#http-on").val(),g+=","+b.find("#http-off").val(),c.data("specialData",g)}c.data("um",b.find("#um").is(":checked")?1:0),c.data("um2",b.find("#um2").is(":checked")?1:0),c.data("ir",b.find("#ir").is(":checked")?1:0),c.data("sn1",b.find("#sn1").is(":checked")?1:0),c.data("sn2",b.find("#sn2").is(":checked")?1:0),c.data("ar",b.find("#ar").is(":checked")?1:0),c.data("sd",b.find("#sd").is(":checked")?1:0),c.data("us",b.find("#us").is(":checked")?1:0),f.html(b.find("#stn-name").val()),v[p].notes[u]=b.find("#stn-notes").val(),I({sites:JSON.stringify(v)},ue),x(u),b.popup("destroy").remove()},b="<div data-overlay-theme='b' data-role='popup' data-theme='a' id='stn_attrib'><fieldset style='margin:0' data-mini='true' data-corners='false' data-role='controlgroup'><form><div id='station-tabs'>";if("number"!=typeof u)return!1;d&&(b+="<ul class='tabs'><li class='current' data-tab='tab-basic'>Basic</li><li data-tab='tab-advanced'>Advanced</li></ul>"),b+="<div id='tab-basic' class='tab-content current'>",b+="<div class='ui-bar-a ui-bar'>"+ln("Station Name")+":</div><input class='bold center' data-corners='false' data-wrapper-class='tight stn-name ui-btn' id='stn-name' type='text' value='"+f.text()+"'>",void 0!==navigator.camera&&"function"==typeof navigator.camera.getPicture&&(b+="<button class='changeBackground'>"+("string"!=typeof v[p].images[u]?ln("Add"):ln("Change"))+" "+ln("Image")+"</button>"),Dt(u)||(t&&(b+="<label for='um'><input class='needsclick' data-iconpos='right' id='um' type='checkbox' "+(1===c.data("um")?"checked='checked'":"")+">"+ln("Use Master")+" "+(e?"1":"")+"</label>"),e&&(b+="<label for='um2'><input class='needsclick' data-iconpos='right' id='um2' type='checkbox' "+(1===c.data("um2")?"checked='checked'":"")+">"+ln("Use Master")+" 2</label>"),n&&(b+="<label for='ir'><input class='needsclick' data-iconpos='right' id='ir' type='checkbox' "+(1===c.data("ir")?"checked='checked'":"")+">"+ln("Ignore Rain")+"</label>"),i&&(b+="<label for='sn1'><input class='needsclick' data-iconpos='right' id='sn1' type='checkbox' "+(1===c.data("sn1")?"checked='checked'":"")+">"+ln("Ignore Sensor 1")+"</label>"),a&&(b+="<label for='sn2'><input class='needsclick' data-iconpos='right' id='sn2' type='checkbox' "+(1===c.data("sn2")?"checked='checked'":"")+">"+ln("Ignore Sensor 2")+"</label>"),o&&(b+="<label for='ar'><input class='needsclick' data-iconpos='right' id='ar' type='checkbox' "+(1===c.data("ar")?"checked='checked'":"")+">"+ln("Activate Relay")+"</label>"),r&&(b+="<label for='sd'><input class='needsclick' data-iconpos='right' id='sd' type='checkbox' "+(1===c.data("sd")?"checked='checked'":"")+">"+ln("Disable")+"</label>"),l&&(b+="<label for='us'><input class='needsclick' data-iconpos='right' id='us' type='checkbox' "+(1===c.data("us")?"checked='checked'":"")+">"+ln("Sequential")+"</label>")),b+="<div class='ui-bar-a ui-bar'>"+ln("Station Notes")+":</div><textarea data-corners='false' class='tight stn-notes' id='stn-notes'>"+(v[p].notes[u]?v[p].notes[u]:"")+"</textarea>",b+="</div>",d&&(b+="<div id='tab-advanced' class='tab-content'><div class='ui-bar-a ui-bar'>"+ln("Station Type")+":</div><select data-mini='true' id='hs'"+(Pt(u)?" class='ui-disabled'":"")+"><option data-hs='0' value='0'"+(Pt(u)?"":"selected")+">"+ln("Standard")+"</option><option data-hs='1' value='1'>"+ln("RF")+"</option><option data-hs='2' value='2'>"+ln("Remote")+"</option><option data-hs='3' value='3'"+(Ie(217)?">":" disabled>")+ln("GPIO")+"</option><option data-hs='4' value='4'"+(Ie(217)?">":" disabled>")+ln("HTTP")+"</option></select><div id='specialOpts'></div></div></div>"),b+="<input data-wrapper-class='attrib-submit' data-theme='b' type='submit' value='"+ln("Submit")+"' /></form></fieldset></div>",(b=$(b).enhanceWithin().on("submit","form",(function(){return m(u),!1}))).find("ul.tabs li").click((function(){var t=$(this).attr("data-tab");$("ul.tabs li").removeClass("current"),$(".tab-content").removeClass("current"),$(this).addClass("current"),$("#"+t).addClass("current")})),b.find("#hs").on("change",(function(){return function(t){var e=b.find("#specialOpts"),n=P.special&&P.special.hasOwnProperty(u)?P.special[u].sd:"",i=P.special&&P.special.hasOwnProperty(u)?P.special[u].st:0;if(e.empty(),0===t)e.append("<p class='special-desc center small'>"+ln("Select the station type using the dropdown selector above and configure the station properties.")+"</p>").enhanceWithin();else if(1===t)n=i===t?n:"0000000000000000",e.append("<div class='ui-bar-a ui-bar'>"+ln("RF Code")+":</div><input class='center' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='rf-code' required='true' type='text' value='"+n+"'>").enhanceWithin();else if(2===t)n=Ut(i===t?n:"00000000005000"),e.append("<div class='ui-bar-a ui-bar'>"+ln("Remote Address")+":</div><input class='center' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='remote-address' required='true' type='text' pattern='^(?:[0-9]{1,3}.){3}[0-9]{1,3}$' value='"+n.ip+"'><div class='ui-bar-a ui-bar'>"+ln("Remote Port")+":</div><input class='center' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='remote-port' required='true' type='number' placeholder='80' min='0' max='65535' value='"+n.port+"'><div class='ui-bar-a ui-bar'>"+ln("Remote Station (index)")+":</div><input class='center' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='remote-station' required='true' type='number' min='1' max='48' placeholder='1' value='"+(n.station+1)+"'>").enhanceWithin();else if(3===t){var a,o,s=5,r=1;"OSPi"===Me()?a=[5,6,7,8,9,10,11,12,13,16,18,19,20,21,23,24,25,26]:"2.3"===Me()&&(a=[2,10,12,13,14,15,18,19]),i===t&&(n=n.split(""),s=parseInt(n[0]+n[1]),r=parseInt(n[2])),o="<div class='ui-bar-a ui-bar'>"+ln("GPIO Pin")+":</div><select class='center' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='gpio-pin'>";for(var l=0;l<a.length;l++)o+="<option value='"+a[l]+"' "+(a[l]===s?"selected='selected'":"")+">"+a[l];o+="</select>",o+="<div class='ui-bar-a ui-bar'>"+ln("Active State")+":</div><select class='center' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='active-state'><option value='1' "+(1===r?"selected='selected'":"")+">"+ln("HIGH")+"<option value='0' "+(0===r?"selected='selected'":"")+">"+ln("LOW")+"</select>",e.append(o).enhanceWithin()}else 4===t&&(n=i===t?n.split(","):["server","80","On","Off"],e.append("<div class='ui-bar-a ui-bar'>"+ln("Server Name")+":</div><input class='center  validate-length' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='http-server' required='true' type='text' value='"+n[0]+"'><div class='ui-bar-a ui-bar'>"+ln("Server Port")+":</div><input class='center  validate-length' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='http-port' required='true' type='number' min='0' max='65535' value='"+parseInt(n[1])+"'><div class='ui-bar-a ui-bar'>"+ln("On Command")+":</div><input class='center validate-length' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='http-on' required='true' type='text' value='"+n[2]+"'><div class='ui-bar-a ui-bar'>"+ln("Off Command")+":</div><input class='center validate-length' data-corners='false' data-wrapper-class='tight ui-btn stn-name' id='http-off' required='true' type='text' value='"+n[3]+"'><div class='center smaller' id='character-tracking' style='color:#999;'><p>"+ln("Note: There is a limit on the number of character used to configure this station type.")+"</p><span>"+ln("Characters remaining")+": </span><span id='character-count'>placeholder</span></div>").enhanceWithin(),h(),$(".validate-length").on("input",h))}(parseInt($(this).val())),!1})),Pt(u)?Z((function(){b.find("#hs").removeClass("ui-disabled").find("option[data-hs='"+P.special[u].st+"']").prop("selected",!0),b.find("#hs").change()})):(b.find("#hs").removeClass("ui-disabled"),b.find("option[data-hs='0']").prop("selected",!0),b.find("#hs").change()),b.find(".changeBackground").on("click",(function(t){t.preventDefault();var e=this;Fe((function(t){v[p].images[u]=t,I({sites:JSON.stringify(v)},ue),C(),e.innerHTML=ln("Change")+" "+ln("Image")}))})),$.mobile.pageContainer.append(b);var y,w={history:!1};if(g){var k={x:((y=$.mobile.window)[0].innerWidth||y.width())/2+y.scrollLeft(),y:y.scrollTop()+22.5};w.x=k.x,w.y=k.y}else w.positionTo="window";b.popup(w).popup("open")},x=function(s){var c,u,p,f,h=!0===Ie(208),m={},v={},g={},y={},w={},k={},x={},_={},S={},C={};for(u=0;u<P.settings.nbrd;u++)for(t&&(m["m"+u]=0),e&&(v["n"+u]=0),l&&(g["q"+u]=0),d&&(y["p"+u]=0),n&&(w["i"+u]=0),i&&(k["j"+u]=0),a&&(x["k"+u]=0),o&&(_["a"+u]=0),r&&(S["d"+u]=0),f=0;f<8;f++)p=8*u+f,c=b.find("#attrib-"+p),t&&(m["m"+u]=m["m"+u]+(c.data("um")<<f)),e&&(v["n"+u]=v["n"+u]+(c.data("um2")<<f)),l&&(g["q"+u]=g["q"+u]+(c.data("us")<<f)),d&&(y["p"+u]=y["p"+u]+((c.data("hs")?1:0)<<f)),n&&(w["i"+u]=w["i"+u]+(c.data("ir")<<f)),i&&(k["j"+u]=k["j"+u]+(c.data("sn1")<<f)),a&&(x["k"+u]=x["k"+u]+(c.data("sn2")<<f)),o&&(_["a"+u]=_["a"+u]+(c.data("ar")<<f)),r&&(S["d"+u]=S["d"+u]+(c.data("sd")<<f)),p===s&&(C["s"+p]=h?b.find("#station_"+p).text().replace(/\s/g,"_"):b.find("#station_"+p).text(),d&&c.data("hs")&&(y.st=c.data("hs"),y.sd=c.data("specialData"),y.sid=s));$.mobile.loading("show"),B("/cs?pw=&"+$.param(C)+(t?"&"+$.param(m):"")+(e?"&"+$.param(v):"")+(l?"&"+$.param(g):"")+(d?"&"+$.param(y):"")+(n?"&"+$.param(w):"")+(i?"&"+$.param(k):"")+(a?"&"+$.param(x):"")+(o?"&"+$.param(_):"")+(r?"&"+$.param(S):"")).done((function(){Ge(ln("Stations have been updated")),H((function(){$("html").trigger("datarefresh")}))}))},_=function(){L.clock={val:P.settings.devt,update:function(){b.find("#clock-s").text(wn(new Date(1e3*this.val),null,1))}}},S=function(){var t=b.find("#os-stations-list"),e=b.find("#os-running-stations"),n=b.find(".content-divider"),i=function(t,e){return(t=$(t).data("station"))<(e=$(e).data("station"))?-1:t>e?1:0};t.find(".station-status.on").parents(".card").appendTo(e),e.find(".station-status.off").parents(".card").appendTo(t),t.children().sort(i).detach().appendTo(t),e.children().sort(i).detach().appendTo(e),0===e.children().length?n.hide():n.show()},C=function(){var s,f,h,m,g,k,x,C=b.find("#os-stations-list"),T=C.children(),I=b.find("#os-running-stations").children();if(b.hasClass("ui-page-active")){_(),j(),T.length+I.length>P.stations.snames.length&&(I.detach().appendTo(C),(T=C.children()).each((function(){var t=$(this);t.data("station")>=P.stations.snames.length&&t.remove()}))),b.find(".waterlevel").text(P.options.wl),b.find(".sitename").text(u.val()),t=!!P.options.mas,e=!!P.options.mas2,n="object"==typeof P.stations.ignore_rain,i="object"==typeof P.stations.ignore_sn1,a="object"==typeof P.stations.ignore_sn2,o="object"==typeof P.stations.act_relay,r="object"==typeof P.stations.stn_dis,l="object"==typeof P.stations.stn_seq,d="object"==typeof P.stations.stn_spe;for(var O=0;O<P.stations.snames.length;O++)s=P.settings.ps[O][0]>0,f=P.status[O]>0,h=s?Qt(P.settings.ps[O][0]):"",m=P.settings.ps[O][1],x=!!v[p].images[O],0===(g=T.filter("[data-station='"+O+"']")).length&&(g=I.filter("[data-station='"+O+"']")),0===g.length?(c="",w(O),C.append(c)):(g.find(".ui-body > img").attr("src",x?"data:image/jpeg;base64,"+v[p].images[O]:fn()+"img/placeholder.png"),Mt(O)?(b.hasClass("show-hidden")||g.hide(),g.addClass("station-hidden")):g.show().removeClass("station-hidden"),g.find("#station_"+O).text(P.stations.snames[O]),g.find(".special-station").removeClass("hidden").addClass(Pt(O)?"":"hidden"),g.find(".station-status").removeClass("on off wait").addClass(f?"on":s?"wait":"off"),Dt(O)?g.find(".station-settings").removeClass("ui-icon-gear").addClass("ui-icon-master"):g.find(".station-settings").removeClass("ui-icon-master").addClass("ui-icon-gear"),g.find(".station-settings").data({um:t?P.stations.masop[parseInt(O/8)]&1<<O%8?1:0:void 0,um2:e?P.stations.masop2[parseInt(O/8)]&1<<O%8?1:0:void 0,ir:n?P.stations.ignore_rain[parseInt(O/8)]&1<<O%8?1:0:void 0,sn1:i?P.stations.ignore_sn1[parseInt(O/8)]&1<<O%8?1:0:void 0,sn2:a?P.stations.ignore_sn2[parseInt(O/8)]&1<<O%8?1:0:void 0,ar:o?P.stations.act_relay[parseInt(O/8)]&1<<O%8?1:0:void 0,sd:r?P.stations.stn_dis[parseInt(O/8)]&1<<O%8?1:0:void 0,us:l?P.stations.stn_seq[parseInt(O/8)]&1<<O%8?1:0:void 0,hs:d?P.stations.stn_spe[parseInt(O/8)]&1<<O%8?1:0:void 0}),Dt(O)||!s&&!f?g.find(".rem").remove():(k=f?ln("Running")+" "+h:ln("Scheduled")+" "+(P.settings.ps[O][2]?ln("for")+" "+wn(new Date(1e3*P.settings.ps[O][2])):h),m>0&&(k+=" <span id='countdown-"+O+"' class='nobr'>("+tn(m)+" "+ln("remaining")+")</span>",P.status[O]&&y(O,m)),0===g.find(".rem").length?g.find(".ui-body").append("<p class='rem center'>"+k+"</p>"):g.find(".rem").html(k)));S()}},j=function(t){t=t||function(){},p=u.val(),T("sites",(function(e){"object"!=typeof(v=Q(e.sites))[p].images||$.isEmptyObject(v[p].images)?(v[p].images={},b.removeClass("has-images")):b.addClass("has-images"),"object"!=typeof v[p].notes&&(v[p].notes={}),"object"!=typeof v[p].lastRunTime&&(v[p].lastRunTime={}),t()}))};return b.one("pageshow",(function(){$("html").on("datarefresh",C)})),function(s){if(!an())return!1;t=!!P.options.mas,e=!!P.options.mas2,n="object"==typeof P.stations.ignore_rain,i="object"==typeof P.stations.ignore_sn1,a="object"==typeof P.stations.ignore_sn2,o="object"==typeof P.stations.act_relay,r="object"==typeof P.stations.stn_dis,l="object"==typeof P.stations.stn_seq,d="object"==typeof P.stations.stn_spe,c="",u=$("#site-selector"),j((function(){for(m=0;m<P.stations.snames.length;m++)w(m);b.find("#os-stations-list").html(c),S()})),b.find(".sitename").toggleClass("hidden",!1).text(u.val()),b.find(".waterlevel").text(P.options.wl),_(),b.on("click",".station-settings",k),b.on("click",".home-info",(function(){return Ee("#os-options",{expandItem:"weather"}),!1})),b.on("click",".card",(function(){if(!Ie(210))return!1;var t,e=$(this),n=e.data("station"),i=P.status[n],a=P.stations.snames[n];if(Dt(n))return!1;if(i)t=ln("Do you want to stop the selected station?");else{if(!e.find("span.nobr").length)return void Ue({title:a,incrementalUpdate:!1,maximum:65535,seconds:v[p].lastRunTime[n]>0?v[p].lastRunTime[n]:0,helptext:ln("Enter a duration to manually run "+a),callback:function(t){B("/cm?sid="+n+"&en=1&t="+t+"&pw=","json").done((function(){P.settings.ps[n][0]=99,P.settings.ps[n][1]=t,At(),Ge(ln("Station has been queued")),v[p].lastRunTime[n]=t,I({sites:JSON.stringify(v)},ue)}))}});t=ln("Do you want to unschedule the selected station?")}Pe(t,P.stations.snames[n],(function(){B("/cm?sid="+n+"&en=0&pw=").done((function(){P.settings.ps[n][0]=0,P.settings.ps[n][1]=0,P.status[m]=0,delete L["station-"+n],At(),Ge(ln("Station has been stopped"))}))}))})).on("click","img",(function(){var t=$(this),e=t.parents(".card").data("station");return-1!==t.attr("src").indexOf("data:image/jpeg;base64")?Pe(ln("Do you want to delete the current image?"),"",(function(){delete v[p].images[e],I({sites:JSON.stringify(v)},ue),C()})):Fe((function(t){v[p].images[e]=t,I({sites:JSON.stringify(v)},ue),C()})),!1})).on({pagebeforeshow:function(){var t=qe({class:"logo",leftBtn:{icon:"bullets",on:function(){return h(),!1}},rightBtn:{icon:"bell",class:"notifications",text:"<span class='notificationCount ui-li-count ui-btn-corner-all'>"+N.length+"</span>",on:function(){return xe(),!1}},animate:!s});0===N.length&&$(t[2]).hide()}}),$("#sprinklers").remove(),$.mobile.pageContainer.append(b),$.isEmptyObject(f)||mt()}}(),Ot=function(){var t=$("<div data-role='page' id='start'><ul data-role='none' id='welcome_list' class='ui-listview ui-listview-inset ui-corner-all'><li><div class='logo' id='welcome_logo'></div></li><li class='ui-li-static ui-body-inherit ui-first-child ui-last-child ui-li-separate'><p class='rain-desc'>"+ln("Welcome to the OpenSprinkler application. This app only works with the OpenSprinkler controller which must be installed and setup on your home network.")+"</p><a class='iab iabNoScale ui-btn ui-mini center' target='_blank' href='https://opensprinkler.com/product/opensprinkler/'>"+ln("Purchase OpenSprinkler")+"</a></li><li class='ui-first-child ui-last-child'><a href='#' class='ui-btn center cloud-login'>"+ln("OpenSprinkler.com Login")+"</a></li><hr class='content-divider'><li id='auto-scan' class='ui-first-child'><a href='#' class='ui-btn ui-btn-icon-right ui-icon-carat-r'>"+ln("Scan For Device")+"</a></li><li class='ui-first-child ui-last-child'><a class='ui-btn ui-btn-icon-right ui-icon-carat-r' data-rel='popup' href='#addnew'>"+ln("Add Controller")+"</a></li></ul></div>"),e=function(){i.addClass("ui-first-child").find("a.ui-btn").text(ln("Add Controller")),n.hide()},n=t.find("#auto-scan"),i=n.next();return t.find("#auto-scan").find("a").on("click",(function(){return rt(),!1})),t.find("a[href='#addnew']").on("click",(function(){tt()})),t.find(".cloud-login").on("click",(function(){return ce(),!1})),t.on("pagehide",(function(){t.detach()})),function(){if(an())return!1;$("#start").remove(),$.mobile.pageContainer.append(t),ot((function(t){void 0!==t&&st(t)?(i.removeClass("ui-first-child").find("a.ui-btn").text(ln("Manually Add Device")),n.show()):e()}))}}();function Dt(t){var e="number"==typeof P.options.mas?P.options.mas:0,n="number"==typeof P.options.mas2?P.options.mas2:0;return e===++t?1:n===t?2:0}function Mt(t){return"object"==typeof P.stations.stn_dis&&(P.stations.stn_dis[parseInt(t/8)]&1<<t%8)>0}function Pt(t){return"object"==typeof P.stations.stn_spe&&(P.stations.stn_spe[parseInt(t/8)]&1<<t%8)>0}function Ut(t){t=t.split("");for(var e,n=[],i={},a=0;a<8;a++)e=parseInt(t[a]+t[a+1],16)||0,n.push(e),a++;return i.ip=n.join("."),i.port=parseInt(t[8]+t[9]+t[10]+t[11],16),i.station=parseInt(t[12]+t[13],16),i}function At(){if(an()){var t=function(){$("html").trigger("datarefresh"),Et()};Ie(216)?H(t,F):$.when(Y(),K(),G()).then(t,F)}}function Rt(){an()&&(Ie(216)?H(null,F):$.when(J(),V()).fail(F))}function Wt(t,e,n,i){var a=$("#footer-running"),o="";i=i||function(){},t>1&&(L.statusbar={val:t,type:"statusbar",update:function(){$("#countdown").text("("+tn(this.val)+" "+ln("remaining")+")")}}),an()&&void 0!==P.settings.curr&&(o+=ln("Current")+": "+P.settings.curr+" mA "),!an()||2!==P.options.urs&&2!==P.options.sn1t||void 0===P.settings.flcrt||void 0===P.settings.flwrt||(o+="<span style='padding-left:5px'>"+ln("Flow")+": "+(re(P.settings.flcrt)/(P.settings.flwrt/60)).toFixed(2)+" L/min</span>"),o=""!==o?n+"<p class='running-text smaller center'>"+o+"</p>":n,a.removeClass().addClass(e).html(o).off("click").on("click",i)}function Et(){var t,e,n,i,a,o,s;if(an())if(1!==P.options.re)if(P.settings.en){for(t={},s=0;s<P.status.length;s++)P.status[s]&&!Dt(s)&&(t[s]=P.status[s]);if(Object.keys(t).length>=2){for(s in e=0,t)t.hasOwnProperty(s)&&(o=P.settings.ps[s][1])>e&&(e=o);return n=Object.keys(t)[0],i="<div><div class='running-icon'></div><div class='running-text pointer'>",i+=Qt(P.settings.ps[n][0])+" "+ln("is running on")+" "+Object.keys(t).length+" "+ln("stations")+" ",e>0&&(i+="<span id='countdown' class='nobr'>("+tn(e)+" "+ln("remaining")+")</span>"),void Wt(e,"green",i+="</div></div>",ze)}for(a=!1,s=0;s<P.stations.snames.length;s++)if(P.settings.ps[s]&&P.settings.ps[s][0]&&P.status[s]&&!Dt(s)){a=!0,i="<div><div class='running-icon'></div><div class='running-text pointer'>",i+=Qt(P.settings.ps[s][0])+" "+ln("is running on station")+" <span class='nobr'>"+P.stations.snames[s]+"</span> ",P.settings.ps[s][1]>0&&(i+="<span id='countdown' class='nobr'>("+tn(P.settings.ps[s][1])+" "+ln("remaining")+")</span>"),i+="</div></div>";break}if(a)Wt(P.settings.ps[s][1],"green",i,ze);else if(P.settings.rd)Wt(0,"red","<p class='running-text center pointer'>"+ln("Rain delay until")+" "+wn(new Date(1e3*P.settings.rdst))+"</p>",(function(){Pe(ln("Do you want to turn off rain delay?"),"",(function(){Be("#footer-running"),B("/cv?pw=&rd=0").done((function(){H()}))}))}));else if(1!==P.options.urs||1!==P.settings.rs)if(1!==P.settings.sn1)if(1!==P.settings.sn2)if(1!==P.settings.mm){var r=P.settings.lrun[2];if(0===r)Wt(0,"transparent","<p class='running-text smaller center pointer'>"+ln("System Idle")+"</p>",ze);else Wt(0,"transparent","<p class='running-text smaller center pointer'>"+Qt(P.settings.lrun[1])+" "+ln("last ran station")+" "+P.stations.snames[P.settings.lrun[0]]+" "+ln("for")+" "+(r/60>>0)+"m "+r%60+"s "+ln("on")+" "+wn(new Date(1e3*(P.settings.lrun[3]-r)))+"</p>",ze)}else Wt(0,"red","<p class='running-text center pointer'>"+ln("Manual mode enabled")+"</p>",(function(){Pe(ln("Do you want to turn off manual mode?"),"",(function(){Be("#footer-running"),B("/cv?pw=&mm=0").done((function(){H()}))}))}));else Wt(0,"red","<p class='running-text center'>Sensor 2 ("+(3===P.options.sn2t?ln("Soil"):ln("Rain"))+ln(") Activated")+"</p>");else Wt(0,"red","<p class='running-text center'>Sensor 1 ("+(3===P.options.sn1t?ln("Soil"):ln("Rain"))+ln(") Activated")+"</p>");else Wt(0,"red","<p class='running-text center'>"+ln("Rain detected")+"</p>")}else Wt(0,"red","<p class='running-text center pointer'>"+ln("System Disabled")+"</p>",(function(){Pe(ln("Do you want to re-enable system operation?"),"",(function(){Be("#footer-running"),B("/cv?pw=&en=1").done((function(){H()}))}))}));else Wt(0,"red","<p class='running-text center pointer'>"+ln("Configured as Extender")+"</p>",(function(){Pe(ln("Do you wish to disable extender mode?"),"",(function(){Be("#footer-running"),B("/cv?pw=&re=0").done((function(){H()}))}))}));else Wt(0,"transparent","<p class='running-text smaller'></p>")}function Nt(t){var e=0,n=0;return $.each(P.stations.snames,(function(i){var a,o=t[i];a=i,("object"==typeof P.stations.stn_seq?(P.stations.stn_seq[parseInt(a/8)]&1<<a%8)>0:P.options.seq)?e+=o:o>n&&(n=o)})),Math.max(e,n)}var Lt=function(){var t,e,n,i=$("<div data-role='page' id='manual'><div class='ui-content' role='main'><p class='center'>"+ln("With manual mode turned on, tap a station to toggle it.")+"</p><fieldset data-role='collapsible' data-collapsed='false' data-mini='true'><legend>"+ln("Options")+"</legend><div class='ui-field-contain'><label for='mmm'><b>"+ln("Manual Mode")+"</b></label><input type='checkbox' data-on-text='On' data-off-text='Off' data-role='flipswitch' name='mmm' id='mmm'></div><p class='rain-desc smaller center' style='padding-top:5px'>"+ln("Station timer prevents a station from running indefinitely and will automatically turn it off after the set duration (or when toggled off)")+"</p><div class='ui-field-contain duration-input'><label for='auto-off'><b>"+ln("Station Timer")+"</b></label><button data-mini='true' name='auto-off' id='auto-off' value='3600'>1h</button></div></fieldset><div id='manual-station-list'></div></div></div>"),a=function(t){Y().done((function(){var e=n.eq(t).find("a");P.options.mas&&(P.status[P.options.mas-1]?n.eq(P.options.mas-1).addClass("green"):n.eq(P.options.mas-1).removeClass("green")),e.text(P.stations.snames[t]),P.status[t]?e.removeClass("yellow").addClass("green"):e.removeClass("green yellow")}))},o=function(){if(!P.settings.mm)return Ge(ln("Manual mode is not enabled. Please enable manual mode then try again.")),!1;var e=$(this),i=e.closest("li"),o=n.index(i),r=o+1,l=s.val();return e.hasClass("yellow")||(t=P.status[o]?Te("2.1")?"/sn?sid="+r+"&set_to=0&pw=":"/sn"+r+"=0":Te("2.1")?"/sn?sid="+r+"&set_to=1&set_time="+l+"&pw=":"/sn"+r+"=1&t="+l,e.removeClass("green").addClass("yellow"),e.html("<p class='ui-icon ui-icon-loading mini-load'></p>"),B(t).always((function(){setTimeout(a,1e3,o)}))),!1},s=i.find("#auto-off");return i.on("pagehide",(function(){i.detach()})),T("autoOff",(function(t){t.autoOff&&(s.val(t.autoOff),s.text(nn(en(t.autoOff))))})),s.on("click",(function(){var t=$(this),e=i.find("label[for='"+t.attr("id")+"']").text();return Ue({seconds:t.val(),title:e,callback:function(e){t.val(e),t.text(nn(en(e))),I({autoOff:e})},maximum:32768}),!1})),i.find("#mmm").on("change",q),function(){var t="<li data-role='list-divider' data-theme='a'>"+ln("Sprinkler Stations")+"</li>";i.find("#mmm").prop("checked",!!P.settings.mm),$.each(P.stations.snames,(function(e,n){Dt(e)?t+="<li data-icon='false' class='center"+(P.status[e]?" green":"")+(Mt(e)?" station-hidden' style='display:none":"")+"'>"+n+" ("+ln("Master")+")</li>":t+="<li data-icon='false'><a class='mm_station center"+(P.status[e]?" green":"")+(Mt(e)?" station-hidden' style='display:none":"")+"'>"+n+"</a></li>"})),e=$("<ul data-role='listview' data-inset='true' id='mm_list'>"+t+"</ul>"),n=e.children("li").slice(1),e.find(".mm_station").on("vclick",o),i.find("#manual-station-list").html(e).enhanceWithin(),qe({title:ln("Manual Control"),leftBtn:{icon:"carat-l",text:ln("Back"),class:"ui-toolbar-back-btn",on:He}}),$("#manual").remove(),$.mobile.pageContainer.append(i)}}(),qt=function(){var t,e,n,i,a,o,s,r,l=$("<div data-role='page' id='runonce'><div class='ui-content' role='main' id='runonce_list'></div></div>"),d=function(t){a.l=t,$("<option value='l' selected='selected'>"+ln("Last Used Program")+"</option>").insertAfter(l.find("#rprog").find("option[value='t']")),u(t)},c=function(){return l.find("[id^='zone-']").val(0).text("0s").removeClass("green"),!1},u=function(t){l.find("[id^='zone-']").each((function(e,n){if(!Dt(e)){var i=$(n);i.val(t[e]).text(Qe(t[e])),t[e]>0?i.addClass("green"):i.removeClass("green")}}))};return l.on("pagehide",(function(){l.detach()})),function(){if(e="<p class='center'>"+ln("Zero value excludes the station from the run-once program.")+"</p>",i=[],P.programs.pd.length)for(o=0;o<P.programs.pd.length;o++){s=Yt(P.programs.pd[o]);var p=[];if(Ie(210))p=s.stations;else{var f=s.stations.split("");for(t=0;t<P.stations.snames.length;t++)p.push(parseInt(f[t])?s.duration:0)}i.push(p)}for(a=i,n="<select data-mini='true' name='rprog' id='rprog'><option value='t'>"+ln("Test All Stations")+"</option><option value='s' selected='selected'>"+ln("Quick Programs")+"</option>",t=0;t<i.length;t++)r=Ie(210)?P.programs.pd[t][5]:ln("Program")+" "+(t+1),n+="<option value='"+t+"'>"+r+"</option>";if(e+=(n+="</select>")+"<form>",$.each(P.stations.snames,(function(t,n){Dt(t)?e+="<div class='ui-field-contain duration-input"+(Mt(t)?" station-hidden' style='display:none":"")+"'><label for='zone-"+t+"'>"+n+":</label><button disabled='true' data-mini='true' name='zone-"+t+"' id='zone-"+t+"' value='0'>Master</button></div>":e+="<div class='ui-field-contain duration-input"+(Mt(t)?" station-hidden' style='display:none":"")+"'><label for='zone-"+t+"'>"+n+":</label><button data-mini='true' name='zone-"+t+"' id='zone-"+t+"' value='0'>0s</button></div>"})),e+="</form><a class='ui-btn ui-corner-all ui-shadow rsubmit' href='#'>"+ln("Submit")+"</a><a class='ui-btn ui-btn-b ui-corner-all ui-shadow rreset' href='#'>"+ln("Reset")+"</a>",l.find(".ui-content").html(e).enhanceWithin(),"object"==typeof P.settings.rodur){var h=0;for(t=0;t<P.settings.rodur.length;t++)h+=P.settings.rodur[t];0!==h&&d(P.settings.rodur)}else T("runonce",(function(t){(t=t.runonce)&&(t=JSON.parse(t),d(t))}));l.find("#rprog").on("change",(function(){var t=$(this).val();"s"!==t?"t"!==t?void 0!==a[t]&&u(a[t]):u(Array.apply(null,Array(P.stations.snames.length)).map((function(){return 60}))):c()})),l.on("click",".rsubmit",Bt).on("click",".rreset",c),l.find("[id^='zone-']").on("click",(function(){var t=$(this),e=l.find("label[for='"+t.attr("id")+"']").text().slice(0,-1);return Ue({seconds:t.val(),title:e,callback:function(e){t.val(e),t.text(Qe(e)),e>0?t.addClass("green"):t.removeClass("green")},maximum:65535,showSun:!!Ie(214)}),!1})),qe({title:ln("Run-Once"),leftBtn:{icon:"carat-l",text:ln("Back"),class:"ui-toolbar-back-btn",on:He},rightBtn:{icon:"check",text:ln("Submit"),on:Bt}}),$("#runonce").remove(),$.mobile.pageContainer.append(l)}}();function Bt(t){t instanceof Array||(t=[],$("#runonce").find("[id^='zone-']").each((function(){t.push(parseInt(this.value)||0)})),t.push(0));var e=function(){$.mobile.loading("show"),I({runonce:JSON.stringify(t)}),B("/cr?pw=&t="+JSON.stringify(t)).done((function(){$.mobile.loading("hide"),$.mobile.document.one("pageshow",(function(){Ge(ln("Run-once program has been scheduled"))})),At(),He()}))},n=function(){for(var t=0;t<P.status.length;t++)if(P.status[t]>0&&P.settings.ps[t][0]>0)return t;return-1}();-1!==n?Pe(ln("Do you want to stop the currently running program?"),Qt(P.settings.ps[n][0]),(function(){var t;$.mobile.loading("show"),t=e,$.mobile.loading("show"),B("/cv?pw=&rsn=1").done((function(){setTimeout((function(){$.mobile.loading("hide"),t()}),1e3)}))})):e()}var Ft=function(){var t,e,n,i,a,o,s,r,l,d,c,u,p,f,h,m,v,g,y=$("<div data-role='page' id='preview'><div class='ui-content' role='main'><div id='preview_header' class='input_with_buttons'><button class='preview-minus ui-btn ui-btn-icon-notext ui-icon-carat-l btn-no-border'></button><input class='center' type='date' name='preview_date' id='preview_date'><button class='preview-plus ui-btn ui-btn-icon-notext ui-icon-carat-r btn-no-border'></button></div><div id='timeline'></div><div data-role='controlgroup' data-type='horizontal' id='timeline-navigation'><a class='ui-btn ui-corner-all ui-icon-plus ui-btn-icon-notext btn-no-border' title='"+ln("Zoom in")+"'></a><a class='ui-btn ui-corner-all ui-icon-minus ui-btn-icon-notext btn-no-border' title='"+ln("Zoom out")+"'></a><a class='ui-btn ui-corner-all ui-icon-carat-l ui-btn-icon-notext btn-no-border' title='"+ln("Move left")+"'></a><a class='ui-btn ui-corner-all ui-icon-carat-r ui-btn-icon-notext btn-no-border' title='"+ln("Move right")+"'></a></div></div></div>"),w=y.find("#timeline"),k=y.find("#timeline-navigation");return y.find("#preview_date").on("change",(function(){p=this.value.split("-"),f=new Date(p[0],p[1]-1,p[2]),u()})),y.one("pagebeforeshow",(function(){Ke(y.find(".preview-plus"),(function(){c(1)})),Ke(y.find(".preview-minus"),(function(){c(-1)}))})),y.on({pagehide:function(){y.detach()},pageshow:function(){u()}}),e=function(e,i,a){t=[];var o,s,d,c,u,p,f,h,b,y,w,k=Math.floor(P.settings.devt/86400),$=0,x=Date.UTC(a,e-1,i,0,0,0,0),_=x/1e3/3600/24>>0,S=8*P.settings.nbrd,C=new Array(S),T=new Array(S),I=new Array(S),j=new Array(S),O=[],D=new Array(S),M=0,U=0;for(c=0;c<S;c++)C[c]=-1,T[c]=0,I[c]=0,j[c]=0,D[c]=255;do{o=0,s=0;for(var A=0;A<P.programs.pd.length;A++)if(d=P.programs.pd[A],n(d,$,x,_,k))for(c=0;c<S;c++)if(h=c>>3,y=c%8,!Dt(c))if(m){if(P.stations.stn_dis[h]&1<<y)continue;if(d[4][c]&&0===I[c]){var R=0;(R=2&d[0]&&(P.options.uwt>0&&_===k||0===P.options.uwt)?zt(d[4][c],x)*P.options.wl/100>>0:zt(d[4][c],x))>0&&(g?O.length<S&&O.push({st:-1,dur:R,sid:c,pid:A+1,pl:1}):(I[c]=R,T[c]=A+1),s=1)}}else d[7+h]&1<<y&&(I[c]=d[6]*P.options.wl/100>>0,T[c]=A+1,s=1);if(s){var W=60*$,E=W;if(v)if(U>W&&(E=U+P.options.sdt),g)for(u=0;u<O.length;u++)(p=O[u]).st>=0||0===p.dur||(b=(c=p.sid)>>3,w=7&c,P.stations.stn_seq[b]&1<<w?(p.st=E,E+=p.dur,E+=P.options.sdt):(p.st=W,W++),o=1);else for(c=0;c<S;c++)b=c>>3,w=7&c,0===I[c]||C[c]>=0||(P.stations.stn_seq[b]&1<<w?(C[c]=E,E+=I[c],I[c]=E,E+=P.options.sdt,j[c]=1):(C[c]=W,I[c]=W+I[c],j[c]=1),o=1);else if(m&&P.options.seq&&M>W&&(W=M+P.options.sdt),P.options.seq)for(c=0;c<8*P.settings.nbrd;c++)0!==I[c]&&0!==T[c]&&(C[c]=W,W+=I[c],I[c]=W,W+=P.options.sdt,o=1);else for(c=0;c<8*P.settings.nbrd;c++)0!==I[c]&&0!==T[c]&&(C[c]=W,I[c]=W+I[c],o=1)}if(g){for(u=0;u<O.length;u++)(f=D[c=(p=O[u]).sid])<255&&O[f].st<p.st||(D[c]=u);for(l(60*$,O,D,x),$++,c=0;c<8*P.settings.nbrd;c++)if(255!==(f=D[c])&&(p=O[f]).st>=0&&60*$>=p.st+p.dur){var N=O.length;f<N-1&&(O[f]=O[N-1],D[O[f].sid]===N-1&&(D[O[f].sid]=f)),O.pop(),D[c]=255}for(U=0,u=0;u<O.length;u++){b=(c=(p=O[u]).sid)>>3,w=7&c;var L=p.st+p.dur;P.stations.stn_seq[b]&1<<w&&L>U&&(U=L)}}else if(o)if(v)for(U=r(60*$,C,T,I,j,x),$++,c=0;c<8*P.settings.nbrd;c++)T[c]>0&&60*$>=I[c]&&(C[c]=-1,T[c]=0,I[c]=0,j[c]=0);else if(m)for(M=r(60*$,C,T,I,j,x),$++,c=0;c<8*P.settings.nbrd;c++)C[c]=-1,T[c]=0,I[c]=0;else{var q=r(60*$,C,T,I,j,x)/60>>0;for(P.options.seq&&$!==q?$=q:$++,c=0;c<8*P.settings.nbrd;c++)C[c]=-1,T[c]=0,I[c]=0}else if($++,v)for(c=0;c<8*P.settings.nbrd;c++)T[c]>0&&60*$>=I[c]&&(C[c]=-1,T[c]=0,I[c]=0,j[c]=0)}while($<1440)},l=function(e,n,i,a){for(var o=0;o<8*P.settings.nbrd;o++){var s=i[o];if(255!==s){var r=n[s];if(r.pl){var l=void 0!==P.options.mas2,c=P.stations.masop[o>>3]&1<<o%8,u=!!l&&P.stations.masop2[o>>3]&1<<o%8;Dt(o)||(P.options.mas>0&&c&&t.push({start:r.st+P.options.mton,end:r.st+r.dur+P.options.mtof,content:"",className:"master",shortname:"M"+(l?"1":""),group:"Master",station:o}),l&&P.options.mas2>0&&u&&t.push({start:r.st+P.options.mton2,end:r.st+r.dur+P.options.mtof2,content:"",className:"master",shortname:"M2",group:"Master 2",station:o})),d(o,r.st,r.pid,r.st+r.dur,a),r.pl=0}}}},r=function(e,n,i,a,o,s){for(var r=e,l=0;l<8*P.settings.nbrd;l++)if(i[l])if(v){if(o[l]){var c=void 0!==P.options.mas2,u=P.stations.masop[l>>3]&1<<l%8,p=!!c&&P.stations.masop2[l>>3]&1<<l%8;Dt(l)||(P.options.mas>0&&u&&t.push({start:n[l]+P.options.mton,end:a[l]+P.options.mtof,content:"",className:"master",shortname:"M"+(c?"1":""),group:"Master",station:l}),c&&P.options.mas2>0&&p&&t.push({start:n[l]+P.options.mton2,end:a[l]+P.options.mtof2,content:"",className:"master",shortname:"M2",group:"Master 2",station:l})),d(l,n[l],i[l],a[l],s),o[l]=0,P.stations.stn_seq[l>>3]&1<<(7&l)&&(r=r>a[l]?r:a[l])}}else 1===P.options.seq?(Dt(l)&&P.stations.masop[l>>3]&1<<l%8&&t.push({start:n[l]+P.options.mton,end:a[l]+P.options.mtof,content:"",className:"master",shortname:"M",group:"Master",station:l}),d(l,n[l],i[l],a[l],s),r=a[l]):(d(l,e,i[l],a[l],s),Dt(l)&&P.stations.masop[l>>3]&1<<l%8&&(r=r>a[l]?r:a[l]));return v||0===P.options.seq&&P.options.mas>0&&t.push({start:e,end:r,content:"",className:"master",shortname:"M",group:"Master",station:l}),r},d=function(e,n,i,a,o){var s="program-"+(i+3)%4,r="P"+i;(0!==P.settings.rd&&o+n+900*(P.options.tz-48)<=1e3*P.settings.rdst||1===P.options.urs&&1===P.settings.rs)&&"object"==typeof P.stations.ignore_rain&&0==(P.stations.ignore_rain[parseInt(e/8)]&1<<e%8)&&(s="delayed"),Ie(210)&&(r=P.programs.pd[i-1][5]),t.push({start:n,end:a,className:s,content:r,pid:i-1,shortname:"S"+(e+1),group:P.stations.snames[e],station:e})},n=function(t,e,n,o,r){return g?s(t,e,n,o,r):m?a(t,e,n,o,r):i(t,e,n,o,r)},i=function(t,e,n,i,a){if(0===t[0])return 0;if(128&t[1]&&t[2]>1){var o=t[2];if(i%o!=(a+(127&t[1]))%o)return 0}else{var s=new Date(n),r=(s.getUTCDay()+6)%7;if(0==(t[1]&1<<r))return 0;var l=s.getUTCDate();if(128&t[1]&&0===t[2]&&l%2!=0)return 0;if(128&t[1]&&1===t[2]&&(31===l||29===l&&1===s.getUTCMonth()||l%2!=1))return 0}return e<t[3]||e>t[4]||le()&&e>=t[4]||0===t[5]?0:((e-t[3])/t[5]>>0)*t[5]==e-t[3]?1:0},o=function(t,e,n,i){var a=t[0]>>2&3,o=t[0]>>4&3,s=new Date(e);if(3===o){var r=t[2];if(n%r!=(i+t[1])%r)return 0}else{if(0!==o)return 0;var l=(s.getUTCDay()+6)%7;if(0==(t[1]&1<<l))return 0}var d=s.getUTCDate();if(2===a){if(d%2!=0)return 0}else if(1===a&&(31===d||29===d&&1===s.getUTCMonth()||d%2!=1))return 0;return 1},a=function(t,e,n,i,a){var s=1&t[0],r=t[0]>>6&1,l=new Date(n);if(0===s)return 0;if(!o(t,n,i,a))return 0;if(0===r){var d=Zt(t[3][0],l),c=t[3][1],u=t[3][2];if(e<d)return 0;if(0===c)return e===d?1:0;if(0===u)return 0;var p=Math.round((e-d)/u);if(p*u==e-d&&p<=c)return 1}else for(var f=t[3],h=0;h<4;h++)if(e===Zt(f[h],l))return 1;return 0},s=function(t,e,n,i,a){var s=1&t[0],r=t[0]>>6&1,l=new Date(n);if(0===s)return 0;var d,c=Zt(t[3][0],l),u=t[3][1],p=t[3][2];if(o(t,n,i,a)){if(0!==r){for(var f=t[3],h=0;h<4;h++)if(e===Zt(f[h],l))return 1;return 0}if(e===c)return 1;if(e>c&&p&&(d=Math.round((e-c)/p))*p==e-c&&d<=u)return 1}return r||!p?0:o(t,n-864e5,i-1,a)&&(d=Math.round((e-c+1440)/p))*p==e-c+1440&&d<=u?1:0},c=function(t){f.setDate(f.getDate()+t);var e=sn(f.getMonth()+1),n=sn(f.getDate()),i=f.getFullYear();p=[i,e,n],y.find("#preview_date").val(p.join("-")),u()},u=function(){if(e(p[1],p[2],p[0]),k.hide(),t.length){t.sort(gn);var n=[],i=new Date(p[0],p[1]-1,p[2],24);$.each(t,(function(){var t=this.start+this.end;if(this.start=new Date(p[0],p[1]-1,p[2],0,0,this.start),t>86400){var e=Math.floor(this.end/86400);this.end=new Date(p[0],p[1]-1,parseInt(p[2])+e,0,0,this.end%86400),i=i>this.end?i:this.end}else this.end=new Date(p[0],p[1]-1,p[2],0,0,this.end);n[this.group]=this.shortname}));var a={width:"100%",editable:!1,axisOnTop:!0,eventMargin:10,eventMarginAxis:0,min:new Date(p[0],p[1]-1,p[2],0),max:i,selectable:!0,showMajorLabels:!1,zoomMax:864e5,zoomMin:36e5,groupsChangeable:!1,showNavigation:!1,groupsOrder:"none",groupMinHeight:20},o=function(){s.redraw()},s=new links.Timeline(w[0],a),r=new Date(h);r.setMinutes(r.getMinutes()+r.getTimezoneOffset()),s.setCurrentTime(r),links.events.addListener(s,"select",(function(){var t=s.getSelection();t.length&&void 0!==t[0].row&&Ee("#programs",{programToExpand:parseInt(s.getItem(t[0].row).pid)})})),$.mobile.window.on("resize",o),y.one("pagehide",(function(){$.mobile.window.off("resize",o)})),s.draw(t),y.find(".timeline-groups-text").each((function(){var t=$(this),e=n[t.text()];t.attr("data-shortname",e)})),y.find(".timeline-groups-axis").children().first().html("<div class='timeline-axis-text center dayofweek' data-shortname='"+on(f,"short")+"'>"+on(f)+"</div>"),b?(k.find(".ui-icon-plus").off("click").on("click",(function(){return s.zoom(.4),!1})),k.find(".ui-icon-minus").off("click").on("click",(function(){return s.zoom(-.4),!1})),k.find(".ui-icon-carat-l").off("click").on("click",(function(){return s.move(-.2),!1})),k.find(".ui-icon-carat-r").off("click").on("click",(function(){return s.move(.2),!1})),k.show()):k.hide(),w.on("swiperight swipeleft",(function(t){t.stopImmediatePropagation()}))}else y.find("#timeline").html("<p align='center'>"+ln("No stations set to run on this day.")+"</p>")},function(){m=Ie(210),v=Ie(211),g=Ie(216),""===y.find("#preview_date").val()&&(h=new Date(1e3*P.settings.devt),p=h.toISOString().slice(0,10).split("-"),f=new Date(p[0],p[1]-1,p[2]),y.find("#preview_date").val(p.join("-"))),qe({title:ln("Program Preview"),leftBtn:{icon:"carat-l",text:ln("Back"),class:"ui-toolbar-back-btn",on:He}}),$("#preview").remove(),$.mobile.pageContainer.append(y)}}();function zt(t,e){if(Ie(214)){var n=vt(e);65535===t?t=60*(n[0]+1440-n[1]):65534===t&&(t=60*(n[1]-n[0]))}return t}var Ht=function(){var t,e,n,i=$("<div data-role='page' id='logs'><div class='ui-content' role='main'><fieldset data-role='controlgroup' data-type='horizontal' data-mini='true' class='log_type'><input data-mini='true' type='radio' name='log_type' id='log_timeline' value='timeline'><label for='log_timeline'>"+ln("Timeline")+"</label><input data-mini='true' type='radio' name='log_type' id='log_table' value='table'><label for='log_table'>"+ln("Table")+"</label></fieldset><fieldset data-role='collapsible' data-mini='true' id='log_options' class='center'><legend>"+ln("Options")+"</legend><fieldset data-role='controlgroup' data-type='horizontal' id='table_sort'><p class='tight'>"+ln("Grouping:")+"</p><input data-mini='true' type='radio' name='table-group' id='table-sort-day' value='day' checked='checked'><label for='table-sort-day'>"+ln("Day")+"</label><input data-mini='true' type='radio' name='table-group' id='table-sort-station' value='station'><label for='table-sort-station'>"+ln("Station")+"</label></fieldset><div class='ui-field-contain'><label for='log_start'>"+ln("Start:")+"</label><input data-mini='true' type='date' id='log_start'><label for='log_end'>"+ln("End:")+"</label><input data-mini='true' type='date' id='log_end'></div><a data-role='button' data-icon='action' class='export_logs' href='#' data-mini='true'>"+ln("Export")+"</a><a data-role='button' class='red clear_logs' href='#' data-mini='true' data-icon='alert'>"+ln("Clear Logs")+"</a></fieldset><div id='logs_list' class='center'></div></div></div>"),a=i.find("#logs_list"),o=i.find("#table_sort"),s=i.find("#log_options"),r=[],l=[],d=[],c=function(e,i){var a=[],o={totalRuntime:0,totalCount:0};if("table"===e&&"station"===i)for(n=0;n<t.length;n++)a[n]=[];return $.each(r,(function(){var n=this[1],s=parseInt(this[2]);s<0&&(s+=65536);var r=new Date(parseInt(1e3*this[3])-1e3*s),l=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds());if("string"==typeof n)if("rd"===n)n=t.length-1;else if("s1"===n)n=t.length-3;else if("s2"===n)n=t.length-2;else{if("rs"!==n)return;n=t.length-2}else if("number"==typeof n){if(n>t.length-2||Dt(n))return;o.totalRuntime+=s,o.totalCount++}if("table"===e)switch(i){case"station":a[n].push([l,nn(en(s))]);break;case"day":var d=Math.floor(r.getTime()/1e3/60/60/24),c=[l,nn(en(s)),n];"object"!=typeof a[d]?a[d]=[c]:a[d].push(c)}else if("timeline"===e){var u,p,f,h,m=parseInt(this[0]);if("rs"===this[1])u="delayed",f=p=ln("Rain Sensor"),h=ln("RS");else if("rd"===this[1])u="delayed",f=p=ln("Rain Delay"),h=ln("RD");else if("s1"===this[1])u="delayed",f=p=3===P.options.sn1t?ln("Soil Sensor"):ln("Rain Sensor"),h=ln("SEN1");else if("s2"===this[1])u="delayed",f=p=3===P.options.sn2t?ln("Soil Sensor"):ln("Rain Sensor"),h=ln("SEN2");else{if(0===m)return;u="program-"+(m+3)%4,p=Qt(m),f=P.stations.snames[n],h="S"+(n+1)}a.push({start:l,end:new Date(l.getTime()+1e3*s),className:u,content:p,pid:m-1,shortname:h,group:f,station:n})}})),"timeline"===e&&a.sort(gn),[a,o]},u=function(t,e){var n=[],i=[];return l.length&&(t.avgWaterLevel=0,$.each(l,(function(){n[Math.floor(this[3]/60/60/24)]=this[2],t.avgWaterLevel+=this[2]})),t.avgWaterLevel=parseFloat((t.avgWaterLevel/l.length).toFixed(2))),d.length&&(t.totalVolume=0,$.each(d,(function(){var n=re(this[0]);if("timeline"===e){var a=new Date(parseInt(1e3*this[3])),o=new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds());i.push({start:new Date(o.getTime()-parseInt(1e3*this[2])),end:o,className:"",content:n+" L",shortname:ln("FS"),group:ln("Flow Sensor")})}else{var s=Math.floor(this[3]/60/60/24);i[s]=i[s]?i[s]+n:n}t.totalVolume+=n}))),[n,i,t]},p=function(t,e,n){if("object"!=typeof t||t.length<1||t.result&&32===t.result)return $.mobile.loading("hide"),void b();try{d=JSON.parse(d.replace(/,\s*inf/g,""))}catch(t){d=[]}r=t,l=$.isEmptyObject(e)?[]:e,d=$.isEmptyObject(n)?[]:n,f(),function(t,e,n){if(e=encodeURIComponent(JSON.stringify(e)),_)$(t).attr({href:"data:text/json;charset=utf-8,"+e,download:"backup-"+(new Date).toLocaleDateString().replace(/\//g,"-")+".json"});else{n=n||"OpenSprinkler Data Export on "+wn(new Date);var i="mailto:?subject="+encodeURIComponent(n)+"&body="+e;$(t).attr("href",i).on("click",(function(){window.open(i)}))}}(".export_logs",r),$.mobile.loading("hide")},f=function(){i.find("#log_table").prop("checked")?m():i.find("#log_timeline").prop("checked")&&h()},h=function(){if(r.length<1)b();else{o.hide(),a.show(),s.collapsible("collapse");var t=c("timeline"),e=u(t[1],"timeline"),n=t[0].concat(e[1]),l=e[2],d={width:"100%",editable:!1,axisOnTop:!0,eventMargin:10,eventMarginAxis:0,min:w().start,max:new Date(w().end.getTime()+8634e4),selectable:!1,showMajorLabels:!1,groupsChangeable:!1,showNavigation:!1,groupsOrder:"none",groupMinHeight:20,zoomMin:6e4},p=function(){m.redraw()},f=function(){$.mobile.window.off("resize",p)},h=[];a.on("swiperight swipeleft",(function(t){t.stopImmediatePropagation()})),$.each(n,(function(){h[this.group]=this.shortname}));var m=new links.Timeline(a.get(0),d);$.mobile.window.on("resize",p),i.one("pagehide",f),i.find("input:radio[name='log_type']").one("change",f),m.draw(n),a.find(".timeline-groups-text").each((function(){this.setAttribute("data-shortname",h[this.textContent])})),a.prepend(v(l))}},m=function(){if(r.length<1)b();else{o.show(),a.show();var e,n,l,d=i.find("input:radio[name='table-group']:checked").val(),p=c("table",d),f=p[0],h=u(p[1]),m=[],g=h[0],y=h[1],w=h[2],k="<table><thead><tr><th data-priority='1'>"+ln("Runtime")+"</th><th data-priority='2'>"+("station"===d?ln("Date/Time"):ln("Time")+"</th><th>"+ln("Station"))+"</th></tr></thead><tbody>",_=v(w)+"<div data-role='collapsible-set' data-inset='true' data-theme='b' data-collapsed-icon='arrow-d' data-expanded-icon='arrow-u'>",S=0;for(e in f)if(f.hasOwnProperty(e)){if(0===(n=f[e].length))continue;for(m[S]="<div data-role='collapsible' data-collapsed='true'><h2>"+(Ie(210)&&"day"===d?"<a class='ui-btn red ui-btn-corner-all delete-day day-"+e+"'>"+ln("delete")+"</a>":"")+"<div class='ui-btn-up-c ui-btn-corner-all custom-count-pos'>"+n+" "+ln(1===n?"run":"runs")+"</div>"+("station"===d?t[e]:wn(new Date(1e3*e*60*60*24)).slice(0,-9))+"</h2>",g[e]&&(m[S]+="<span style='border:none' class='"+(100!==g[e]?g[e]<100?"green ":"red ":"")+"ui-body ui-body-a'>"+ln("Average")+" "+ln("Water Level")+": "+g[e]+"%</span>"),y[e]&&(m[S]+="<span style='border:none' class='ui-body ui-body-a'>"+ln("Total Water Used")+": "+y[e]+" L</span>"),m[S]+=k,l=0;l<f[e].length;l++){var C=new Date(f[e][l][0]);m[S]+="<tr><td>"+f[e][l][1]+"</td><td>"+("station"===d?wn(C,!1):sn(C.getHours())+":"+sn(C.getMinutes())+":"+sn(C.getSeconds())+"</td><td>"+t[f[e][l][2]])+"</td></tr>"}m[S]+="</tbody></table></div>",S++}"day"===d&&m.reverse(),s.collapsible("collapse"),a.html(_+m.join("")+"</div>").enhanceWithin(),a.find(".delete-day").on("click",(function(){var t,e;return $.each(this.className.split(" "),(function(){if(0===this.indexOf("day-"))return t=this.split("day-")[1],!1})),e=wn(new Date(1e3*t*60*60*24)).slice(0,-9),Pe(ln("Are you sure you want to ")+ln("delete")+" "+e+"?","",(function(){$.mobile.loading("show"),B("/dl?pw=&day="+t).done((function(){x(),Ge(e+" "+ln("deleted"))}))})),!1})),Ye(a)}},v=function(t){if(0===t.totalCount||0===t.totalRuntime)return"";var e=void 0!==t.avgWaterLevel;return"<div class='ui-body-a smaller' id='logs_summary'><div><span class='bold'>"+ln("Total Station Events")+"</span>: "+t.totalCount+"</div><div><span class='bold'>"+ln("Total Runtime")+"</span>: "+nn(en(t.totalRuntime))+"</div>"+(e?"<div><span class='bold'>"+ln("Average")+" "+ln("Water Level")+"</span>: <span class='"+(100!==t.avgWaterLevel?t.avgWaterLevel<100?"green-text":"red-text":"")+"'>"+t.avgWaterLevel+"%</span></div>":"")+(void 0!==t.totalVolume&&t.totalVolume>0?"<div><span class='bold'>"+ln("Total Water Used")+"</span>: "+t.totalVolume+" L"+(e&&t.avgWaterLevel<100?" (<span class='green-text'>"+(t.totalVolume-t.totalVolume*(t.avgWaterLevel/100)).toFixed(2)+"L saved</span>)":"")+"</div>":"")+"</div>"},b=function(){r=[],s.collapsible("expand"),o.hide(),a.show().html(ln("No entries found in the selected date range"))},y=function(){$.mobile.loading("hide"),o.empty().hide(),a.show().html(ln("Error retrieving log data. Please refresh to try again."))},w=function(){var t=C.val().split("-"),e=T.val().split("-");return{start:new Date(t[0],t[1]-1,t[2]),end:new Date(e[0],e[1]-1,e[2])}},k=function(){return"start="+w().start.getTime()/1e3+"&end="+(w().end.getTime()/1e3+86340)},x=function(){var t=w().end.getTime()/1e3,e=w().start.getTime()/1e3;if(t<e)return b(),void Ge(ln("Start time cannot be greater than end time"));var n=0;if($.mobile.loading("show"),t-e>3154e4){Ge(ln("The requested time span exceeds the maxiumum of 1 year and has been adjusted"),3500);var i=w().start;i.setFullYear(i.getFullYear()+1),$("#log_end").val(i.getFullYear()+"-"+sn(i.getMonth()+1)+"-"+sn(i.getDate())),n=500}var a=$.Deferred().resolve(),o=$.Deferred().resolve();Ie(211)&&(a=B("/jl?pw=&type=wl&"+k(),"json")),Ie(216)&&(o=B("/jl?pw=&type=fl&"+k())),setTimeout((function(){$.when(B("/jl?pw=&"+k(),"json"),a,o).then(p,y)}),n)},S=window.innerWidth<640,C=i.find("#log_start"),T=i.find("#log_end");return i.find(".clear_logs").on("click",(function(){return Jt(x),!1})),g?C.add(T).on("blur",(function(){i.hasClass("ui-page-active")&&x()})):C.add(T).change((function(){clearTimeout(e),e=setTimeout(x,1e3)})),o.find("input[name='table-group']").change((function(){m()})),i.find("input:radio[name='log_type']").change(f),i.on({pagehide:function(){i.detach()},pageshow:x}),i.find("#log_timeline").prop("checked",!S),i.find("#log_table").prop("checked",S),function(){var e=Ie(219)?[3===P.options.sn1t?ln("Soil Sensor"):ln("Rain Sensor"),3===P.options.sn2t?ln("Soil Sensor"):ln("Rain Sensor"),ln("Rain Delay")]:[ln("Rain Sensor"),ln("Rain Delay")];if(t=$.merge($.merge([],P.stations.snames),e),i.find(".clear_logs").toggleClass("hidden",!le()&&!Ie(210)),""===C.val()||""===T.val()){var n=new Date(1e3*P.settings.devt);C.val(new Date(n.getTime()-6048e5).toISOString().slice(0,10)),T.val(n.toISOString().slice(0,10))}qe({title:ln("Logs"),leftBtn:{icon:"carat-l",text:ln("Back"),class:"ui-toolbar-back-btn",on:He},rightBtn:{icon:"refresh",text:ln("Refresh"),on:x}}),$("#logs").remove(),$.mobile.pageContainer.append(i)}}();function Jt(t){Pe(ln("Are you sure you want to clear ALL your log data?"),"",(function(){var e=le()?"/cl?pw=":"/dl?pw=&day=all";$.mobile.loading("show"),B(e).done((function(){"function"==typeof t&&t(),Ge(ln("Logs have been cleared"))}))}))}function Vt(t){Pe(ln("Are you sure you want to delete all settings and return to the default settings?"),"",(function(){var e;le()?e="otz=32&ontp=1&onbrd=0&osdt=0&omas=0&omton=0&omtoff=0&orst=1&owl=100&orlp=0&ouwt=0&olg=1&oloc=Boston,MA":$n(e="o1=32&o2=1&o3=1&o12=80&o13=0&o15=0&o17=0&o18=0&o19=0&o20=0&o22=1&o23=100&o26=0&o27=110&o28=100&o29=15&o30=0&o31=0&o32=50&o33=97&o34=210&o35=169&o36=1&o37=0&o38=0&o39=0&loc=Boston,MA&wto=%22key%22%3A%22%22"),B("/co?pw=&"+e).done((function(){"function"==typeof t&&t(),H(ht)}))}))}var Gt=function(){var t,e=$("<div data-role='page' id='programs'><div class='ui-content' role='main' id='programs_list'></div></div>");function n(){var t=$(function(){if(0===P.programs.pd.length)return"<p class='center'>"+ln("You have no programs currently added. Tap the Add button on the top right corner to get started.")+"</p>";for(var t,e="<p class='center'>"+ln("Click any program below to expand/edit. Be sure to save changes.")+"</p><div data-role='collapsible-set'>",n=0;n<P.programs.pd.length;n++)t=ln("Program")+" "+(n+1),Ie(210)&&(t=P.programs.pd[n][5]),e+="<fieldset id='program-"+n+"' data-role='collapsible'><h3><a "+(n>0?"":"style='visibility:hidden' ")+"class='hidden ui-btn ui-btn-icon-notext ui-icon-arrow-u ui-btn-corner-all move-up'></a><a class='ui-btn ui-btn-corner-all program-copy'>"+ln("copy")+"</a><span class='program-name'>"+t+"</span></h3>",e+="</fieldset>";return e+"</div>"}());t.find("[id^=program-]").on({collapsiblecollapse:function(){$(this).find(".ui-collapsible-content").empty()},collapsiblebeforecollapse:function(t){var e=$(this),n=e.find(".hasChanges");n.length&&(Pe(ln("Do you want to save your changes?"),"",(function(){n.removeClass("hasChanges").click(),e.collapsible("collapse")}),(function(){n.removeClass("hasChanges"),e.collapsible("collapse")})),t.preventDefault())},collapsibleexpand:function(){!function(t){var e=parseInt(t.attr("id").split("-")[1]);t.find(".ui-collapsible-content").html(ee(e)).enhanceWithin().on("change input click",(function(e){"click"===e.type&&"BUTTON"!==e.target.tagName||($(this).off("change input click"),t.find("[id^='submit-']").addClass("hasChanges"))})),t.find("[id^='submit-']").on("click",(function(){return ne(e),!1})),t.find("[id^='delete-']").on("click",(function(){return function(t){var e=Qt(parseInt(t)+1);Pe(ln("Are you sure you want to delete program")+" "+e+"?","",(function(){$.mobile.loading("show"),B("/dp?pw=&pid="+t).done((function(){$.mobile.loading("hide"),J((function(){$("#programs").trigger("programrefresh"),Ge(ln("Program")+" "+e+" "+ln("deleted"))}))}))}))}(e),!1})),t.find("[id^='run-']").on("click",(function(){return Pe(ln("Are you sure you want to start "+(Ie(210)?P.programs.pd[e][5]:"Program "+e)+" now?"),"",(function(){var t=[],n=function(){t.push(0),Bt(t)};if(Ie(210)){if(t=P.programs.pd[e][4],P.programs.pd[e][0]>>1&1)return Pe(ln("Do you wish to apply the current watering level?"),"",(function(){for(var e=t.length-1;e>=0;e--)t[e]=parseInt(t[e]*(P.options.wl/100));n()}),n),!1}else{var i=parseInt($("#duration-"+e).val()),a=$("[id^='station_'][id$='-"+e+"']");$.each(a,(function(){$(this).is(":checked")?t.push(i):t.push(0)}))}n()})),!1}))}($(this))}}),Ie(210)&&t.find(".move-up").removeClass("hidden").on("click",(function(){var t=$(this).parents("fieldset"),n=parseInt(t.attr("id").split("-")[1]);return $.mobile.loading("show"),B("/up?pw=&pid="+n).done((function(){J((function(){$.mobile.loading("hide"),e.trigger("programrefresh")}))})),!1})),t.find(".program-copy").on("click",(function(){return Ee("#addprogram",{copyID:parseInt($(this).parents("fieldset").attr("id").split("-")[1])}),!1})),e.find("#programs_list").html(t.enhanceWithin())}return e.on("programrefresh",n).on("pagehide",(function(){e.detach()})).on("pagebeforeshow",(function(){te(),"number"!=typeof t&&1===P.programs.pd.length&&(t=0),"number"==typeof t&&(e.find("fieldset[data-collapsed='false']").collapsible("collapse"),$("#program-"+t).collapsible("expand"))})),function(i){t=i,qe({title:ln("Programs"),leftBtn:{icon:"carat-l",text:ln("Back"),class:"ui-toolbar-back-btn",on:Je},rightBtn:{icon:"plus",text:ln("Add"),on:function(){Ve((function(){Ee("#addprogram")}))}}}),n(),$("#programs").remove(),$.mobile.pageContainer.append(e)}}();function Yt(t){return Ie(210)?function(t){var e=t[1],n=t[2],i=t[0]>>2&3,a=t[0]>>4&3,o=t[0]>>6&1,s="",r={repeat:0,interval:0};r.en=t[0]>>0&1,r.weather=t[0]>>1&1,r.is_even=2===i,r.is_odd=1===i,r.is_interval=3===a,r.stations=t[4],r.name=t[5],0===o?(r.start=t[3][0],r.repeat=t[3][1],r.interval=t[3][2]):1===o&&(r.start=t[3]);if(3===a)s=[n,e];else if(0===a)for(var l=0;l<7;l++)s+=e&1<<l?"1":"0";return r.days=s,r}(t):Kt(t)}function Kt(t){var e=t[1],n=t[2],i=!1,a=!1,o=!1,s="",r="",l={};l.en=t[0];for(var d=0;d<P.programs.nboards;d++)for(var c=t[7+d],u=0;u<8;u++)r+=c&1<<u?"1":"0";if(l.stations=r,l.duration=t[6],l.start=t[3],l.end=t[4],l.interval=t[5],128&e&&n>1)s=[n,127&e],o=!0;else{for(var p=0;p<7;p++)s+=e&1<<p?"1":"0";128&e&&0===n&&(i=!0),128&e&&1===n&&(a=!0)}return l.days=s,l.is_even=i,l.is_odd=a,l.is_interval=o,l}function Zt(t,e){var n=2047&t,i=0,a=vt(e);if(t<0)return t;if(t>>13&1)i=1;else if(1&!(t>>14))return t;return t>>12&1&&(n=-n),t=a[i],(t+=n)<0?t=0:t>1440&&(t=1440),t}function Xt(t){var e=2047&t,n=ln("Sunrise");if(t>>13&1)n=ln("Sunset");else if(1&!(t>>14))return yn(t);return t>>12&1&&(e=-e),n+(0!==e?(e>0?"+":"")+nn(en(60*e)):"")}function Qt(t){var e=ln("Program")+" "+t;return 255===t||99===t?e=ln("Manual program"):254===t||98===t?e=ln("Run-once program"):Ie(210)&&t<=P.programs.pd.length&&(e=P.programs.pd[t-1][5]),e}function te(){$("#programs_list").find("[id^=program-]").each((function(t,e){var n=$(e).find(".ui-collapsible-heading-toggle");(Ie(210)?1&P.programs.pd[t][0]:P.programs.pd[t][0])?n.removeClass("red"):n.addClass("red")}))}function ee(t,e){return Ie(210)?function(t,e){var n,i,a,o,s,r,l,d,c=[ln("Monday"),ln("Tuesday"),ln("Wednesday"),ln("Thursday"),ln("Friday"),ln("Saturday"),ln("Sunday")],u="",p=e?"new":t;o="new"===t?{name:"",en:0,weather:0,is_interval:0,is_even:0,is_odd:0,interval:0,start:0,days:[0,0],repeat:0,stations:[]}:Yt(P.programs.pd[t]);if("string"==typeof o.days)for(n=o.days.split(""),i=n.length;i--;)n[i]=0|n[i];else n=[0,0,0,0,0,0,0];r="object"==typeof o.start?o.start:[o.start,-1,-1,-1];for(u+="<div style='margin-top:5px' class='ui-corner-all'>",u+="<div class='ui-bar ui-bar-a'><h3>"+ln("Basic Settings")+"</h3></div>",u+="<div class='ui-body ui-body-a center'>",u+="<label for='name-"+p+"'>"+ln("Program Name")+"</label><input data-mini='true' type='text' name='name-"+p+"' id='name-"+p+"' maxlength='"+P.programs.pnsize+"' placeholder='"+ln("Program")+" "+(P.programs.pd.length+1)+"' value='"+o.name+"'>",u+="<label for='en-"+p+"'><input data-mini='true' type='checkbox' "+(o.en||"new"===t?"checked='checked'":"")+" name='en-"+p+"' id='en-"+p+"'>"+ln("Enabled")+"</label>",u+="<label for='uwt-"+p+"'><input data-mini='true' type='checkbox' "+(o.weather?"checked='checked'":"")+" name='uwt-"+p+"' id='uwt-"+p+"'>"+ln("Use Weather Adjustment")+"</label>",u+="<label class='center' for='start_1-"+p+"'>"+ln("Start Time")+"</label><button class='timefield' data-mini='true' id='start_1-"+p+"' value='"+r[0]+"'>"+Xt(r[0])+"</button>",u+="</div></div></div></div>",u+="<div style='margin-top:10px' class='ui-corner-all'>",u+="<div class='ui-bar ui-bar-a'><h3>"+ln("Program Type")+"</h3></div>",u+="<div class='ui-body ui-body-a'>",u+="<fieldset data-role='controlgroup' data-type='horizontal' class='center'>",u+="<input data-mini='true' type='radio' name='rad_days-"+p+"' id='days_week-"+p+"' value='days_week-"+p+"' "+(o.is_interval?"":"checked='checked'")+"><label for='days_week-"+p+"'>"+ln("Weekly")+"</label>",u+="<input data-mini='true' type='radio' name='rad_days-"+p+"' id='days_n-"+p+"' value='days_n-"+p+"' "+(o.is_interval?"checked='checked'":"")+"><label for='days_n-"+p+"'>"+ln("Interval")+"</label>",u+="</fieldset>",u+="<div id='input_days_week-"+p+"' "+(o.is_interval?"style='display:none'":"")+">",u+="<div class='center'><p class='tight'>"+ln("Days of the Week")+"</p><select "+($.mobile.window.width()>560?"data-inline='true' ":"")+"data-iconpos='left' data-mini='true' multiple='multiple' data-native-menu='false' id='d-"+p+"'><option>"+ln("Choose day(s)")+"</option>",a=0;a<c.length;a++)u+="<option "+(!o.is_interval&&n[a]?"selected='selected'":"")+" value='"+a+"'>"+c[a]+"</option>";u+="</select></div></div>",u+="<div "+(o.is_interval?"":"style='display:none'")+" id='input_days_n-"+p+"' class='ui-grid-a'>",u+="<div class='ui-block-a'><label class='center' for='every-"+p+"'>"+ln("Interval (Days)")+"</label><input data-wrapper-class='pad_buttons' data-mini='true' type='number' name='every-"+p+"' pattern='[0-9]*' id='every-"+p+"' value='"+o.days[0]+"'></div>",u+="<div class='ui-block-b'><label class='center' for='starting-"+p+"'>"+ln("Starting In")+"</label><input data-wrapper-class='pad_buttons' data-mini='true' type='number' name='starting-"+p+"' pattern='[0-9]*' id='starting-"+p+"' value='"+o.days[1]+"'></div>",u+="</div>",u+="<div class='center'><p class='tight'>"+ln("Restrictions")+"</p><select data-inline='true' data-iconpos='left' data-mini='true' id='days_rst-"+p+"'>",u+="<option value='none' "+(o.is_even||o.is_odd?"":"selected='selected'")+">"+ln("None")+"</option>",u+="<option value='odd' "+(!o.is_even&&o.is_odd?"selected='selected'":"")+">"+ln("Odd Days Only")+"</option>",u+="<option value='even' "+(!o.is_odd&&o.is_even?"selected='selected'":"")+">"+ln("Even Days Only")+"</option>",u+="</select></div>",u+="</div></div>",u+="<div style='margin-top:10px' class='ui-corner-all'>",u+="<div class='ui-bar ui-bar-a'><h3>"+ln("Stations")+"</h3></div>",u+="<div class='ui-body ui-body-a'>";var f=$("#programs").hasClass("show-hidden")?"":"' style='display:none";for(a=0;a<P.stations.snames.length;a++)Dt(a)?u+="<div class='ui-field-contain duration-input"+(Mt(a)?" station-hidden"+f:"")+"'><label for='station_"+a+"-"+p+"'>"+P.stations.snames[a]+":</label><button disabled='true' data-mini='true' name='station_"+a+"-"+p+"' id='station_"+a+"-"+p+"' value='0'>"+ln("Master")+"</button></div>":(l=o.stations[a]||0,u+="<div class='ui-field-contain duration-input"+(Mt(a)?" station-hidden"+f:"")+"'><label for='station_"+a+"-"+p+"'>"+P.stations.snames[a]+":</label><button "+(l>0?"class='green' ":"")+"data-mini='true' name='station_"+a+"-"+p+"' id='station_"+a+"-"+p+"' value='"+l+"'>"+Qe(l)+"</button></div>");for(u+="</div></div>",u+="<div style='margin-top:10px' class='ui-corner-all'>",u+="<div class='ui-bar ui-bar-a'><h3>"+ln("Additional Start Times")+"</h3></div>",u+="<div class='ui-body ui-body-a'>",u+="<fieldset data-role='controlgroup' data-type='horizontal' class='center'>",u+="<input data-mini='true' type='radio' name='stype-"+p+"' id='stype_repeat-"+p+"' value='stype_repeat-"+p+"' "+("object"==typeof o.start?"":"checked='checked'")+"><label for='stype_repeat-"+p+"'>"+ln("Repeating")+"</label>",u+="<input data-mini='true' type='radio' name='stype-"+p+"' id='stype_set-"+p+"' value='stype_set-"+p+"' "+("object"==typeof o.start?"checked='checked'":"")+"><label for='stype_set-"+p+"'>"+ln("Fixed")+"</label>",u+="</fieldset>",u+="<div "+("object"==typeof o.start?"style='display:none'":"")+" id='input_stype_repeat-"+p+"'>",u+="<div class='ui-grid-a'>",u+="<div class='ui-block-a'><label class='pad_buttons center' for='interval-"+p+"'>"+ln("Repeat Every")+"</label><button class='pad_buttons' data-mini='true' name='interval-"+p+"' id='interval-"+p+"' value='"+60*o.interval+"'>"+nn(en(60*o.interval))+"</button></div>",u+="<div class='ui-block-b'><label class='pad_buttons center' for='repeat-"+p+"'>"+ln("Repeat Count")+"</label><button class='pad_buttons' data-mini='true' name='repeat-"+p+"' id='repeat-"+p+"' value='"+o.repeat+"'>"+o.repeat+"</button></div>",u+="</div></div>",u+="<table style='width:100%;"+("object"==typeof o.start?"":"display:none")+"' id='input_stype_set-"+p+"'><tr><th class='center'>"+ln("Enable")+"</th><th>"+ln("Start Time")+"</th></tr>",a=1;a<4;a++)d=-1===r[a],u+="<tr><td data-role='controlgroup' data-type='horizontal' class='use_master center'><label for='ust_"+(a+1)+"'><input id='ust_"+(a+1)+"' type='checkbox' "+(d?"":"checked='checked'")+"></label></td>",u+="<td><button class='timefield' data-mini='true' type='time' id='start_"+(a+1)+"-"+p+"' value='"+(d?0:r[a])+"'>"+Xt(d?0:r[a])+"</button></td></tr>";u+="</table>",u+="</div></div>",!0===e||"new"===t?u+="<button data-mini='true' data-icon='check' data-theme='b' id='submit-"+p+"'>"+ln("Save New Program")+"</button>":(u+="<button data-mini='true' data-icon='check' data-theme='b' id='submit-"+p+"'>"+ln("Save Changes to")+" <span class='program-name'>"+o.name+"</span></button>",u+="<button data-mini='true' data-icon='arrow-r' id='run-"+p+"'>"+ln("Run")+" <span class='program-name'>"+o.name+"</span></button>",u+="<button data-mini='true' data-icon='delete' class='bold red' data-theme='b' id='delete-"+p+"'>"+ln("Delete")+" <span class='program-name'>"+o.name+"</span></button>");return(s=$(u)).find("input[name^='rad_days'],input[name^='stype']").on("change",(function(){var t=$(this).val().split("-")[0].split("_");$("[id^='input_"+t[0]+"_']").hide(),$("#input_"+t[0]+"_"+t[1]+"-"+p).show()})),s.find("[id^='interval-']").on("click",(function(){var t=$(this),e=s.find("label[for='"+t.attr("id")+"']").text();Ue({seconds:t.val(),title:e,callback:function(e){t.val(e),t.text(nn(en(e)))},maximum:86340,granularity:1,preventCompression:!0})})),s.find(".timefield").on("click",(function(){var t=$(this);Re({minutes:t.val(),title:ln("Start Time"),showSun:!!Ie(213),callback:function(e){t.val(e),t.text(Xt(e))}})})),s.find("[id^='repeat-']").on("click",(function(){var t=$(this),e=s.find("label[for='"+t.attr("id")+"']").text();Ae({data:t.val(),title:e,label:ln("Repeat Count"),callback:function(e){t.val(e).text(e)},maximum:1440})})),s.find("[id^=station_]").on("click",(function(){var t=$(this),e=P.stations.snames[t.attr("id").split("_")[1].split("-")[0]];Ue({seconds:t.val(),title:e,callback:function(e){t.val(e).addClass("green"),t.text(Qe(e)),0===e&&t.removeClass("green")},maximum:65535,showSun:!!Ie(214)})})),Ye(s),s}(t,e):function(t,e){var n,i,a,o,s,r,l=[ln("Monday"),ln("Tuesday"),ln("Wednesday"),ln("Thursday"),ln("Friday"),ln("Saturday"),ln("Sunday")],d="",c=e?"new":t;s="new"===t?{en:0,weather:0,is_interval:0,is_even:0,is_odd:0,duration:0,interval:0,start:0,end:0,days:[0,0]}:Yt(P.programs.pd[t]);if("string"==typeof s.days)for(n=s.days.split(""),i=n.length;i--;)n[i]=0|n[i];else n=[0,0,0,0,0,0,0];if(void 0!==s.stations)for(o=s.stations.split(""),i=o.length-1;i>=0;i--)o[i]=0|o[i];for(d+="<label for='en-"+c+"'><input data-mini='true' type='checkbox' "+(s.en||"new"===t?"checked='checked'":"")+" name='en-"+c+"' id='en-"+c+"'>"+ln("Enabled")+"</label>",d+="<fieldset data-role='controlgroup' data-type='horizontal' class='center'>",d+="<input data-mini='true' type='radio' name='rad_days-"+c+"' id='days_week-"+c+"' value='days_week-"+c+"' "+(s.is_interval?"":"checked='checked'")+"><label for='days_week-"+c+"'>"+ln("Weekly")+"</label>",d+="<input data-mini='true' type='radio' name='rad_days-"+c+"' id='days_n-"+c+"' value='days_n-"+c+"' "+(s.is_interval?"checked='checked'":"")+"><label for='days_n-"+c+"'>"+ln("Interval")+"</label>",d+="</fieldset><div id='input_days_week-"+c+"' "+(s.is_interval?"style='display:none'":"")+">",d+="<div class='center'><p class='tight'>"+ln("Restrictions")+"</p><select data-inline='true' data-iconpos='left' data-mini='true' id='days_rst-"+c+"'>",d+="<option value='none' "+(s.is_even||s.is_odd?"":"selected='selected'")+">"+ln("None")+"</option>",d+="<option value='odd' "+(!s.is_even&&s.is_odd?"selected='selected'":"")+">"+ln("Odd Days Only")+"</option>",d+="<option value='even' "+(!s.is_odd&&s.is_even?"selected='selected'":"")+">"+ln("Even Days Only")+"</option>",d+="</select></div>",d+="<div class='center'><p class='tight'>"+ln("Days of the Week")+"</p><select "+($.mobile.window.width()>560?"data-inline='true' ":"")+"data-iconpos='left' data-mini='true' multiple='multiple' data-native-menu='false' id='d-"+c+"'><option>"+ln("Choose day(s)")+"</option>",a=0;a<l.length;a++)d+="<option "+(!s.is_interval&&n[a]?"selected='selected'":"")+" value='"+a+"'>"+l[a]+"</option>";for(d+="</select></div></div>",d+="<div "+(s.is_interval?"":"style='display:none'")+" id='input_days_n-"+c+"' class='ui-grid-a'>",d+="<div class='ui-block-a'><label class='center' for='every-"+c+"'>"+ln("Interval (Days)")+"</label><input data-wrapper-class='pad_buttons' data-mini='true' type='number' name='every-"+c+"' pattern='[0-9]*' id='every-"+c+"' value='"+s.days[0]+"'></div>",d+="<div class='ui-block-b'><label class='center' for='starting-"+c+"'>"+ln("Starting In")+"</label><input data-wrapper-class='pad_buttons' data-mini='true' type='number' name='starting-"+c+"' pattern='[0-9]*' id='starting-"+c+"' value='"+s.days[1]+"'></div>",d+="</div>",d+="<fieldset data-role='controlgroup'><legend>"+ln("Stations:")+"</legend>",a=0;a<P.stations.snames.length;a++)d+="<label for='station_"+a+"-"+c+"'><input "+(Mt(a)?"data-wrapper-class='station-hidden hidden' ":"")+"data-mini='true' type='checkbox' "+(void 0!==o&&o[a]?"checked='checked'":"")+" name='station_"+a+"-"+c+"' id='station_"+a+"-"+c+"'>"+P.stations.snames[a]+"</label>";d+="</fieldset>",d+="<fieldset data-role='controlgroup' data-type='horizontal' class='center'>",d+="<button class='ui-btn ui-mini' name='s_checkall-"+c+"' id='s_checkall-"+c+"'>"+ln("Check All")+"</button>",d+="<button class='ui-btn ui-mini' name='s_uncheckall-"+c+"' id='s_uncheckall-"+c+"'>"+ln("Uncheck All")+"</button>",d+="</fieldset>",d+="<div class='ui-grid-a'>",d+="<div class='ui-block-a'><label class='center' for='start-"+c+"'>"+ln("Start Time")+"</label><button class='timefield pad_buttons' data-mini='true' id='start-"+c+"' value='"+s.start+"'>"+yn(s.start)+"</button></div>",d+="<div class='ui-block-b'><label class='center' for='end-"+c+"'>"+ln("End Time")+"</label><button class='timefield pad_buttons' data-mini='true' id='end-"+c+"' value='"+s.end+"'>"+yn(s.end)+"</button></div>",d+="</div>",d+="<div class='ui-grid-a'>",d+="<div class='ui-block-a'><label class='pad_buttons center' for='duration-"+c+"'>"+ln("Station Duration")+"</label><button class='pad_buttons' data-mini='true' name='duration-"+c+"' id='duration-"+c+"' value='"+s.duration+"'>"+nn(en(s.duration))+"</button></div>",d+="<div class='ui-block-b'><label class='pad_buttons center' for='interval-"+c+"'>"+ln("Program Interval")+"</label><button class='pad_buttons' data-mini='true' name='interval-"+c+"' id='interval-"+c+"' value='"+60*s.interval+"'>"+nn(en(60*s.interval))+"</button></div>",d+="</div>",!0===e||"new"===t?d+="<input data-mini='true' data-icon='check' type='submit' data-theme='b' name='submit-"+c+"' id='submit-"+c+"' value='"+ln("Save New Program")+"'>":(d+="<button data-mini='true' data-icon='check' data-theme='b' name='submit-"+c+"' id='submit-"+c+"'>"+ln("Save Changes to Program")+" "+(t+1)+"</button>",d+="<button data-mini='true' data-icon='arrow-r' name='run-"+c+"' id='run-"+c+"'>"+ln("Run Program")+" "+(t+1)+"</button>",d+="<button data-mini='true' data-icon='delete' class='red bold' data-theme='b' name='delete-"+c+"' id='delete-"+c+"'>"+ln("Delete Program")+" "+(t+1)+"</button>");return(r=$(d)).find("input[name^='rad_days']").on("change",(function(){var t,e=$(this).val().split("-")[0];t="n"===(e=e.split("_")[1])?"week":"n",$("#input_days_"+e+"-"+c).show(),$("#input_days_"+t+"-"+c).hide()})),r.find("[id^='duration-'],[id^='interval-']").on("click",(function(){var t=$(this),e=t.attr("id").match("interval")?1:0,n=r.find("label[for='"+t.attr("id")+"']").text();Ue({seconds:t.val(),title:n,callback:function(e){t.val(e),t.text(nn(en(e)))},maximum:e?86340:65535,granularity:e})})),r.find(".timefield").on("click",(function(){var t=$(this),e=r.find("label[for='"+t.attr("id")+"']").text();Re({minutes:t.val(),title:e,callback:function(e){t.val(e),t.text(yn(e))}})})),r.find("[id^='s_checkall-']").on("click",(function(){return r.find("[id^='station_'][id$='-"+c+"']").prop("checked",!0).checkboxradio("refresh"),!1})),r.find("[id^='s_uncheckall-']").on("click",(function(){return r.find("[id^='station_'][id$='-"+c+"']").prop("checked",!1).checkboxradio("refresh"),!1})),Ye(r),r}(t,e)}function ne(t){$("#program-"+t).find(".hasChanges").removeClass("hasChanges"),Ie(210)?function t(e,n){var i,a,o,s,r=[],l=[0,0],d=[0,0,0,0],c=0,u=$("#en-"+e).is(":checked")?1:0,p=$("#uwt-"+e).is(":checked")?1:0,f=0;f|=u<<0,f|=p<<1,"odd"===$("#days_rst-"+e).val()?f|=4:"even"===$("#days_rst-"+e).val()&&(f|=8);if($("#days_n-"+e).is(":checked")){if(f|=48,l[1]=parseInt($("#every-"+e).val(),10),!(l[1]>=2&&l[1]<=128))return void Ge(ln("Error: Interval days must be between 2 and 128."));if(l[0]=parseInt($("#starting-"+e).val(),10),!(l[0]>=0&&l[0]<l[1]))return void Ge(ln("Error: Starting in days wrong."))}else if($("#days_week-"+e).is(":checked")){for(f|=0,i=null===(i=$("#d-"+e).val())?[]:Xe(i),a=0;a<7;a++)-1!==$.inArray(a,i)&&(l[0]|=1<<a);if(0===l[0])return void Ge(ln("Error: You have not selected any days of the week."))}if($("#stype_repeat-"+e).is(":checked"))f|=0,d[0]=parseInt($("#start_1-"+e).val()),d[1]=parseInt($("#repeat-"+e).val()),d[2]=parseInt($("#interval-"+e).val()/60);else if($("#stype_set-"+e).is(":checked")){f|=64,$("[id^='start_'][id$='-"+e+"']").each((function(t,e){var n=parseInt(e.value);("number"!=typeof n||t>0&&!$("#ust_"+(t+1)).is(":checked"))&&(n=-1),d[t]=n}))}var h=$("[id^=station_][id$=-"+e+"]"),m=[];if(h.each((function(){var t=parseInt(this.value);parseInt(t)>0&&(c=1),m.push(t)})),r[0]=f,r[1]=l[0],r[2]=l[1],r[3]=d,r[4]=m,o=$("#name-"+e).val(),s="&v="+JSON.stringify(r)+"&name="+encodeURIComponent(o),0===c)return void Ge(ln("Error: You have not selected any stations."));if(!n&&$("#stype_repeat-"+e).is(":checked")&&d[1]>0&&Nt(m)>60*d[2])return void Pe(ln("Warning: The repeat interval is less than the program run time."),ln("Do you want to continue?"),(function(){t(e,!0)}));if(!n&&3==(f>>4&3)&&!(1&l[1])&&(f>>2&3)>0)return void Pe(ln("Warning: The use of odd/even restrictions with the selected interval day may result in the program not running at all."),ln("Do you want to continue?"),(function(){t(e,!0)}));$.mobile.loading("show"),"new"===e?B("/cp?pw=&pid=-1"+s).done((function(){$.mobile.loading("hide"),J((function(){$.mobile.document.one("pageshow",(function(){Ge(ln("Program added successfully"))})),He()}))})):B("/cp?pw=&pid="+e+s).done((function(){$.mobile.loading("hide"),J((function(){te(),$("#program-"+e).find(".program-name").text(o)})),Ge(ln("Program has been updated"))}))}(t):function(t){var e,n,i,a=[],o=[0,0],s=0,r=$("#en-"+t).is(":checked")?1:0;if(a[0]=r,$("#days_week-"+t).is(":checked")){for(e=null===(e=$("#d-"+t).val())?[]:Xe(e),n=0;n<7;n++)-1!==$.inArray(n,e)&&(o[0]|=1<<n);if(0===o[0])return void Ge(ln("Error: You have not selected any days of the week."));"odd"===$("#days_rst-"+t).val()?(o[0]|=128,o[1]=1):"even"===$("#days_rst-"+t).val()&&(o[0]|=128,o[1]=0)}else if($("#days_n-"+t).is(":checked")){if(o[1]=parseInt($("#every-"+t).val(),10),!(o[1]>=2&&o[1]<=128))return void Ge(ln("Error: Interval days must be between 2 and 128."));if(o[0]=parseInt($("#starting-"+t).val(),10),!(o[0]>=0&&o[0]<o[1]))return void Ge(ln("Error: Starting in days wrong."));o[0]|=128}if(a[1]=o[0],a[2]=o[1],a[3]=parseInt($("#start-"+t).val()),a[4]=parseInt($("#end-"+t).val()),a[3]>a[4])return void Ge(ln("Error: Start time must be prior to end time."));a[5]=parseInt($("#interval-"+t).val()/60);var l=$("[id^=station_][id$=-"+t+"]").length/8;a[6]=parseInt($("#duration-"+t).val());var d,c=[0];for(d=0;d<l;d++)for(c[d]=0,i=0;i<8;i++)$("#station_"+(8*d+i)+"-"+t).is(":checked")&&(c[d]|=1<<i,s=1);if(a=JSON.stringify(a.concat(c)),0===s)return void Ge(ln("Error: You have not selected any stations."));$.mobile.loading("show"),"new"===t?B("/cp?pw=&pid=-1&v="+a).done((function(){$.mobile.loading("hide"),J((function(){$.mobile.document.one("pageshow",(function(){Ge(ln("Program added successfully"))})),He()}))})):B("/cp?pw=&pid="+t+"&v="+a).done((function(){$.mobile.loading("hide"),J((function(){te()})),Ge(ln("Program has been updated"))}))}(t)}function ie(t){return $.mobile.loading("show"),B("/cv?pw=&rd="+t/3600).done((function(){$.mobile.loading("hide"),Be("#footer-running"),At(),Ge(ln("Rain delay has been successfully set"))})),!1}function ae(){var t=$("<div data-role='popup' data-theme='a'><div class='ui-bar ui-bar-a'>"+ln("Select Export Method")+"</div><div data-role='controlgroup' class='tight'><a class='ui-btn hidden fileMethod'>"+ln("File")+"</a><a class='ui-btn pasteMethod'>"+ln("Email")+"</a><a class='ui-btn localMethod'>"+ln("Internal (within app)")+"</a></div></div>"),e=encodeURIComponent(JSON.stringify(P)),n="OpenSprinkler Data Export on "+wn(new Date);_&&t.find(".fileMethod").removeClass("hidden").attr({href:"data:text/json;charset=utf-8,"+e,download:"backup-"+(new Date).toLocaleDateString().replace(/\//g,"-")+".json"}).on("click",(function(){t.popup("close")}));var i="mailto:?subject="+encodeURIComponent(n)+"&body="+e;t.find(".pasteMethod").attr("href",i).on("click",(function(){window.open(i),t.popup("close")})),t.find(".localMethod").on("click",(function(){t.popup("close"),I({backup:JSON.stringify(P)},(function(){Ge(ln("Backup saved on this device"))}))})),Ne(t,{positionTo:$("#sprinklers-settings").find(".export_config")})}function oe(t){var e="";"object"==typeof t&&t.settings?((Ie(210)&&"object"==typeof t.options&&(t.options.hp0!==P.options.hp0||t.options.hp1!==P.options.hp1)||t.options.dhcp!==P.options.dhcp||t.options.devid!==P.options.devid)&&(e=ln("Warning: Network changes will be made and the device may no longer be accessible from this address.")),Pe(ln("Are you sure you want to restore the configuration?"),e,(function(){$.mobile.loading("show");var e,n,i,a,o="/cs?pw=",s="/co?pw=",r=le(),l=function(t){return E[t]===n};for(e in t.options)if(t.options.hasOwnProperty(e)&&E.hasOwnProperty(e)){if(n=E[e],-1!==$.inArray(n,[2,14,16,21,22,25,36])&&0===t.options[e])continue;if(3===n){Ie(210)&&1===P.options.dhcp&&(s+="&o3=1");continue}if(r&&void 0===(n=Object.keys(E).find(l)))continue;i=!0===Ie(208)&&"string"==typeof t.options[e]?t.options[e].replace(/\s/g,"_"):t.options[e],s+="&o"+n+"="+i}for(!r&&"number"==typeof t.options.fwv&&t.options.fwv<211&&Ie(211)&&(s+="&o36=1"),"object"==typeof t.settings.wto&&Ie(215)&&(s+="&wto="+mn(t.settings.wto)),"string"==typeof t.settings.ifkey&&Ie(217)&&(s+="&ifkey="+t.settings.ifkey),s+="&"+(r?"o":"")+"loc="+t.settings.loc,e=0;e<t.stations.snames.length;e++)a=!0===Ie(208)?t.stations.snames[e].replace(/\s/g,"_"):t.stations.snames[e],o+="&s"+e+"="+encodeURIComponent(a);for(e=0;e<t.stations.masop.length;e++)o+="&m"+e+"="+t.stations.masop[e];if("object"==typeof t.stations.masop2)for(e=0;e<t.stations.masop2.length;e++)o+="&n"+e+"="+t.stations.masop2[e];if("object"==typeof t.stations.ignore_rain)for(e=0;e<t.stations.ignore_rain.length;e++)o+="&i"+e+"="+t.stations.ignore_rain[e];if("object"==typeof t.stations.ignore_sn1)for(e=0;e<t.stations.ignore_sn1.length;e++)o+="&j"+e+"="+t.stations.ignore_sn1[e];if("object"==typeof t.stations.ignore_sn2)for(e=0;e<t.stations.ignore_sn2.length;e++)o+="&k"+e+"="+t.stations.ignore_sn2[e];if("object"==typeof t.stations.stn_dis)for(e=0;e<t.stations.stn_dis.length;e++)o+="&d"+e+"="+t.stations.stn_dis[e];if("object"==typeof t.stations.stn_spe)for(e=0;e<t.stations.stn_spe.length;e++)o+="&p"+e+"="+t.stations.stn_spe[e];if("object"==typeof t.stations.stn_seq)for(e=0;e<t.stations.stn_seq.length;e++)o+="&q"+e+"="+t.stations.stn_seq[e];else if(!r&&"number"==typeof t.options.fwv&&t.options.fwv<211&&!Ie(211)){var d;for(d=0;d<t.settings.nbrd;d++)o+="&q"+d+"="+(1===t.options.seq?255:0)}if("object"==typeof t.stations.act_relay)for(e=0;e<t.stations.act_relay.length;e++)o+="&a"+e+"="+t.stations.act_relay[e];t.special=t.special||{},$.when(B($n(s)),B(o),B("/dp?pw=&pid=-1"),$.each(t.programs.pd,(function(e,n){var i="";if(r&&"number"==typeof t.options.fwv&&t.options.fwv>=210)return Ge(ln("Program data is newer than the device firmware and cannot be imported")),!1;if(!r&&"number"==typeof t.options.fwv&&t.options.fwv>=210&&!Ie(210))return Ge(ln("Program data is newer than the device firmware and cannot be imported")),!1;if(!r&&"number"==typeof t.options.fwv&&t.options.fwv>=210&&Ie(210)&&(i="&name="+n[5],n=n.slice(0,5)),!r&&"number"==typeof t.options.fwv&&t.options.fwv<210&&Ie(210)){var a,o,s,l=Kt(n),d=n.length-7,c=[],u=0;for(u|=l.en<<0,l.is_even?u|=8:l.is_odd?u|=4:u|=0,l.is_interval?u|=48:u|=0,u|=0,n[0]=u,o=0;o<d;o++)for(a=n[7+o],s=0;s<8;s++)c.push(a&1<<s?l.duration:0);n[3]=[l.start,parseInt((l.end-l.start)/l.interval),l.interval,0],n[4]=c,n=n.slice(0,5),i="&name="+ln("Program")+" "+(e+1)}B("/cp?pw=&pid=-1&v="+JSON.stringify(n)+i)})),$.each(t.special,(function(t,e){Ie(216)&&B("/cs?pw=&sid="+t+"&st="+e.st+"&sd="+encodeURIComponent(e.sd))}))).then((function(){setTimeout((function(){H((function(){$.mobile.loading("hide"),Ge(ln("Backup restored to your device")),ht(),ze(!0)}),(function(){$.mobile.loading("hide"),F()}))}),1500)}),(function(){$.mobile.loading("hide"),Ge(ln("Unable to import configuration."))}))}))):Ge(ln("Invalid configuration"))}var se=function(){var t,e=$("<div data-role='page' id='about'><div class='ui-content' role='main'><ul data-role='listview' data-inset='true'><li><p>"+ln("User manual for OpenSprinkler is available at")+" <a class='iab' target='_blank' href='https://openthings.freshdesk.com/support/solutions/folders/5000147083'>https://support.openthings.io</a></p></li></ul><ul data-role='listview' data-inset='true'><li><p>"+ln("This is open source software: source code and changelog for this application can be found at")+" <a class='iab squeeze' target='_blank' href='https://github.com/OpenSprinkler/OpenSprinkler-App/'>https://github.com/OpenSprinkler/OpenSprinkler-App/</a></p><p>"+ln("Open source attributions")+": <a class='iab iabNoScale squeeze' target='_blank' href='https://github.com/OpenSprinkler/OpenSprinkler-App/wiki/List-of-Integrated-Libraries'>https://github.com/OpenSprinkler/OpenSprinkler-App/wiki/List-of-Integrated-Libraries</a></p></li></ul><p class='smaller'>"+ln("App Version")+": 2.1.7<br>"+ln("Firmware")+": <span class='firmware'></span><br><span class='hardwareLabel'>"+ln("Hardware Version")+":</span> <span class='hardware'></span></p></div></div>");return function(){t=void 0===P.options.hwv,e.find(".hardware").toggleClass("hidden",t).text(Me()+function(){if(le()||"number"!=typeof P.options.hwt||0===P.options.hwt)return"";return 172===P.options.hwt?" - AC":220===P.options.hwt?" - DC":26===P.options.hwt?" - Latching":""}()),e.find(".hardwareLabel").toggleClass("hidden",t),e.find(".firmware").text(Oe()+De()),e.one("pagehide",(function(){e.detach()})),qe({title:ln("About"),leftBtn:{icon:"carat-l",text:ln("Back"),class:"ui-toolbar-back-btn",on:He}}),$("#about").remove(),$.mobile.pageContainer.append(e)}}();function re(t){return parseFloat((t*((P.options.fpr1<<8)+P.options.fpr0)/100).toFixed(2))}function le(){return!(!P||"object"!=typeof P.options||"string"!=typeof P.options.fwv||-1===P.options.fwv.search(/ospi/i))}function de(t){t=$.extend({},{fixIncorrect:!1,name:"",callback:function(){},cancel:function(){}},t);var e=le(),n=!1,o=$("<div data-role='popup' class='modal' id='changePassword' data-theme='a' data-overlay-theme='b'><ul data-role='listview' data-inset='true'>"+(!0===t.fixIncorrect?"":"<li data-role='list-divider'>"+ln("Change Password")+"</li>")+"<li>"+(!0===t.fixIncorrect?"<p class='rain-desc red-text bold'>"+ln("Incorrect password for ")+t.name+". "+ln("Please re-enter password to try again.")+"</p>":"")+"<form method='post' novalidate><label for='npw'>"+(!0===t.fixIncorrect?ln("Password:"):ln("New Password")+":")+"</label><input type='password' name='npw' id='npw' value=''"+(e?"":" maxlength='32'")+">"+(!0===t.fixIncorrect?"":"<label for='cpw'>"+ln("Confirm New Password")+":</label><input type='password' name='cpw' id='cpw' value=''"+(e?"":" maxlength='32'")+">")+(!0===t.fixIncorrect?"<label for='save_pw'>"+ln("Save Password")+"</label><input type='checkbox' data-wrapper-class='save_pw' name='save_pw' id='save_pw' data-mini='true'>":"")+"<input type='submit' value='"+ln("Submit")+"'></form></li></ul></div>");o.find("form").on("submit",(function(){var r=o.find("#npw").val(),l=o.find("#cpw").val();return!0===t.fixIncorrect?(n=!0,T(["sites"],(function(e){var n,l,d=Q(e.sites),c=function(e){s=e,d[t.name].os_pw=o.find("#save_pw").is(":checked")?e:"",I({sites:JSON.stringify(d)},ue),o.popup("close"),t.callback()};n=md5(r),l=function(t){c(!0===t?md5(r):r)},$.ajax({url:a+i+"/sp?pw="+encodeURIComponent(n)+"&npw="+encodeURIComponent(n)+"&cpw="+encodeURIComponent(n),cache:!1,crossDomain:!0,type:"GET"}).then((function(t){var e=t.result;l(!(void 0===e||e>1))}),(function(){l(!1)}))})),!1):r!==l?(Ge(ln("The passwords don't match. Please try again.")),!1):""===r?(Ge(ln("Password cannot be empty")),!1):(!e&&r.length>32&&Ge(ln("Password cannot be longer than 32 characters")),Ie(213)&&(r=md5(r),l=md5(l)),$.mobile.loading("show"),B("/sp?pw=&npw="+encodeURIComponent(r)+"&cpw="+encodeURIComponent(l),"json").done((function(t){var e=t.result;!e||e>1?Ge(ln(2===e?"Please check the current device password is correct then try again":"Unable to change password. Please try again.")):(T(["sites","current_site"],(function(t){var e=Q(t.sites);e[t.current_site].os_pw=r,s=r,I({sites:JSON.stringify(e)},ue)})),$.mobile.loading("hide"),o.popup("close"),Ge(ln("Password changed successfully")))})),!1)})),o.one("popupafterclose",(function(){document.activeElement.blur(),o.remove(),t.fixIncorrect&&!n&&t.cancel()})).popup().enhanceWithin(),t.fixIncorrect?T(["sites","current_site"],(function(e){var n=Q(e.sites),r=e.current_site,l=md5(n[r].os_pw);bn(n[r].os_pw)?o.popup("open"):$.ajax({url:a+i+"/jc?pw="+l,type:"GET",dataType:"json"}).then((function(){n[r].os_pw=s=l,I({sites:JSON.stringify(n)},ue),t.callback()}),(function(){o.popup("open")}))})):o.popup("open")}function ce(t){t=t||function(){};var e=$("<div data-role='popup' class='modal' id='requestCloudAuth' data-theme='a'><ul data-role='listview' data-inset='true'><li data-role='list-divider'>"+ln("OpenSprinkler.com Login")+"</li><li><p class='rain-desc tight'>"+ln("Use your OpenSprinkler.com login and password to securely sync sites between all your devices.")+"<br><br>"+ln("Don't have an account?")+" <a href='https://opensprinkler.com/wp-login.php?action=register' class='iab'>"+ln("Register here")+"</a></p></li><li><form method='post' novalidate><label for='cloudUser'>"+ln("Username:")+"</label><input type='text' name='cloudUser' id='cloudUser' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false'><label for='cloudPass'>"+ln("Password:")+"</label><input type='password' name='cloudPass' id='cloudPass'><input type='submit' value='"+ln("Submit")+"'></form></li></ul></div>"),n=!1;e.find("form").on("submit",(function(){return $.mobile.loading("show"),function(t,e,n){n=n||function(){},$.ajax({type:"POST",dataType:"json",url:"https://opensprinkler.com/wp-admin/admin-ajax.php",data:{action:"ajaxLogin",username:t,password:e},success:function(t){"string"==typeof t.token&&I({cloudToken:t.token,cloudDataToken:sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(e))}),n(t.loggedin)},fail:function(){n(!1)}})}(e.find("#cloudUser").val(),e.find("#cloudPass").val(),(function(t){!1!==t?($.mobile.loading("hide"),n=!0,e.popup("close")):Ge(ln("Invalid username/password combination. Please try again."))})),!1})),e.one("popupafterclose",(function(){t(n),n&&pe((function(t){var e=$(".ui-page-active").attr("id");"start"===e?(Object.keys(t).length>0&&I({sites:JSON.stringify(t)}),Ee("#site-control")):(ye(),T("sites",(function(n){if(JSON.stringify(t)!==n.sites)if(n.sites=Q(n.sites),Object.keys(t).length>0){var i=$("<div data-role='popup' data-theme='a' data-overlay-theme='b'><div class='ui-bar ui-bar-a'>"+ln("Select Merge Method")+"</div><div data-role='controlgroup' class='tight'><button class='merge'>"+ln("Merge")+"</button><button class='replaceLocal'>"+ln("Replace local with cloud")+"</button><button class='replaceCloud'>"+ln("Replace cloud with local")+"</button></div></div>"),a=function(){I({sites:JSON.stringify(t)},ue),i.popup("close"),"site-control"===e&&Ee("#site-control")};i.find(".merge").on("click",(function(){t=$.extend({},n.sites,t),a()})),i.find(".replaceLocal").on("click",(function(){a()})),i.find(".replaceCloud").on("click",(function(){t=n.sites,a()})),i.one("popupafterclose",(function(){i.popup("destroy").remove()})).popup({history:!1,positionTo:"window"}).enhanceWithin().popup("open")}else ue()})))}))})),Ne(e)}function ue(t){"function"!=typeof t&&(t=function(){}),T(["cloudToken","cloudDataToken","sites"],(function(e){null!==e.cloudToken&&void 0!==e.cloudToken?$.ajax({type:"POST",dataType:"json",url:"https://opensprinkler.com/wp-admin/admin-ajax.php",data:{action:"saveSites",token:e.cloudToken,sites:encodeURIComponent(JSON.stringify(sjcl.encrypt(e.cloudDataToken,e.sites)))},success:function(e){!1===e.success?("BAD_TOKEN"===e.message&&me(),t(!1,e.message)):(I({cloudToken:e.token}),t(e.success))},fail:function(){t(!1)}}):t(!1)}))}function pe(t){t=t||function(){},T(["cloudToken","cloudDataToken"],(function(e){if(void 0!==e.cloudToken&&null!==e.cloudToken)return void 0===e.cloudDataToken||null===e.cloudDataToken?(ve(),void t(!1)):void $.ajax({type:"POST",dataType:"json",url:"https://opensprinkler.com/wp-admin/admin-ajax.php",data:{action:"getSites",token:e.cloudToken},success:function(n){if(!1===n.success||""===n.sites)"BAD_TOKEN"===n.message&&me(),t(!1,n.message);else{var i;I({cloudToken:n.token});try{i=sjcl.decrypt(e.cloudDataToken,n.sites)}catch(e){"ccm: tag doesn't match"===e.message&&ve(),t(!1)}try{t(JSON.parse(i))}catch(e){t(!1)}}},fail:function(){t(!1)}});t(!1)}))}function fe(t){"function"!=typeof t&&(t=function(){}),T(["cloudToken","current_site"],(function(e){"string"==typeof e.cloudToken&&pe((function(n){!1!==n&&I({sites:JSON.stringify(n)},(function(){it(Object.keys(n),e.current_site),t(),$("html").trigger("siterefresh")}))}))}))}var he=!1;function me(){j(["cloudToken"],ye),we({title:ln("OpenSprinkler.com Login Expired"),desc:ln("Click here to re-login to OpenSprinkler.com"),on:function(){var t=$(this).parent();return ce((function(e){Se(t),!0===e&&(ye(),fe())})),!1}})}function ve(){j(["cloudDataToken"]),we({title:ln("Unable to read cloud data"),desc:ln("Click here to enter a valid password to decrypt the data"),on:function(){var t=$(this).parent(),e=$("<div data-role='popup' data-theme='a' class='modal ui-content' id='dataPassword'><p class='tight rain-desc'>"+ln("Please enter your OpenSprinkler.com password. If you have recently changed your password, you may need to enter your previous password to decrypt the data.")+"</p><form><input type='password' id='dataPasswordInput' name='dataPasswordInput' placeholder='"+ln("Password")+"' /><input type='submit' data-theme='b' value='"+ln("Submit")+"' /></form></div>"),n=!1;return e.find("form").on("submit",(function(){return Se(t),n=!0,I({cloudDataToken:sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(e.find("#dataPasswordInput").val()))},(function(){e.popup("close")})),!1})),e.one("popupafterclose",(function(){!0===n&&fe()})),Ne(e),!1}})}function be(t){return atob(t).split("|")[0]}function ge(t){"function"!=typeof t&&(t=function(){}),Pe(ln("Are you sure you want to logout?"),"",(function(){j(["cloudToken"],(function(){ye(),t()}))}))}function ye(){var t=$(".ui-page-active");T("cloudToken",(function(e){var n=$(".login-button"),i=$(".logout-button");null===e.cloudToken||void 0===e.cloudToken?(n.removeClass("hidden"),i.addClass("hidden"),i.find("a").text(ln("Logout")),"site-control"===t.attr("id")&&t.find(".logged-in-alert").remove()):(i.removeClass("hidden").find("a").text(ln("Logout")+" ("+be(e.cloudToken)+")"),n.addClass("hidden"),"site-control"===t.attr("id")&&0===t.find(".logged-in-alert").length&&t.find(".ui-content").prepend(nt(e.cloudToken)))}))}function we(t){N.push(t),ke();var e=$("#notificationPanel");e.hasClass("ui-panel-open")&&e.find("ul").append($e(t)).listview("refresh")}function ke(){var t=N.length,e=$("#header");0===t?e.find(".notifications").hide():(e.find(".notifications").show(),e.find(".notificationCount").text(t))}function $e(t){var e=$("<li><a class='primary' href='#'><h2>"+t.title+"</h2>"+(t.desc?"<p>"+t.desc+"</p>":"")+"</a><a class='ui-btn ui-btn-icon-notext ui-icon-delete'></a></li>");return e.find(".primary").on("click",t.on),e.find(".ui-icon-delete").on("click",(function(){Se($(this).parent())})),e}function xe(){if(0!==N.length){for(var t=$("#notificationPanel"),e=$("#footer-menu"),n=[$("<li data-role='list-divider'>"+ln("Notifications")+"<button class='ui-btn ui-btn-icon-notext ui-icon-delete btn-no-border clear-all delete'></button></li>").on("click",".clear-all",(function(){var t=$(this);t.hasClass("clear")?_e():(t.removeClass("delete ui-btn-icon-notext ui-icon-delete").addClass("clear").text(ln("Clear")),setTimeout((function(){$.mobile.document.one("click",(function(){t.removeClass("clear").addClass("delete ui-btn-icon-notext ui-icon-delete").text("")}))}),1))}))],i=N.length-1;i>=0;i--)n.push($e(N[i]));t.find("ul").replaceWith($("<ul/>").append(n).listview()),t.on("panelbeforeclose",(function(){e.removeClass("moveLeft")})),t.panel().panel("option","classes.modal","needsclick ui-panel-dismiss"),e.addClass("moveLeft"),t.panel("open")}}function _e(){var t=$("#notificationPanel");N=[],ke(),t.find("ul").empty(),t.hasClass("ui-panel-open")&&t.panel("close")}function Se(t){var e=$("#notificationPanel"),n=N[t.index()-1].off;("function"!=typeof n||n())&&(N.remove(t.index()-1),t.remove(),ke(),0===N.length&&e.hasClass("ui-panel-open")&&e.panel("close"))}function Ce(){if(!an())return!1;Pe(ln("Are you sure you want to stop all stations?"),"",(function(){$.mobile.loading("show"),B("/cv?pw=&rsn=1").done((function(){$.mobile.loading("hide"),function(){for(var t in L)L.hasOwnProperty(t)&&"clock"!==t&&delete L[t]}(),At(),Ge(ln("All stations have been stopped"))}))}))}function Te(t){var e;return!!le()&&((e=P.options.fwv.split("-")[0])===t||je(e=e.split("."),t=t.split(".")))}function Ie(t){var e=P.options.fwv;return t>=1e3&&(e=10*e+P.options.fwm),!le()&&(t===e||je(e.toString().split(""),t.toString().split("")))}function je(t,e){for(var n,i=Math.max(t.length,e.length);t.length<i;)t.push(0);for(;e.length<i;)e.push(0);for(var a=0;a<i&&0===(n=Math.max(-1,Math.min(1,t[a]-e[a])));a++);return-1===n&&(n=!1),n}function Oe(t){return t||"object"!=typeof P.options||(t=P.options.fwv),"string"==typeof t&&-1!==t.search(/ospi/i)?t:(t/100>>0)+"."+(t/10>>0)%10+"."+t%10}function De(){return!le()&&"object"==typeof P.options&&"number"==typeof P.options.fwm&&P.options.fwm>0?" ("+P.options.fwm+")":""}function Me(t){if(!t){if("object"!=typeof P.options||void 0===P.options.hwv)return!1;t=P.options.hwv}return"string"==typeof t?t:64===t?"OSPi":128===t?"OSBo":192===t?"Linux":255===t?"Demo":(t/10>>0)%10+"."+t%10}function Pe(t,e,n,i){$("#sure").popup("destroy").remove(),n=n||function(){},i=i||function(){};var a=$("<div data-role='popup' data-theme='a' id='sure'><h3 class='sure-1 center'>"+t+"</h3><p class='sure-2 center'>"+e+"</p><a class='sure-do ui-btn ui-btn-b ui-corner-all ui-shadow' href='#'>"+ln("Yes")+"</a><a class='sure-dont ui-btn ui-corner-all ui-shadow' href='#'>"+ln("No")+"</a></div>");a.find(".sure-do").one("click.sure",(function(){return a.popup("close"),n(),!1})),a.find(".sure-dont").one("click.sure",(function(){return a.popup("close"),i(),!1})),Ne(a)}function Ue(t){var e={seconds:0,title:ln("Duration"),granularity:0,preventCompression:!1,incrementalUpdate:!0,showBack:!0,showSun:!1,minimum:0,callback:function(){}},n=0;t=$.extend({},e,t),$("#durationBox").popup("destroy").remove(),t.seconds=parseInt(t.seconds),65535===t.seconds?(n=1,t.seconds=0):65534===t.seconds&&(n=2,t.seconds=0),Ie(217)&&(t.preventCompression=!0);var i,a=["days","hours","minutes","seconds"],o=[ln("Days"),ln("Hours"),ln("Minutes"),ln("Seconds")],s=[86400,3600,60,1],r=[0,23,59,59],l=4-t.granularity,d=0,c=en(t.seconds);if(!t.preventCompression&&Ie(210)&&t.maximum>64800&&(t.maximum=Ie(214)?57600:64800),t.maximum)for(i=s.length-1;i>=0;i--)if(t.maximum<s[i]){l=s.length-(d=i+1)-t.granularity;break}var u="<fieldset class='ui-grid-"+String.fromCharCode(95+l)+" incr'>",p="<div class='ui-grid-"+String.fromCharCode(95+l)+" inputs'>",f="<fieldset class='ui-grid-"+String.fromCharCode(95+l)+" decr'>",h=$("<div data-role='popup' id='durationBox' data-theme='a'><div data-role='header' data-theme='b'><h1>"+t.title+"</h1></div><div class='ui-content'>"+(t.helptext?"<p class='rain-desc center smaller'>"+t.helptext+"</p>":"")+"<span></span>"+(t.showSun?"<div class='ui-grid-a useSun'><div class='ui-block-a'><button value='65534' class='ui-mini ui-btn rise "+(2===n?"ui-btn-active":"")+"'>"+ln("Sunrise to Sunset")+"</button></div><div class='ui-block-b'><button value='65535' class='ui-mini ui-btn set "+(1===n?"ui-btn-active":"")+"'>"+ln("Sunset to Sunrise")+"</button></div></div>":"")+(t.showBack?"<button class='submit' data-theme='b'>"+ln("Submit")+"</button>":"")+"</div></div>"),m=function(e,n){var i=h.find(".inputs input").eq(e),a=e+d,o=parseInt(i.val());if(!i.prop("disabled")&&!(-1===n&&(v()<=t.minimum||o<=0)||1===n&&v()+s[a]>t.maximum)&&(0!==r[a]&&0!==e&&Math.abs(o)>=r[a]&&(i.val(0),i=h.find(".inputs input").eq(e-1),o=parseInt(i.val())),i.val(o+n),t.incrementalUpdate&&t.callback(v()),!t.preventCompression&&Ie(210))){var l=1===n;1===n?(v()>=60&&b("seconds",l),v()>=10800&&b("minutes",l)):-1===n&&(v()<=-60?b("seconds",!l):v()<=-10800?b("minutes",!l):v()<60?b("seconds",l):v()<10800&&b("minutes",l))}},v=function(){var t=h.find(".useSun").find("button.ui-btn-active");return 1===t.length?parseInt(t.val()):function(t){return parseInt(86400*t.days+3600*t.hours+60*t.minutes+t.seconds)}({days:parseInt(h.find(".days").val())||0,hours:parseInt(h.find(".hours").val())||0,minutes:parseInt(h.find(".minutes").val())||0,seconds:parseInt(h.find(".seconds").val())||0})},b=function(t,e){h.find("."+t).toggleClass("ui-state-disabled",e).prop("disabled",e).val((function(){return e?0:this.value})).parent(".ui-input-text").toggleClass("ui-state-disabled",e)};for(i=d;i<s.length-t.granularity;i++)u+="<div "+(l>1?"class='ui-block-"+String.fromCharCode(97+i-d)+"'":"")+"><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div>",p+="<div "+(l>1?"class='ui-block-"+String.fromCharCode(97+i-d)+"'":"")+"><label class='center'>"+ln(o[i])+"</label><input data-wrapper-class='pad_buttons' class='"+a[i]+"' type='number' pattern='[0-9]*' value='"+c[a[i]]+"'></div>",f+="<div "+(l>1?"class='ui-block-"+String.fromCharCode(97+i-d)+"'":"")+"><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div>";u+="</fieldset>",p+="</div>",f+="</fieldset>",h.find("span").prepend(u+p+f),h.find("button.submit").on("click",(function(){t.callback(v()),h.popup("destroy").remove()})),!t.preventCompression&&Ie(210)&&(t.seconds<=-60&&b("seconds",!0),t.seconds<=-10800&&b("minutes",!0),t.seconds>=60&&b("seconds",!0),t.seconds>=10800&&b("minutes",!0)),h.on("focus","input[type='number']",(function(){this.value=""})).on("blur","input[type='number']",(function(){""===this.value&&(this.value="0")})),Ke(h.find(".incr").children(),(function(t){var e=$(t.currentTarget).index();return m(e,1),!1})),Ke(h.find(".decr").children(),(function(t){var e=$(t.currentTarget).index();return m(e,-1),!1})),t.showSun&&h.find(".useSun").on("click","button",(function(){var e=$(this),n=h.find(".useSun").find("button").not(e),i=h.find("span").find(".ui-btn,input");n.removeClass("ui-btn-active"),e.hasClass("ui-btn-active")?(e.removeClass("ui-btn-active"),i.prop("disabled",!1).removeClass("ui-disabled")):(e.addClass("ui-btn-active"),i.prop("disabled",!0).addClass("ui-disabled")),t.incrementalUpdate&&t.callback(v())})),h.css("max-width","350px").one("popupafteropen",(function(){0!==n&&h.find("span").find(".ui-btn,input").prop("disabled",!0).addClass("ui-disabled")})).one("popupafterclose",(function(){t.incrementalUpdate&&t.callback(v())})),Ne(h)}function Ae(t){$("#singleDuration").popup("destroy").remove();var e={data:0,title:ln("Duration"),minimum:0,label:"",updateOnChange:!0,showBack:!0,callback:function(){}};t=$.extend({},e,t);var n=$("<div data-role='popup' id='singleDuration' data-theme='a'><div data-role='header' data-theme='b'><h1>"+t.title+"</h1></div><div class='ui-content'>"+(t.helptext?"<p class='rain-desc center smaller'>"+t.helptext+"</p>":"")+"<label class='center'>"+t.label+"</label><div class='input_with_buttons'><button class='decr ui-btn ui-btn-icon-notext ui-icon-carat-l btn-no-border'></button><input type='number' pattern='[0-9]*' value='"+t.data+"'><button class='incr ui-btn ui-btn-icon-notext ui-icon-carat-r btn-no-border'></button></div>"+(t.updateOnChange&&!t.showBack?"":"<input type='submit' data-theme='b' value='"+ln("Submit")+"'>")+"</div></div>"),i=n.find("input"),a=function(e){t.callback(parseInt(e).clamp(t.minimum,t.maximum))},o=function(e){var n=parseInt(i.val());-1===e&&n===t.minimum||1===e&&n===t.maximum||(i.val(n+e),t.updateOnChange&&a(n+e))};Ke(n.find(".incr"),(function(){return o(1),!1})),Ke(n.find(".decr"),(function(){return o(-1),!1})),n.find("input[type='number']").on("focus",(function(){this.value=""})).on("blur",(function(){""===this.value&&(this.value="0")})),n.find("input[type='submit']").on("click",(function(){a(i.val()),n.popup("destroy").remove()})),n.one("popupafterclose",(function(){t.updateOnChange&&a(i.val())})),Ne(n)}function Re(t){var e={minutes:0,title:ln("Time"),incrementalUpdate:!0,showBack:!0,showSun:!1,callback:function(){}};t=$.extend({},e,t),$("#timeInput").popup("destroy").remove();var n=2047&t.minutes,i=0;t.minutes>>12&1&&(n=-n),t.minutes>>14&1?i=1:t.minutes>>13&1&&(i=2);var a=t.minutes>719,o=function(){return ln(a?"PM":"AM")},s=$("<div data-role='popup' id='timeInput' data-theme='a'><div data-role='header' data-theme='b'><h1>"+t.title+"</h1></div><div class='ui-content'>"+(t.helptext?"<p class='pad-top rain-desc center smaller'>"+t.helptext+"</p>":"")+"<span><fieldset class='ui-grid-b incr'><div class='ui-block-a'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div><div class='ui-block-b'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div><div class='ui-block-c'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='plus' data-iconpos='bottom'></a></div></fieldset><div class='ui-grid-b inputs'><div class='ui-block-a'><input data-wrapper-class='pad_buttons' class='hour dontPad' type='number' pattern='[0-9]*' value='"+(parseInt(t.minutes/60)%12==0?12:parseInt(t.minutes/60)%12)+"'></div><div class='ui-block-b'><input data-wrapper-class='pad_buttons' class='minute' type='number' pattern='[0-9]*' value='"+sn(t.minutes%60)+"'></div><div class='ui-block-c'><p class='center period'>"+o()+"</p></div></div><fieldset class='ui-grid-b decr'><div class='ui-block-a'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div><div class='ui-block-b'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div><div class='ui-block-c'><a href='#' data-role='button' data-mini='true' data-corners='true' data-icon='minus' data-iconpos='bottom'></a></div></fieldset></span>"+(t.showSun?"<div class='ui-grid-a useSun'><div class='ui-block-a'><button class='ui-mini ui-btn rise "+(1===i?"ui-btn-active":"")+"'>"+ln("Use Sunrise")+"</button></div><div class='ui-block-b'><button class='ui-mini ui-btn set "+(2===i?"ui-btn-active":"")+"'>"+ln("Use Sunset")+"</button></div></div><div class='offsetInput'"+(0===i?" style='display: none;'":"")+"><h5 class='center tight'>"+ln("Offset (minutes)")+"</h5><div class='input_with_buttons'><button class='decr ui-btn ui-btn-icon-notext ui-icon-carat-l btn-no-border'></button><input class='dontPad' type='number' pattern='[0-9]*' value='"+n+"'><button class='incr ui-btn ui-btn-icon-notext ui-icon-carat-r btn-no-border'></button></div></div>":"")+(t.showBack?"<button class='submit' data-theme='b'>"+ln("Submit")+"</button>":"")+"</div></div>"),r=function(e,n){if(0===e||1===e){var i=l()+n*(0===e?60:1),r=s.find(".inputs input").eq(e),d=r.hasClass("hour"),c=parseInt(r.val());if(1===n){if(d&&c>=12&&(c=0),!d&&c>=59){c=-1;var u=s.find(".hour"),p=parseInt(u.val());12===p&&(p=0),u.val(p+1)}}else if(d&&c<=1)c=13;else if(!d&&c<=0)return;(!a&&i>719||a&&i<721||a&&i>1439||!a&&-1===n&&i<0)&&(a=!a,s.find(".period").text(o())),c=d?c+n:sn(c+n),r.val(c)}else 2===e&&(a=!a,s.find(".period").text(o()));t.incrementalUpdate&&t.callback(l())},l=function(){var t=s.find(".useSun").find("button.ui-btn-active");if(1===t.length){var e=0,n=parseInt(s.find(".offsetInput input").val());return t.hasClass("rise")?(n>=0?e=n:(e=-n,e|=4096),e|=16384):(n>=0?e=n:(e=-n,e|=4096),e|=8192),e}var i=parseInt(s.find(".hour").val());return a&&12!==i&&(i+=12),a||12!==i||(i=0),60*i+parseInt(s.find(".minute").val())};if(s.find("button.submit").on("click",(function(){t.callback(l()),s.popup("destroy").remove()})),s.on("focus","input[type='number']",(function(t){t.target.value=""})).on("blur","input[type='number']",(function(t){var e=parseInt(t.target.value)||0;t.target.value=$(t.target).hasClass("dontPad")?e:sn(e)})),Ke(s.find(".incr").children(),(function(t){var e=$(t.currentTarget),n=e.index();return 0===e.find(".ui-disabled").length&&r(n,1),!1})),Ke(s.find(".decr").children(),(function(t){var e=$(t.currentTarget),n=e.index();return 0===e.find(".ui-disabled").length&&r(n,-1),!1})),t.showSun){s.find(".useSun").on("click","button",(function(){var e=$(this),n=s.find(".useSun").find("button").not(e),i=s.find(".offsetInput"),a=s.find("span").find(".ui-btn,input,p");n.removeClass("ui-btn-active"),e.hasClass("ui-btn-active")?(e.removeClass("ui-btn-active"),i.slideUp(),a.prop("disabled",!1).removeClass("ui-disabled")):(e.addClass("ui-btn-active"),i.slideDown(),a.prop("disabled",!0).addClass("ui-disabled")),t.incrementalUpdate&&t.callback(l())}));var d=s.find(".offsetInput").find("input"),c=function(e){var n=parseInt(d.val());-1===e&&-240===n||1===e&&240===n||(d.val(n+e),t.incrementalUpdate&&t.callback(l()))};d.on("focus",(function(){this.value=""})).on("blur",(function(){""===this.value?this.value="0":this.value>240?this.value="240":this.value<-240&&(this.value="-240")})),Ke(s.find(".offsetInput").find(".incr"),(function(){return c(1),!1})),Ke(s.find(".offsetInput").find(".decr"),(function(){return c(-1),!1}))}s.css("max-width","350px").one("popupafteropen",(function(){0!==i&&s.find("span").find(".ui-btn,input,p").prop("disabled",!0).addClass("ui-disabled")})).one("popupafterclose",(function(){t.incrementalUpdate&&t.callback(l())})),Ne(s)}function We(t){t.stopImmediatePropagation();var e=$(this),n=e.data("helptext");return Ne($("<div data-role='popup' data-theme='a'><p>"+n+"</p></div>"),{positionTo:e}),!1}function Ee(t,e){e=e||{},0!==t.indexOf("#")&&(t="#"+t),Le((function(){$.mobile.pageContainer.pagecontainer("change",t,e)}))}function Ne(t,e){e=$.extend({},{history:!1,positionTo:"window",overlayTheme:"b"},e),$.mobile.pageContainer.append(t),t.one("popupafterclose",(function(){t.popup("destroy").remove()})).popup(e).enhanceWithin(),t.popup("open")}function Le(t){var e=$(".ui-panel-open");if(e.length>0)return e.one("panelclose",(function(){t()})),void e.panel("close");t()}function qe(t){var e=$("#header");""===(t=$.extend(!0,{},{title:"",class:"",animate:!0,leftBtn:{icon:"",class:"",text:"",on:function(){}},rightBtn:{icon:"",class:"",text:"",on:function(){}}},t)).title&&""===t.class&&(t.class="logo");var n=$("<button data-icon='"+t.leftBtn.icon+"' "+(""===t.leftBtn.text?"data-iconpos='notext' ":"")+"class='ui-btn-left "+t.leftBtn.class+"'>"+t.leftBtn.text+"</button><h3 class='"+t.class+"'>"+t.title+"</h3><button data-icon='"+t.rightBtn.icon+"' "+(""===t.rightBtn.text?"data-iconpos='notext' ":"")+"class='ui-btn-right "+t.rightBtn.class+"'>"+t.rightBtn.text+"</button>"),i=t.animate?"fast":0;return e.children().stop().fadeOut(i,(function(){e.html(n).toolbar(e.hasClass("ui-header")?"refresh":null),e.find(".ui-btn-left").on("click",t.leftBtn.on),e.find(".ui-btn-right").on("click",t.rightBtn.on)})).fadeIn(i),n}function Be(t){(t="string"==typeof t?$(t):t).off("click").html("<p class='ui-icon ui-icon-loading mini-load'></p>");var e=t.filter("#footer-running");1===e.length&&e.find(".mini-load").addClass("bottom")}function Fe(t){"object"==typeof navigator.camera&&"function"==typeof navigator.camera.getPicture&&navigator.camera.getPicture(t,(function(){}),{quality:50,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!0,targetWidth:200,targetHeight:200})}function ze(t){if("sprinklers"!==$(".ui-page-active").attr("id")){$.mobile.document.one("pageshow",(function(){delete $.mobile.navigate.history.getActive().transition}));var e={reverse:!0};!0===t&&(e={firstLoad:!0,showLoading:!1,transition:"none"}),Ee("#sprinklers",e)}}function He(){var t=$(".ui-page-active");if(1===t.length){var e="site-control"===(t=t.attr("id"))&&!an(),n=$(".ui-popup-active");if(n.length)n.find("[data-role='popup']").popup("close");else if("sprinklers"===t||"start"===t||e)try{navigator.app.exitApp()}catch(t){}else if(x||"file:"===window.location.protocol){var i=$.mobile.navigate.history.getPrev().url;if("#"!==i.slice(0,1))return;Ee(i,{reverse:!0}),$.mobile.document.one("pagehide",(function(){$.mobile.navigate.history.activeIndex-=2}))}else R>0&&R--,0===R?navigator.app.exitApp():(W=!0,$.mobile.back())}}function Je(){Ve(He)}function Ve(t){var e=$(".ui-page-active").find(".hasChanges");if(t=t||function(){},0!==e.length)return Pe(ln("Do you want to save your changes?"),"",(function(){e.click(),e.hasClass("preventBack")||t()}),t),!1;t()}function Ge(t,e){e=e||2500,clearTimeout(p),$.mobile.loading("show",{text:t,textVisible:!0,textonly:!0,theme:"b"}),p=setTimeout((function(){$.mobile.loading("hide")}),e)}function Ye(t){FastClick.notNeeded(document.body)||(t.find("input[type='checkbox']:not([data-role='flipswitch']),.ui-select > .ui-btn").addClass("needsclick"),t.find(".ui-collapsible-heading-toggle").on("click",(function(){var t=$(this);setTimeout((function(){t.removeClass("ui-btn-active")}),100)})))}function Ke(t,e){var n;t.on(S?"tap":"click",e).on("taphold",(function(t){n=setInterval((function(){e(t)}),100)})).on("vmouseup vmouseout vmousecancel touchend",(function(){clearInterval(n)})).on("touchmove",(function(t){t.preventDefault()}))}function Ze(t){var e=document.createElement("style");e.innerHTML=t,document.head.appendChild(e)}function Xe(t){for(var e=0;e<t.length;e++)t[e]=+t[e];return t}function Qe(t){return 65535===t?ln("Sunset to Sunrise"):65534===t?ln("Sunrise to Sunset"):nn(en(t))}function tn(t){var e="",n=Math.max(0,parseInt(t/3600)%24),i=Math.max(0,parseInt(t/60)%60),a=t%60;return n&&(e+=sn(n)+":"),e+sn(i)+":"+sn(a)}function en(t){var e=t<0?-1:1;return t=Math.abs(t),{days:Math.max(0,parseInt(t/86400))*e,hours:Math.max(0,parseInt(t%86400/3600))*e,minutes:Math.max(0,parseInt(t%86400%3600/60))*e,seconds:Math.max(0,parseInt(t%86400%3600%60))*e}}function nn(t){var e="";return t.days&&(e+=t.days+ln("d")+" "),t.hours&&(e+=t.hours+ln("h")+" "),t.minutes&&(e+=t.minutes+ln("m")+" "),t.seconds&&(e+=t.seconds+ln("s")+" "),""===e&&(e="0"+ln("s")),e.trim()}function an(){return!(""===i||$.isEmptyObject(P)||$.isEmptyObject(P.options)||$.isEmptyObject(P.programs)||$.isEmptyObject(P.settings)||$.isEmptyObject(P.status)||$.isEmptyObject(P.stations))}function on(t,e){var n=[ln("Sunday"),ln("Monday"),ln("Tuesday"),ln("Wednesday"),ln("Thursday"),ln("Friday"),ln("Saturday")],i=[ln("Sun"),ln("Mon"),ln("Tue"),ln("Wed"),ln("Thu"),ln("Fri"),ln("Sat")];return"short"===e?i[t.getDay()]:n[t.getDay()]}function sn(t){var e=String(t);return 1===e.length&&(e="0"+e),e}function rn(t){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function ln(t){if("object"==typeof c&&c.hasOwnProperty(t)){var e=c[t];return e||t}return t}function dn(){$("[data-translate]").text((function(){var t=$(this),e=t.data("translate");if(!t.is("input[type='submit']"))return ln(e);t.val(ln(e)),t.parent("div.ui-btn").length>0&&t.button("refresh")})),$(".ui-toolbar-back-btn").text(ln("Back")),pn()}function cn(t){c={},void 0!==t?(I({lang:t}),d=t,"en"!==t?$.getJSON(fn()+"locale/"+t+".js",(function(t){c=t.messages,dn()})).fail(dn):dn()):T("lang",(function(t){cn((t.lang||navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage||"en").substring(0,2))}))}function un(){$("#localization").popup("destroy").remove();var t="<div data-role='popup' data-theme='a' id='localization' data-corners='false'><ul data-inset='true' data-role='listview' id='lang' data-corners='false'><li data-role='list-divider' data-theme='b' class='center' data-translate='Localization'>"+ln("Localization")+"</li>";return $.each({af:"Afrikaans",am:"Amharic",bg:"Bulgarian",zh:"Chinese",hr:"Croatian",cs:"Czech",nl:"Dutch",en:"English",et:"Estonian",pes:"Farsi",fr:"French",de:"German",el:"Greek",he:"Hebrew",hu:"Hungarian",is:"Icelandic",it:"Italian",lv:"Latvian",mn:"Mongolian",no:"Norwegian",pl:"Polish",pt:"Portuguese",ru:"Russian",sk:"Slovak",sl:"Slovenian",es:"Spanish",ta:"Tamil",th:"Thai",tr:"Turkish",sv:"Swedish",ro:"Romanian"},(function(e,n){t+="<li><a href='#' data-translate='"+n+"' data-lang-code='"+e+"'>"+ln(n)+"</a></li>"})),t+="</ul></div>",(t=$(t)).find("a").on("click",(function(){cn($(this).data("lang-code"))})),Ne(t),!1}function pn(){T("lang",(function(t){var e=$("#localization");e.find("a").each((function(){var e=$(this);e.data("lang-code")===t.lang?e.removeClass("ui-icon-carat-r").addClass("ui-icon-check"):e.removeClass("ui-icon-check").addClass("ui-icon-carat-r")})),e.find("li.ui-last-child").removeClass("ui-last-child")}))}function fn(){return""}function hn(t){for(var e,n={},i=t.slice(t.indexOf("?")+1).split("&"),a=0;a<i.length;a++)n[(e=i[a].split("="))[0]]=decodeURIComponent(e[1].replace(/\+/g,"%20"));return n}function mn(t){return JSON.stringify(t).replace(/\{|\}/g,"")}function vn(t){return JSON.parse("{"+t+"}")}function bn(t){return/^[a-f0-9]{32}$/i.test(t)}function gn(t,e){return t.station<e.station?-1:t.station>e.station?1:0}function yn(t){var e=t>719?"PM":"AM",n=parseInt(t/60)%12;return 0===n&&(n=12),n+":"+sn(t%60)+" "+e}function wn(t,e,n){var i=[ln("Sun"),ln("Mon"),ln("Tue"),ln("Wed"),ln("Thr"),ln("Fri"),ln("Sat")],a=[ln("Jan"),ln("Feb"),ln("Mar"),ln("Apr"),ln("May"),ln("Jun"),ln("Jul"),ln("Aug"),ln("Sep"),ln("Oct"),ln("Nov"),ln("Dec")];return 0===t.getTime()?"--":(!1!==e&&t.setMinutes(t.getMinutes()+t.getTimezoneOffset()),"de"===d?sn(t.getDate())+"."+sn(t.getMonth()+1)+"."+t.getFullYear()+" "+sn(t.getHours())+":"+sn(t.getMinutes())+":"+sn(t.getSeconds()):1===n?a[t.getMonth()]+" "+sn(t.getDate())+", "+t.getFullYear()+" "+sn(t.getHours())+":"+sn(t.getMinutes())+":"+sn(t.getSeconds()):2===n?a[t.getMonth()]+" "+sn(t.getDate())+", "+sn(t.getHours())+":"+sn(t.getMinutes())+":"+sn(t.getSeconds()):i[t.getDay()]+", "+sn(t.getDate())+" "+a[t.getMonth()]+" "+t.getFullYear()+" "+sn(t.getHours())+":"+sn(t.getMinutes())+":"+sn(t.getSeconds()))}function kn(t){if(Ie(219)){var e={};return Object.keys(t).forEach((function(n){var i=n.match(/^o(\d+)$/);i&&i[1]?e[Object.keys(E).find((function(t){return E[t]===parseInt(i[1],10)}))]=t[n]:e[n]=t[n]})),e}return t}function $n(t){var e={};t.split("&").forEach((function(t){t=t.split("="),e[t[0]]=t[1]})),e=kn(e);var n=[];return Object.keys(e).forEach((function(t){n.push(t+"="+e[t])})),t=n.join("&")}$.fn.focusInput=function(){if(this.get(0).setSelectionRange)this.focus(),this.get(0).setSelectionRange(0,this.val().length);else if(this.get(0).createTextRange){var t=this.get(0).createTextRange();t.collapse(!0),t.moveEnd("character",this.val().length),t.moveStart("character",0),t.select()}return this},Number.prototype.clamp=function(t,e){return Math.min(Math.max(this,t),e)}}]);